<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Rodrigo Hermont Ozon">
<meta name="author" content="Gilberto Reynoso-Meza">
<meta name="dcterms.date" content="2025-10-22">

<title>Multi-Period Multi-Objective Portfolio Optimization in Agricultural Commodity Futures â€“ PAIC Econometrics | FAE</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8598d624af1d875e24ba1dc5ecbbe8a2.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>

<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://fae.edu/servicos/caderno-paic.vm" class="navbar-brand navbar-brand-logo">
    <img src="https://raw.githubusercontent.com/profrhozon/FAE_Econometrics/refs/heads/main/fae_logo.png" alt="FAE Business School" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./research.html"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./publications.qmd"> 
<span class="menu-text">Publications</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://www.linkedin.com/school/fae-centro-universitario/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-linkedin"></i></a>
    <a href="https://github.com/PAICEconometrics" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
    <a href="mailto:rodrigo.ozon@fae.edu" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-envelope"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Multi-Period Multi-Objective Portfolio Optimization in Agricultural Commodity Futures</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">ðŸ“˜ Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Project Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About the Team</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mindmap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Research Mindmap</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./resmindmap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Theoretical Framework</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./revsyslit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Literature Review</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./publplan.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Publication Plan</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">ðŸ“° Market Intelligence</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./news.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Commodities News</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./openAi_agent.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AI News Agent</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">ðŸ“Š Predictive Modeling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./time_series_portfolio.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Time Series Portfolio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./garch_hawkes_simmodel.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GARCH-Hawkes Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./markovian_bayesian_timeseries.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machine_learning_models.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Machine Learning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./models_ablation_NN.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./econometrics_model_sel.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Model Selection</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./paper-draft.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Paper Draft</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">ðŸŽ¯ Optimization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./optimization.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multi-Objective Framework</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./portfolio_multiobj_opt_algos.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Portfolio Algorithms</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./scenario_simulation_fuzzy_multicriteria.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Scenario Simulation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./layout-jupyter.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Jupyter Integration</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">ðŸ¤– Reinforcement Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pareto_front_reinforcement.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pareto Front Strategy</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reinforcement_algos_decision_making.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">RL Decision Algorithms</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">ðŸ“š Resources</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./acknowlegment.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Acknowledgments</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sec-introduction" id="toc-sec-introduction" class="nav-link active" data-scroll-target="#sec-introduction"><span class="header-section-number">1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#sec-motivation" id="toc-sec-motivation" class="nav-link" data-scroll-target="#sec-motivation"><span class="header-section-number">1.1</span> Research Motivation</a></li>
  <li><a href="#sec-objectives" id="toc-sec-objectives" class="nav-link" data-scroll-target="#sec-objectives"><span class="header-section-number">1.2</span> Research Objectives</a></li>
  <li><a href="#sec-contribution" id="toc-sec-contribution" class="nav-link" data-scroll-target="#sec-contribution"><span class="header-section-number">1.3</span> Contribution to the Literature</a></li>
  </ul></li>
  <li><a href="#sec-theory" id="toc-sec-theory" class="nav-link" data-scroll-target="#sec-theory"><span class="header-section-number">2</span> Theoretical Framework</a>
  <ul class="collapse">
  <li><a href="#sec-multiperiod" id="toc-sec-multiperiod" class="nav-link" data-scroll-target="#sec-multiperiod"><span class="header-section-number">2.1</span> Multi-Period Portfolio Optimization</a>
  <ul class="collapse">
  <li><a href="#sec-temporal" id="toc-sec-temporal" class="nav-link" data-scroll-target="#sec-temporal"><span class="header-section-number">2.1.1</span> Intertemporal Linkages</a></li>
  </ul></li>
  <li><a href="#sec-moo" id="toc-sec-moo" class="nav-link" data-scroll-target="#sec-moo"><span class="header-section-number">2.2</span> Multi-Objective Formulation</a>
  <ul class="collapse">
  <li><a href="#sec-objectives-detail" id="toc-sec-objectives-detail" class="nav-link" data-scroll-target="#sec-objectives-detail"><span class="header-section-number">2.2.1</span> Objective Functions</a></li>
  </ul></li>
  <li><a href="#sec-algorithms" id="toc-sec-algorithms" class="nav-link" data-scroll-target="#sec-algorithms"><span class="header-section-number">2.3</span> Evolutionary Algorithms for MOO</a>
  <ul class="collapse">
  <li><a href="#sec-nsga2" id="toc-sec-nsga2" class="nav-link" data-scroll-target="#sec-nsga2"><span class="header-section-number">2.3.1</span> NSGA-II (Non-dominated Sorting Genetic Algorithm II)</a></li>
  <li><a href="#sec-nsga3" id="toc-sec-nsga3" class="nav-link" data-scroll-target="#sec-nsga3"><span class="header-section-number">2.3.2</span> NSGA-III</a></li>
  <li><a href="#sec-deoptim" id="toc-sec-deoptim" class="nav-link" data-scroll-target="#sec-deoptim"><span class="header-section-number">2.3.3</span> DEOptim (Differential Evolution)</a></li>
  <li><a href="#sec-moead" id="toc-sec-moead" class="nav-link" data-scroll-target="#sec-moead"><span class="header-section-number">2.3.4</span> MOEA/D (Multi-Objective Evolutionary Algorithm based on Decomposition)</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-data" id="toc-sec-data" class="nav-link" data-scroll-target="#sec-data"><span class="header-section-number">3</span> Data and Methodology</a>
  <ul class="collapse">
  <li><a href="#sec-data-collection" id="toc-sec-data-collection" class="nav-link" data-scroll-target="#sec-data-collection"><span class="header-section-number">3.1</span> Data Collection</a>
  <ul class="collapse">
  <li><a href="#sec-data-characteristics" id="toc-sec-data-characteristics" class="nav-link" data-scroll-target="#sec-data-characteristics"><span class="header-section-number">3.1.1</span> Data Characteristics</a></li>
  </ul></li>
  <li><a href="#sec-returns" id="toc-sec-returns" class="nav-link" data-scroll-target="#sec-returns"><span class="header-section-number">3.2</span> Return Calculation and Monthly Aggregation</a>
  <ul class="collapse">
  <li><a href="#sec-return-dist" id="toc-sec-return-dist" class="nav-link" data-scroll-target="#sec-return-dist"><span class="header-section-number">3.2.1</span> Return Distribution Analysis</a></li>
  </ul></li>
  <li><a href="#sec-correlation" id="toc-sec-correlation" class="nav-link" data-scroll-target="#sec-correlation"><span class="header-section-number">3.3</span> Correlation Structure</a></li>
  </ul></li>
  <li><a href="#sec-optimization" id="toc-sec-optimization" class="nav-link" data-scroll-target="#sec-optimization"><span class="header-section-number">4</span> Multi-Objective Portfolio Optimization</a>
  <ul class="collapse">
  <li><a href="#sec-obj-functions" id="toc-sec-obj-functions" class="nav-link" data-scroll-target="#sec-obj-functions"><span class="header-section-number">4.1</span> Objective Function Implementation</a></li>
  <li><a href="#sec-nsga2-impl" id="toc-sec-nsga2-impl" class="nav-link" data-scroll-target="#sec-nsga2-impl"><span class="header-section-number">4.2</span> NSGA-II Implementation</a>
  <ul class="collapse">
  <li><a href="#sec-nsga2-viz" id="toc-sec-nsga2-viz" class="nav-link" data-scroll-target="#sec-nsga2-viz"><span class="header-section-number">4.2.1</span> NSGA-II Pareto Front Visualization</a></li>
  </ul></li>
  <li><a href="#sec-deoptim-impl" id="toc-sec-deoptim-impl" class="nav-link" data-scroll-target="#sec-deoptim-impl"><span class="header-section-number">4.3</span> DEOptim Implementation</a>
  <ul class="collapse">
  <li><a href="#sec-deoptim-conv" id="toc-sec-deoptim-conv" class="nav-link" data-scroll-target="#sec-deoptim-conv"><span class="header-section-number">4.3.1</span> DEOptim Convergence Plot</a></li>
  </ul></li>
  <li><a href="#sec-algo-comparison" id="toc-sec-algo-comparison" class="nav-link" data-scroll-target="#sec-algo-comparison"><span class="header-section-number">4.4</span> Algorithm Comparison</a>
  <ul class="collapse">
  <li><a href="#sec-weight-comparison" id="toc-sec-weight-comparison" class="nav-link" data-scroll-target="#sec-weight-comparison"><span class="header-section-number">4.4.1</span> Portfolio Weight Allocation Comparison</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-backtesting" id="toc-sec-backtesting" class="nav-link" data-scroll-target="#sec-backtesting"><span class="header-section-number">5</span> Multi-Period Backtesting with Rebalancing</a>
  <ul class="collapse">
  <li><a href="#sec-perf-viz" id="toc-sec-perf-viz" class="nav-link" data-scroll-target="#sec-perf-viz"><span class="header-section-number">5.0.1</span> Cumulative Performance Visualization</a></li>
  </ul></li>
  <li><a href="#sec-discussion" id="toc-sec-discussion" class="nav-link" data-scroll-target="#sec-discussion"><span class="header-section-number">6</span> Discussion</a>
  <ul class="collapse">
  <li><a href="#sec-findings" id="toc-sec-findings" class="nav-link" data-scroll-target="#sec-findings"><span class="header-section-number">6.1</span> Key Findings</a></li>
  <li><a href="#sec-implications" id="toc-sec-implications" class="nav-link" data-scroll-target="#sec-implications"><span class="header-section-number">6.2</span> Practical Implications</a></li>
  <li><a href="#sec-limitations" id="toc-sec-limitations" class="nav-link" data-scroll-target="#sec-limitations"><span class="header-section-number">6.3</span> Limitations</a></li>
  </ul></li>
  <li><a href="#sec-conclusion" id="toc-sec-conclusion" class="nav-link" data-scroll-target="#sec-conclusion"><span class="header-section-number">7</span> Conclusion</a>
  <ul class="collapse">
  <li><a href="#sec-acknowledgments" id="toc-sec-acknowledgments" class="nav-link" data-scroll-target="#sec-acknowledgments"><span class="header-section-number">7.1</span> Acknowledgments</a></li>
  <li><a href="#sec-data-code" id="toc-sec-data-code" class="nav-link" data-scroll-target="#sec-data-code"><span class="header-section-number">7.2</span> Data and Code Availability</a></li>
  <li><a href="#sec-funding" id="toc-sec-funding" class="nav-link" data-scroll-target="#sec-funding"><span class="header-section-number">7.3</span> Funding</a></li>
  <li><a href="#sec-conflicts" id="toc-sec-conflicts" class="nav-link" data-scroll-target="#sec-conflicts"><span class="header-section-number">7.4</span> Conflicts of Interest</a></li>
  <li><a href="#sec-references" id="toc-sec-references" class="nav-link" data-scroll-target="#sec-references"><span class="header-section-number">7.5</span> References</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Multi-Period Multi-Objective Portfolio Optimization in Agricultural Commodity Futures</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Evolutionary Algorithms with Dynamic Rebalancing and Transaction Costs</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliations</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Rodrigo Hermont Ozon <a href="mailto:rodrigo.ozon@fae.edu" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            FAE Business School and PUCPR
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Gilberto Reynoso-Meza <a href="mailto:gilberto.reynoso@pucpr.br" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            PUCPR
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 22, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="sec-introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Agricultural commodity futures markets represent a critical component of global food security and economic stability, characterized by persistent volatility, non-normal return distributions, and complex interdependencies <span class="citation" data-cites="Gilbert2010">[@Gilbert2010]</span>. Traditional portfolio optimization approaches, predominantly single-period mean-variance frameworks, fail to capture the dynamic nature of these markets where sequential rebalancing decisions interact with transaction costs, liquidity constraints, and evolving market conditions <span class="citation" data-cites="Markowitz1952">[@Markowitz1952]</span>.</p>
<p>This research addresses a fundamental gap in agricultural commodity portfolio management by developing a comprehensive <strong>multi-period multi-objective optimization framework</strong> that explicitly accounts for:</p>
<ol type="1">
<li><strong>Multiple Conflicting Objectives</strong>: Simultaneously optimizing expected return, risk (measured by Conditional Value-at-Risk), portfolio concentration (Herfindahl index), liquidity, and transaction costs</li>
<li><strong>Temporal Dependencies</strong>: Modeling the intertemporal structure of portfolio decisions through monthly rebalancing with realistic transaction costs</li>
<li><strong>Algorithmic Diversity</strong>: Comparing multiple state-of-the-art evolutionary algorithms (NSGA-II, NSGA-III, DEOptim, MOEA/D) in agricultural commodity contexts</li>
</ol>
<section id="sec-motivation" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="sec-motivation"><span class="header-section-number">1.1</span> Research Motivation</h2>
<p>The motivation for this work stems from three critical observations:</p>
<p><strong>First</strong>, agricultural commodity portfolios face unique challenges absent in traditional equity portfolios: seasonality patterns, weather dependencies, geopolitical supply shocks, and biofuel policy impacts <span class="citation" data-cites="FAO2025">[@FAO2025]</span>. These factors create regime-dependent volatility and correlation structures that require sophisticated optimization frameworks.</p>
<p><strong>Second</strong>, real-world portfolio management is inherently multi-period: investors make sequential allocation decisions, incur transaction costs when rebalancing, and face constraints on turnover and liquidity <span class="citation" data-cites="Sutton2018">[@Sutton2018]</span>. Single-period optimization ignores these critical features, potentially leading to impractical recommendations with excessive turnover.</p>
<p><strong>Third</strong>, modern investors face multiple objectives beyond simple mean-variance trade-offs: diversification requirements, liquidity needs, sustainability mandates, and operational constraints <span class="citation" data-cites="Deb2002">[@Deb2002]</span>. Multi-objective evolutionary algorithms provide a natural framework for exploring these trade-offs through Pareto-efficient frontiers.</p>
</section>
<section id="sec-objectives" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="sec-objectives"><span class="header-section-number">1.2</span> Research Objectives</h2>
<p>This study pursues four specific objectives:</p>
<ol type="1">
<li><p><strong>Multi-Period Framework Development</strong>: Construct a dynamic portfolio optimization model that explicitly incorporates monthly rebalancing decisions, transaction costs (bid-ask spreads and commissions), and temporal linkages between periods</p></li>
<li><p><strong>Multi-Objective Formulation</strong>: Design an optimization framework with five competing objectives:</p>
<ul>
<li>Expected return maximization</li>
<li>Risk minimization (CVaR at 95% confidence)</li>
<li>Portfolio concentration reduction (Herfindahl index)</li>
<li>Liquidity enhancement</li>
<li>Transaction cost minimization</li>
</ul></li>
<li><p><strong>Algorithmic Comparison</strong>: Empirically evaluate the performance of four evolutionary algorithms (NSGA-II, NSGA-III, DEOptim, MOEA/D) in agricultural commodity portfolio contexts, identifying strengths and weaknesses</p></li>
<li><p><strong>Practical Implementation</strong>: Develop reproducible R code for practitioners to apply these methodologies to their own commodity portfolios, with explicit treatment of data aggregation (daily to monthly), realistic constraints, and backtesting procedures</p></li>
</ol>
</section>
<section id="sec-contribution" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="sec-contribution"><span class="header-section-number">1.3</span> Contribution to the Literature</h2>
<p>This research makes three primary contributions:</p>
<p><strong>Methodological Innovation</strong>: We integrate multi-period decision-making with multi-objective optimization specifically for agricultural commodities, a combination rarely explored in existing literature. Most studies focus either on single-period MOO or multi-period single-objective optimization, but not both <span class="citation" data-cites="Mwamba2023">[@Mwamba2023]</span>.</p>
<p><strong>Algorithmic Insights</strong>: By comparing four distinct evolutionary algorithms on the same problem, we provide practical guidance on algorithm selection for commodity portfolio managers. Previous studies typically employ a single algorithm without comparative analysis <span class="citation" data-cites="Gao2024">[@Gao2024]</span>.</p>
<p><strong>Reproducibility and Transparency</strong>: We provide complete, documented R code and real data, facilitating replication and extension by researchers and practitioners. This addresses the reproducibility crisis in computational finance <span class="citation" data-cites="Espiga2024">[@Espiga2024]</span>.</p>
</section>
</section>
<section id="sec-theory" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Theoretical Framework</h1>
<section id="sec-multiperiod" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="sec-multiperiod"><span class="header-section-number">2.1</span> Multi-Period Portfolio Optimization</h2>
<p>Consider an investor managing a portfolio of <span class="math inline">\(N\)</span> agricultural commodity futures over <span class="math inline">\(T\)</span> discrete time periods (months). At each period <span class="math inline">\(t \in \{1, 2, \ldots, T\}\)</span>, the investor observes:</p>
<ul>
<li><strong>Portfolio weights</strong>: <span class="math inline">\(\mathbf{w}_t = (w_{1,t}, w_{2,t}, \ldots, w_{N,t})\)</span> where <span class="math inline">\(\sum_{i=1}^N w_{i,t} = 1\)</span> and <span class="math inline">\(w_{i,t} \geq 0\)</span> (long-only constraint)</li>
<li><strong>Asset returns</strong>: <span class="math inline">\(\mathbf{r}_t = (r_{1,t}, r_{2,t}, \ldots, r_{N,t})\)</span> representing log-returns from period <span class="math inline">\(t-1\)</span> to <span class="math inline">\(t\)</span></li>
<li><strong>Transaction costs</strong>: <span class="math inline">\(c_t = \kappa \sum_{i=1}^N |w_{i,t} - w_{i,t-1}^{\text{drift}}|\)</span> where <span class="math inline">\(\kappa\)</span> is the proportional transaction cost rate and <span class="math inline">\(w_{i,t-1}^{\text{drift}}\)</span> represents the drifted weight from period <span class="math inline">\(t-1\)</span></li>
</ul>
<p>The <strong>portfolio return</strong> at period <span class="math inline">\(t\)</span> is: <span class="math display">\[
R_t = \sum_{i=1}^N w_{i,t} r_{i,t} - c_t
\]</span></p>
<p>Over a multi-period horizon, the <strong>cumulative return</strong> becomes: <span class="math display">\[
R_{\text{cumulative}} = \prod_{t=1}^T (1 + R_t) - 1
\]</span></p>
<section id="sec-temporal" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="sec-temporal"><span class="header-section-number">2.1.1</span> Intertemporal Linkages</h3>
<p>Multi-period optimization differs fundamentally from single-period approaches through three mechanisms:</p>
<ol type="1">
<li><p><strong>Weight Drift</strong>: Between rebalancing dates, portfolio weights drift due to differential asset returns. If we hold weights <span class="math inline">\(\mathbf{w}_t\)</span> at the beginning of period <span class="math inline">\(t\)</span> and observe returns <span class="math inline">\(\mathbf{r}_t\)</span>, the drifted weights at the end of period <span class="math inline">\(t\)</span> (before rebalancing) are: <span class="math display">\[
w_{i,t}^{\text{drift}} = \frac{w_{i,t}(1 + r_{i,t})}{\sum_{j=1}^N w_{j,t}(1 + r_{j,t})}
\]</span></p></li>
<li><p><strong>Transaction Costs</strong>: Rebalancing from <span class="math inline">\(\mathbf{w}_t^{\text{drift}}\)</span> to <span class="math inline">\(\mathbf{w}_{t+1}\)</span> incurs proportional costs: <span class="math display">\[
c_{t+1} = \kappa \sum_{i=1}^N |w_{i,t+1} - w_{i,t}^{\text{drift}}|
\]</span> where <span class="math inline">\(\kappa\)</span> typically ranges from 0.001 (10 basis points) to 0.005 (50 basis points) for commodity futures.</p></li>
<li><p><strong>Path Dependency</strong>: The cumulative return depends on the sequence of weights <span class="math inline">\(\{\mathbf{w}_1, \mathbf{w}_2, \ldots, \mathbf{w}_T\}\)</span>, not just terminal weights. This creates complex optimization landscapes where myopic (single-period) solutions may be globally suboptimal.</p></li>
</ol>
</section>
</section>
<section id="sec-moo" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="sec-moo"><span class="header-section-number">2.2</span> Multi-Objective Formulation</h2>
<p>We formulate the multi-period portfolio optimization problem as a <strong>constrained multi-objective optimization problem (MOP)</strong>:</p>
<p><span class="math display">\[
\begin{aligned}
\max_{\mathbf{w}} \quad &amp; f_1(\mathbf{w}) = \mathbb{E}[R_{\text{portfolio}}] \\
\min_{\mathbf{w}} \quad &amp; f_2(\mathbf{w}) = \text{CVaR}_{0.95}(\mathbf{w}) \\
\min_{\mathbf{w}} \quad &amp; f_3(\mathbf{w}) = \text{HHI}(\mathbf{w}) = \sum_{i=1}^N w_i^2 \\
\max_{\mathbf{w}} \quad &amp; f_4(\mathbf{w}) = \text{Liquidity}(\mathbf{w}) \\
\min_{\mathbf{w}} \quad &amp; f_5(\mathbf{w}) = \text{TransactionCost}(\mathbf{w})
\end{aligned}
\]</span></p>
<p>subject to: <span class="math display">\[
\begin{aligned}
&amp; \sum_{i=1}^N w_i = 1 \\
&amp; w_i \geq 0, \quad \forall i \in \{1, \ldots, N\} \\
&amp; w_i \leq w_{\max}, \quad \forall i \in \{1, \ldots, N\}
\end{aligned}
\]</span></p>
<section id="sec-objectives-detail" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="sec-objectives-detail"><span class="header-section-number">2.2.1</span> Objective Functions</h3>
<p><strong>Objective 1: Expected Return</strong> <span class="math display">\[
f_1(\mathbf{w}) = \frac{1}{T} \sum_{t=1}^T \left( \sum_{i=1}^N w_i r_{i,t} - c_t \right)
\]</span></p>
<p><strong>Objective 2: Conditional Value-at-Risk (CVaR)</strong></p>
<p>CVaR at confidence level <span class="math inline">\(\alpha\)</span> (e.g., 95%) represents the expected loss in the worst <span class="math inline">\((1-\alpha)\)</span> cases: <span class="math display">\[
\text{CVaR}_\alpha(\mathbf{w}) = \mathbb{E}[R_{\text{portfolio}} \mid R_{\text{portfolio}} \leq \text{VaR}_\alpha]
\]</span></p>
<p>CVaR is a coherent risk measure superior to Value-at-Risk (VaR) because it satisfies sub-additivity and is convex, facilitating optimization <span class="citation" data-cites="Rockafellar2000">[@Rockafellar2000]</span>.</p>
<p><strong>Objective 3: Portfolio Concentration (Herfindahl-Hirschman Index)</strong></p>
<p>The HHI measures portfolio concentration: <span class="math display">\[
\text{HHI}(\mathbf{w}) = \sum_{i=1}^N w_i^2
\]</span></p>
<p>where <span class="math inline">\(\text{HHI} \in [1/N, 1]\)</span>. Lower HHI indicates better diversification: - <span class="math inline">\(\text{HHI} = 1/N\)</span>: perfectly diversified (equal weights) - <span class="math inline">\(\text{HHI} = 1\)</span>: completely concentrated (single asset)</p>
<p><strong>Objective 4: Liquidity</strong></p>
<p>We proxy liquidity using average trading volume weighted by portfolio weights: <span class="math display">\[
\text{Liquidity}(\mathbf{w}) = \sum_{i=1}^N w_i \cdot \log(\text{Volume}_i)
\]</span></p>
<p>Higher values indicate more liquid portfolios.</p>
<p><strong>Objective 5: Transaction Costs</strong></p>
<p>Average transaction cost across rebalancing periods: <span class="math display">\[
f_5(\mathbf{w}) = \frac{1}{T-1} \sum_{t=2}^T \kappa \sum_{i=1}^N |w_{i,t} - w_{i,t-1}^{\text{drift}}|
\]</span></p>
</section>
</section>
<section id="sec-algorithms" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="sec-algorithms"><span class="header-section-number">2.3</span> Evolutionary Algorithms for MOO</h2>
<p>Multi-objective optimization seeks to identify the <strong>Pareto frontier</strong>: the set of solutions where improvement in one objective necessitates degradation in at least one other objective. Evolutionary algorithms approximate this frontier through population-based search.</p>
<section id="sec-nsga2" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="sec-nsga2"><span class="header-section-number">2.3.1</span> NSGA-II (Non-dominated Sorting Genetic Algorithm II)</h3>
<p>NSGA-II <span class="citation" data-cites="Deb2002">[@Deb2002]</span> is the most widely used multi-objective evolutionary algorithm, featuring:</p>
<ol type="1">
<li><strong>Non-dominated Sorting</strong>: Solutions are ranked into fronts <span class="math inline">\(F_1, F_2, \ldots\)</span> where <span class="math inline">\(F_1\)</span> contains non-dominated solutions</li>
<li><strong>Crowding Distance</strong>: Within each front, solutions are evaluated by crowding distance to maintain diversity: <span class="math display">\[
d_i = \sum_{k=1}^M \frac{f_k^{(i+1)} - f_k^{(i-1)}}{f_k^{\max} - f_k^{\min}}
\]</span></li>
<li><strong>Selection</strong>: Combines front ranking and crowding distance for parent selection</li>
</ol>
<p><strong>Advantages</strong>: Excellent diversity preservation, computationally efficient<br>
<strong>Disadvantages</strong>: Performance degrades with &gt;3 objectives, vulnerable to local optima</p>
</section>
<section id="sec-nsga3" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="sec-nsga3"><span class="header-section-number">2.3.2</span> NSGA-III</h3>
<p>NSGA-III <span class="citation" data-cites="Deb2014">[@Deb2014]</span> extends NSGA-II for many-objective problems (&gt;3 objectives) using:</p>
<ol type="1">
<li><strong>Reference Points</strong>: Pre-defined reference vectors on a unit simplex</li>
<li><strong>Niche Preservation</strong>: Associates each solution with nearest reference point</li>
<li><strong>Adaptive Selection</strong>: Maintains balance across reference points</li>
</ol>
<p><strong>Advantages</strong>: Scales well to many objectives (5+ objectives)<br>
<strong>Disadvantages</strong>: Requires tuning of reference point distribution</p>
</section>
<section id="sec-deoptim" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="sec-deoptim"><span class="header-section-number">2.3.3</span> DEOptim (Differential Evolution)</h3>
<p>DEOptim <span class="citation" data-cites="Storn1997">[@Storn1997]</span> is a population-based stochastic search algorithm operating through:</p>
<ol type="1">
<li><strong>Mutation</strong>: Create trial vector via differential mutation: <span class="math display">\[
\mathbf{v}_i = \mathbf{x}_{r1} + F(\mathbf{x}_{r2} - \mathbf{x}_{r3})
\]</span></li>
<li><strong>Crossover</strong>: Combine parent and mutant: <span class="math display">\[
u_{i,j} = \begin{cases}
v_{i,j} &amp; \text{if } \text{rand}(0,1) &lt; CR \\
x_{i,j} &amp; \text{otherwise}
\end{cases}
\]</span></li>
<li><strong>Selection</strong>: Greedy replacement based on objective function</li>
</ol>
<p><strong>Advantages</strong>: Excellent for single-objective optimization, simple implementation<br>
<strong>Disadvantages</strong>: Not inherently multi-objective (requires scalarization)</p>
</section>
<section id="sec-moead" class="level3" data-number="2.3.4">
<h3 data-number="2.3.4" class="anchored" data-anchor-id="sec-moead"><span class="header-section-number">2.3.4</span> MOEA/D (Multi-Objective Evolutionary Algorithm based on Decomposition)</h3>
<p>MOEA/D <span class="citation" data-cites="Zhang2007">[@Zhang2007]</span> decomposes the MOP into multiple scalar subproblems:</p>
<ol type="1">
<li><strong>Weight Vectors</strong>: Define <span class="math inline">\(N\)</span> uniformly distributed weight vectors <span class="math inline">\(\mathbf{\lambda}_1, \ldots, \mathbf{\lambda}_N\)</span></li>
<li><strong>Scalarization</strong>: Convert MOP to <span class="math inline">\(N\)</span> single-objective problems using weighted sum or Tchebycheff approach: <span class="math display">\[
g^{\text{te}}(\mathbf{x} \mid \mathbf{\lambda}, \mathbf{z}^*) = \max_{1 \leq i \leq m} \left\{ \lambda_i |f_i(\mathbf{x}) - z_i^*| \right\}
\]</span></li>
<li><strong>Neighborhood Search</strong>: Each subproblem uses information from neighboring subproblems</li>
</ol>
<p><strong>Advantages</strong>: Efficient for complex Pareto fronts, scalable<br>
<strong>Disadvantages</strong>: Sensitive to weight vector distribution</p>
</section>
</section>
</section>
<section id="sec-data" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Data and Methodology</h1>
<section id="sec-data-collection" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="sec-data-collection"><span class="header-section-number">3.1</span> Data Collection</h2>
<p>We analyze eight agricultural commodity futures contracts traded on CME Group:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define commodity futures tickers</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>tickers <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ZC=F"</span>,   <span class="co"># Corn Futures</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ZW=F"</span>,   <span class="co"># Wheat Futures (Chicago)</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"KE=F"</span>,   <span class="co"># KC HRW Wheat Futures (Kansas City)</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ZR=F"</span>,   <span class="co"># Rough Rice Futures</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GF=F"</span>,   <span class="co"># Feeder Cattle Futures</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ZS=F"</span>,   <span class="co"># Soybean Futures</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ZM=F"</span>,   <span class="co"># Soybean Meal Futures</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ZL=F"</span>    <span class="co"># Soybean Oil Futures</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Download price data from Yahoo Finance</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>portfolioPrices <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ticker <span class="cf">in</span> tickers) {</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">getSymbols.yahoo</span>(</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>      ticker, </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">from =</span> <span class="st">"2019-01-01"</span>, </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">auto.assign =</span> <span class="cn">FALSE</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    )[, <span class="dv">4</span>]  <span class="co"># Close price (4th column)</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    portfolioPrices <span class="ot">&lt;-</span> <span class="fu">cbind</span>(portfolioPrices, data)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"Error downloading"</span>, ticker, <span class="st">":"</span>, e<span class="sc">$</span>message))</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows with any missing values</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>portfolioPrices <span class="ot">&lt;-</span> portfolioPrices[<span class="fu">complete.cases</span>(portfolioPrices), ]</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign meaningful column names</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(portfolioPrices) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Corn"</span>, <span class="st">"Wheat_Chicago"</span>, <span class="st">"Wheat_KC"</span>, <span class="st">"Rice"</span>, </span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Feeder_Cattle"</span>, <span class="st">"Soybeans"</span>, <span class="st">"Soybean_Meal"</span>, <span class="st">"Soybean_Oil"</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Display summary</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Data Summary:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Data Summary:</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Date Range:"</span>, <span class="fu">as.character</span>(<span class="fu">start</span>(portfolioPrices)), <span class="st">"to"</span>, </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.character</span>(<span class="fu">end</span>(portfolioPrices)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Date Range: 2019-01-02 to 2025-10-21 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total Observations:"</span>, <span class="fu">nrow</span>(portfolioPrices), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Total Observations: 1712 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Number of Assets:"</span>, <span class="fu">ncol</span>(portfolioPrices), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Number of Assets: 8 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show last few observations</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(portfolioPrices) <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Date"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Recent Commodity Futures Prices (USD)"</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">big.mark =</span> <span class="st">","</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>Recent Commodity Futures Prices (USD)</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Date</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Corn</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Wheat_Chicago</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Wheat_KC</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Rice</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Feeder_Cattle</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Soybeans</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Soybean_Meal</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Soybean_Oil</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2025-10-14</td>
<td style="text-align: right;">413.00</td>
<td style="text-align: right;">500.25</td>
<td style="text-align: right;">488.50</td>
<td style="text-align: right;">1,072.5</td>
<td style="text-align: right;">380.17</td>
<td style="text-align: right;">1,006.50</td>
<td style="text-align: right;">267.0</td>
<td style="text-align: right;">49.92</td>
</tr>
<tr class="even">
<td style="text-align: left;">2025-10-15</td>
<td style="text-align: right;">416.75</td>
<td style="text-align: right;">498.75</td>
<td style="text-align: right;">488.25</td>
<td style="text-align: right;">1,058.5</td>
<td style="text-align: right;">379.73</td>
<td style="text-align: right;">1,006.50</td>
<td style="text-align: right;">275.9</td>
<td style="text-align: right;">50.80</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2025-10-16</td>
<td style="text-align: right;">421.75</td>
<td style="text-align: right;">502.50</td>
<td style="text-align: right;">488.75</td>
<td style="text-align: right;">1,069.0</td>
<td style="text-align: right;">379.67</td>
<td style="text-align: right;">1,010.75</td>
<td style="text-align: right;">276.9</td>
<td style="text-align: right;">50.87</td>
</tr>
<tr class="even">
<td style="text-align: left;">2025-10-17</td>
<td style="text-align: right;">422.50</td>
<td style="text-align: right;">503.75</td>
<td style="text-align: right;">491.50</td>
<td style="text-align: right;">1,062.0</td>
<td style="text-align: right;">371.95</td>
<td style="text-align: right;">1,019.50</td>
<td style="text-align: right;">281.0</td>
<td style="text-align: right;">51.13</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2025-10-20</td>
<td style="text-align: right;">423.25</td>
<td style="text-align: right;">504.75</td>
<td style="text-align: right;">490.00</td>
<td style="text-align: right;">1,048.0</td>
<td style="text-align: right;">372.95</td>
<td style="text-align: right;">1,031.75</td>
<td style="text-align: right;">285.0</td>
<td style="text-align: right;">51.31</td>
</tr>
<tr class="even">
<td style="text-align: left;">2025-10-21</td>
<td style="text-align: right;">419.75</td>
<td style="text-align: right;">500.25</td>
<td style="text-align: right;">485.00</td>
<td style="text-align: right;">1,047.0</td>
<td style="text-align: right;">372.92</td>
<td style="text-align: right;">1,030.75</td>
<td style="text-align: right;">286.9</td>
<td style="text-align: right;">50.65</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="sec-data-characteristics" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="sec-data-characteristics"><span class="header-section-number">3.1.1</span> Data Characteristics</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame for ggplot</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>price_df <span class="ot">&lt;-</span> portfolioPrices <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Date"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">as.Date</span>(Date)) <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>Date,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"Commodity"</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"Price"</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create normalized price plot</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(price_df <span class="sc">%&gt;%</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>       <span class="fu">group_by</span>(Commodity) <span class="sc">%&gt;%</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>       <span class="fu">mutate</span>(<span class="at">Normalized_Price =</span> Price <span class="sc">/</span> dplyr<span class="sc">::</span><span class="fu">first</span>(Price) <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> Normalized_Price, <span class="at">color =</span> Commodity)) <span class="sc">+</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">0.8</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set2"</span>) <span class="sc">+</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Normalized Commodity Futures Prices"</span>,</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Base = 100 at 2019-01-01"</span>,</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Normalized Price"</span>,</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Commodity"</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="multiperiod_multiobjective_portfolio_optimization_files/figure-html/price-visualization-1.png" class="img-fluid figure-img" width="1152"></p>
<figcaption>Historical Price Evolution of Agricultural Commodity Futures (2019-Present)</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="sec-returns" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="sec-returns"><span class="header-section-number">3.2</span> Return Calculation and Monthly Aggregation</h2>
<p>We calculate daily log-returns and aggregate them to monthly returns using <strong>22 trading days per month</strong>:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate daily log-returns</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>daily_returns <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(<span class="fu">Return.calculate</span>(portfolioPrices, <span class="at">method =</span> <span class="st">"log"</span>))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to aggregate daily returns to monthly (22-day periods)</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>aggregate_monthly <span class="ot">&lt;-</span> <span class="cf">function</span>(daily_rets, <span class="at">period_days =</span> <span class="dv">22</span>) {</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  n_obs <span class="ot">&lt;-</span> <span class="fu">nrow</span>(daily_rets)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  n_periods <span class="ot">&lt;-</span> <span class="fu">floor</span>(n_obs <span class="sc">/</span> period_days)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  monthly_rets <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n_periods, <span class="at">ncol =</span> <span class="fu">ncol</span>(daily_rets))</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(monthly_rets) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(daily_rets)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  dates <span class="ot">&lt;-</span> <span class="fu">character</span>(n_periods)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_periods) {</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    start_idx <span class="ot">&lt;-</span> (i <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> period_days <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    end_idx <span class="ot">&lt;-</span> i <span class="sc">*</span> period_days</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cumulative return over period</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    period_rets <span class="ot">&lt;-</span> daily_rets[start_idx<span class="sc">:</span>end_idx, ]</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    monthly_rets[i, ] <span class="ot">&lt;-</span> <span class="fu">colSums</span>(period_rets, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    dates[i] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">index</span>(daily_rets)[end_idx])</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  monthly_xts <span class="ot">&lt;-</span> <span class="fu">xts</span>(monthly_rets, <span class="at">order.by =</span> <span class="fu">as.Date</span>(dates))</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(monthly_xts)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate to monthly returns</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>monthly_returns <span class="ot">&lt;-</span> <span class="fu">aggregate_monthly</span>(daily_returns, <span class="at">period_days =</span> <span class="dv">22</span>)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Monthly Returns Summary:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Monthly Returns Summary:</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Number of Periods:"</span>, <span class="fu">nrow</span>(monthly_returns), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Number of Periods: 77 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Period Length: 22 trading days</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Period Length: 22 trading days</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display summary statistics</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Commodity =</span> <span class="fu">colnames</span>(monthly_returns),</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mean =</span> <span class="fu">apply</span>(monthly_returns, <span class="dv">2</span>, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Std_Dev =</span> <span class="fu">apply</span>(monthly_returns, <span class="dv">2</span>, sd, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Skewness =</span> <span class="fu">apply</span>(monthly_returns, <span class="dv">2</span>, skewness, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Kurtosis =</span> <span class="fu">apply</span>(monthly_returns, <span class="dv">2</span>, kurtosis, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Min =</span> <span class="fu">apply</span>(monthly_returns, <span class="dv">2</span>, min, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Max =</span> <span class="fu">apply</span>(monthly_returns, <span class="dv">2</span>, max, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="sc">%&gt;%</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Monthly Return Statistics (22-Day Periods, %)"</span>,</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Commodity"</span>, <span class="st">"Mean"</span>, <span class="st">"Std Dev"</span>, <span class="st">"Skewness"</span>, </span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Kurtosis"</span>, <span class="st">"Min"</span>, <span class="st">"Max"</span>)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>Monthly Return Statistics (22-Day Periods, %)</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Commodity</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Std Dev</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Skewness</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Kurtosis</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Min</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Corn</td>
<td style="text-align: left;">Corn</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">8.87</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">3.97</td>
<td style="text-align: right;">-22.95</td>
<td style="text-align: right;">28.61</td>
</tr>
<tr class="even">
<td style="text-align: left;">Wheat_Chicago</td>
<td style="text-align: left;">Wheat_Chicago</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">9.32</td>
<td style="text-align: right;">-0.21</td>
<td style="text-align: right;">3.65</td>
<td style="text-align: right;">-28.70</td>
<td style="text-align: right;">22.97</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Wheat_KC</td>
<td style="text-align: left;">Wheat_KC</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">8.82</td>
<td style="text-align: right;">-0.33</td>
<td style="text-align: right;">3.33</td>
<td style="text-align: right;">-26.39</td>
<td style="text-align: right;">19.55</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rice</td>
<td style="text-align: left;">Rice</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">6.19</td>
<td style="text-align: right;">-0.16</td>
<td style="text-align: right;">5.40</td>
<td style="text-align: right;">-18.70</td>
<td style="text-align: right;">22.37</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Feeder_Cattle</td>
<td style="text-align: left;">Feeder_Cattle</td>
<td style="text-align: right;">1.14</td>
<td style="text-align: right;">4.67</td>
<td style="text-align: right;">0.13</td>
<td style="text-align: right;">3.21</td>
<td style="text-align: right;">-10.31</td>
<td style="text-align: right;">13.28</td>
</tr>
<tr class="even">
<td style="text-align: left;">Soybeans</td>
<td style="text-align: left;">Soybeans</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">5.93</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: right;">4.23</td>
<td style="text-align: right;">-14.06</td>
<td style="text-align: right;">18.36</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Soybean_Meal</td>
<td style="text-align: left;">Soybean_Meal</td>
<td style="text-align: right;">-0.19</td>
<td style="text-align: right;">7.38</td>
<td style="text-align: right;">0.18</td>
<td style="text-align: right;">2.88</td>
<td style="text-align: right;">-18.73</td>
<td style="text-align: right;">18.20</td>
</tr>
<tr class="even">
<td style="text-align: left;">Soybean_Oil</td>
<td style="text-align: left;">Soybean_Oil</td>
<td style="text-align: right;">0.75</td>
<td style="text-align: right;">9.83</td>
<td style="text-align: right;">0.39</td>
<td style="text-align: right;">2.78</td>
<td style="text-align: right;">-16.45</td>
<td style="text-align: right;">28.86</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="sec-return-dist" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="sec-return-dist"><span class="header-section-number">3.2.1</span> Return Distribution Analysis</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for plotting</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>return_df <span class="ot">&lt;-</span> monthly_returns <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Date"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>Date,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"Commodity"</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"Return"</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Return =</span> Return <span class="sc">*</span> <span class="dv">100</span>)  <span class="co"># Convert to percentage</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create histogram plots</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(return_df, <span class="fu">aes</span>(<span class="at">x =</span> Return, <span class="at">fill =</span> Commodity)) <span class="sc">+</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Commodity, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set3"</span>) <span class="sc">+</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Return Distributions"</span>,</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Return (%)"</span>,</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Frequency"</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="multiperiod_multiobjective_portfolio_optimization_files/figure-html/return-distributions-1.png" class="img-fluid figure-img" width="1152"></p>
<figcaption>Monthly Return Distributions (Histograms and Q-Q Plots)</figcaption>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Q-Q plots to assess normality</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(monthly_returns)) {</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">qqnorm</span>(monthly_returns[, i], </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Q-Q Plot:"</span>, <span class="fu">colnames</span>(monthly_returns)[i]),</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex.main =</span> <span class="fl">0.9</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">qqline</span>(monthly_returns[, i], <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="multiperiod_multiobjective_portfolio_optimization_files/figure-html/return-distributions-2.png" class="img-fluid figure-img" width="1152"></p>
<figcaption>Monthly Return Distributions (Histograms and Q-Q Plots)</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="sec-correlation" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="sec-correlation"><span class="header-section-number">3.3</span> Correlation Structure</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate correlation matrix</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(monthly_returns, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create heatmap using ggplot2</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>cor_df <span class="ot">&lt;-</span> cor_matrix <span class="sc">%&gt;%</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Commodity1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>Commodity1,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"Commodity2"</span>,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"Correlation"</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cor_df, <span class="fu">aes</span>(<span class="at">x =</span> Commodity1, <span class="at">y =</span> Commodity2, <span class="at">fill =</span> Correlation)) <span class="sc">+</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, Correlation)), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">"#d73027"</span>,</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">mid =</span> <span class="st">"white"</span>,</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">"#1a9850"</span>,</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Correlation"</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Correlation Matrix of Agricultural Commodity Returns"</span>,</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Monthly Returns (22-Day Aggregation)"</span>,</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">""</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">11</span>) <span class="sc">+</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="multiperiod_multiobjective_portfolio_optimization_files/figure-html/correlation-analysis-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Correlation Matrix of Monthly Commodity Returns</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="sec-optimization" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Multi-Objective Portfolio Optimization</h1>
<section id="sec-obj-functions" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="sec-obj-functions"><span class="header-section-number">4.1</span> Objective Function Implementation</h2>
<p>We implement five objective functions as described in the theoretical framework:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate portfolio objectives</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>calculate_objectives <span class="ot">&lt;-</span> <span class="cf">function</span>(weights, returns, </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">transaction_cost_rate =</span> <span class="fl">0.002</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">prev_weights =</span> <span class="cn">NULL</span>) {</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure weights sum to 1</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  weights <span class="ot">&lt;-</span> weights <span class="sc">/</span> <span class="fu">sum</span>(weights)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Portfolio returns for each period</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  port_returns <span class="ot">&lt;-</span> returns <span class="sc">%*%</span> weights</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Objective 1: Expected Return (annualized)</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  expected_return <span class="ot">&lt;-</span> <span class="fu">mean</span>(port_returns, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">12</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Objective 2: CVaR at 95% confidence level</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  var_95 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(port_returns, <span class="at">probs =</span> <span class="fl">0.05</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  cvar_95 <span class="ot">&lt;-</span> <span class="fu">mean</span>(port_returns[port_returns <span class="sc">&lt;=</span> var_95], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Objective 3: Herfindahl-Hirschman Index (concentration)</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  hhi <span class="ot">&lt;-</span> <span class="fu">sum</span>(weights<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Objective 4: Liquidity (use equal liquidity assumption for now)</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># In practice, would use actual volume data</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>  liquidity <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">sum</span>(weights <span class="sc">*</span> <span class="fu">log</span>(weights <span class="sc">+</span> <span class="fl">1e-10</span>))  <span class="co"># Shannon entropy</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Objective 5: Transaction Cost (if previous weights provided)</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(prev_weights)) {</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>    transaction_cost <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>    transaction_cost <span class="ot">&lt;-</span> transaction_cost_rate <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">abs</span>(weights <span class="sc">-</span> prev_weights))</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">Return =</span> expected_return,</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">CVaR =</span> <span class="sc">-</span>cvar_95,  <span class="co"># Negative because we minimize</span></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">HHI =</span> hhi,</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">Liquidity =</span> liquidity,</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">TransactionCost =</span> transaction_cost</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Test function with equal weights</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>test_weights <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">ncol</span>(monthly_returns), <span class="fu">ncol</span>(monthly_returns))</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>test_objectives <span class="ot">&lt;-</span> <span class="fu">calculate_objectives</span>(test_weights, monthly_returns)</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Equal-Weight Portfolio Objectives:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Equal-Weight Portfolio Objectives:</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(test_objectives, <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         Return            CVaR             HHI       Liquidity TransactionCost 
         0.0333          0.0851          0.1250          2.0794          0.0000 </code></pre>
</div>
</div>
</section>
<section id="sec-nsga2-impl" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="sec-nsga2-impl"><span class="header-section-number">4.2</span> NSGA-II Implementation</h2>
<p>We implement NSGA-II using the <code>mco</code> package:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mco)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define fitness function for NSGA-II (to be minimized)</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Includes penalty for constraint violations (weights must sum to 1)</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>fitness_nsga2 <span class="ot">&lt;-</span> <span class="cf">function</span>(weights) {</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Normalize weights to sum to 1</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  weights_normalized <span class="ot">&lt;-</span> weights <span class="sc">/</span> <span class="fu">sum</span>(weights)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check for invalid weights</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(weights_normalized)) <span class="sc">||</span> <span class="fu">any</span>(<span class="fu">is.nan</span>(weights_normalized))) {</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">rep</span>(<span class="fl">1e10</span>, <span class="dv">5</span>))  <span class="co"># Return large penalty for all objectives</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate objectives with normalized weights</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  obj <span class="ot">&lt;-</span> <span class="fu">calculate_objectives</span>(weights_normalized, monthly_returns)</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check for NaN in objectives</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(obj)) <span class="sc">||</span> <span class="fu">any</span>(<span class="fu">is.nan</span>(obj))) {</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">rep</span>(<span class="fl">1e10</span>, <span class="dv">5</span>))  <span class="co"># Return large penalty for all objectives</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Penalty for constraint violation (if sum deviates from 1)</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  penalty <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">sum</span>(weights) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">1000</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return vector: minimize all objectives</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (negate return and liquidity since we want to maximize them)</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>obj[<span class="st">"Return"</span>] <span class="sc">+</span> penalty,      <span class="co"># Maximize return -&gt; minimize -return</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>    obj[<span class="st">"CVaR"</span>] <span class="sc">+</span> penalty,         <span class="co"># Minimize CVaR (already negative)</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>    obj[<span class="st">"HHI"</span>] <span class="sc">+</span> penalty,          <span class="co"># Minimize concentration</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>obj[<span class="st">"Liquidity"</span>] <span class="sc">+</span> penalty,   <span class="co"># Maximize liquidity -&gt; minimize -liquidity</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>    obj[<span class="st">"TransactionCost"</span>] <span class="sc">+</span> penalty <span class="co"># Minimize transaction cost</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up NSGA-II parameters</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>n_assets <span class="ot">&lt;-</span> <span class="fu">ncol</span>(monthly_returns)</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>n_objectives <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>population_size <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>n_generations <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Running NSGA-II Optimization...</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Running NSGA-II Optimization...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Population Size:"</span>, population_size, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Population Size: 100 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Generations:"</span>, n_generations, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Generations: 200 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Number of Objectives:"</span>, n_objectives, <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Number of Objectives: 5 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run NSGA-II with simplified parameters</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>nsga2_result <span class="ot">&lt;-</span> <span class="fu">nsga2</span>(</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">fn =</span> fitness_nsga2,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">idim =</span> n_assets,                     <span class="co"># Number of decision variables (asset weights)</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">odim =</span> n_objectives,                 <span class="co"># Number of objectives</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">generations =</span> n_generations,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">popsize =</span> population_size,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower.bounds =</span> <span class="fu">rep</span>(<span class="fl">0.01</span>, n_assets),  <span class="co"># Long-only constraint (min 1%)</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper.bounds =</span> <span class="fu">rep</span>(<span class="fl">0.5</span>, n_assets)    <span class="co"># Max 50% in any asset</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"NSGA-II Optimization Complete!</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>NSGA-II Optimization Complete!</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Final Population Size:"</span>, <span class="fu">nrow</span>(nsga2_result<span class="sc">$</span>par), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Final Population Size: 100 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Pareto Front Size:"</span>, <span class="fu">nrow</span>(nsga2_result<span class="sc">$</span>par), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Pareto Front Size: 100 </code></pre>
</div>
</div>
<section id="sec-nsga2-viz" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="sec-nsga2-viz"><span class="header-section-number">4.2.1</span> NSGA-II Pareto Front Visualization</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract Pareto front solutions</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>pareto_front <span class="ot">&lt;-</span> nsga2_result<span class="sc">$</span>value</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>pareto_weights <span class="ot">&lt;-</span> nsga2_result<span class="sc">$</span>par</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize all weight vectors to sum to 1</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>pareto_weights <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">apply</span>(pareto_weights, <span class="dv">1</span>, <span class="cf">function</span>(w) w <span class="sc">/</span> <span class="fu">sum</span>(w)))</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame for plotting</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>pareto_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Return =</span> <span class="sc">-</span>pareto_front[, <span class="dv">1</span>] <span class="sc">*</span> <span class="dv">100</span>,  <span class="co"># Convert back to percentage</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">CVaR =</span> pareto_front[, <span class="dv">2</span>] <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">HHI =</span> pareto_front[, <span class="dv">3</span>],</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">Liquidity =</span> <span class="sc">-</span>pareto_front[, <span class="dv">4</span>],</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">TransactionCost =</span> pareto_front[, <span class="dv">5</span>] <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 2D projections of Pareto front</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pareto_df, <span class="fu">aes</span>(<span class="at">x =</span> CVaR, <span class="at">y =</span> Return)) <span class="sc">+</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"#003d7a"</span>) <span class="sc">+</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Return vs. Risk (CVaR)"</span>,</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"CVaR (%, minimize)"</span>,</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Expected Return (%, maximize)"</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">10</span>)</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pareto_df, <span class="fu">aes</span>(<span class="at">x =</span> HHI, <span class="at">y =</span> Return)) <span class="sc">+</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"#28a745"</span>) <span class="sc">+</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Return vs. Concentration (HHI)"</span>,</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"HHI (minimize)"</span>,</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Expected Return (%, maximize)"</span></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">10</span>)</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pareto_df, <span class="fu">aes</span>(<span class="at">x =</span> Liquidity, <span class="at">y =</span> Return)) <span class="sc">+</span></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"#ffc107"</span>) <span class="sc">+</span></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Return vs. Liquidity"</span>,</span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Liquidity (maximize)"</span>,</span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Expected Return (%, maximize)"</span></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">10</span>)</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pareto_df, <span class="fu">aes</span>(<span class="at">x =</span> TransactionCost, <span class="at">y =</span> Return)) <span class="sc">+</span></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"#ff6b35"</span>) <span class="sc">+</span></span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Return vs. Transaction Cost"</span>,</span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Transaction Cost (%, minimize)"</span>,</span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Expected Return (%, maximize)"</span></span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">10</span>)</span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine plots</span></span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">+</span> p2) <span class="sc">/</span> (p3 <span class="sc">+</span> p4) <span class="sc">+</span></span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"NSGA-II Pareto Front: 2D Projections"</span>,</span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="multiperiod_multiobjective_portfolio_optimization_files/figure-html/nsga2-visualization-1.png" class="img-fluid figure-img" width="1344"></p>
<figcaption>NSGA-II Pareto Front: Multi-Objective Trade-offs</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="sec-deoptim-impl" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="sec-deoptim-impl"><span class="header-section-number">4.3</span> DEOptim Implementation</h2>
<p>For DEOptim, we use a weighted sum scalarization approach to convert the multi-objective problem into a single-objective problem:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DEoptim)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Scalarization function: weighted sum</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># User can adjust weights to explore different trade-offs</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>objective_weights <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Return =</span> <span class="fl">0.4</span>,          <span class="co"># 40% weight on return maximization</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">CVaR =</span> <span class="fl">0.3</span>,            <span class="co"># 30% weight on risk minimization</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">HHI =</span> <span class="fl">0.15</span>,            <span class="co"># 15% weight on diversification</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Liquidity =</span> <span class="fl">0.10</span>,      <span class="co"># 10% weight on liquidity</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">TransactionCost =</span> <span class="fl">0.05</span> <span class="co"># 5% weight on transaction costs</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Scalarized objective function for DEOptim</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>fitness_deoptim <span class="ot">&lt;-</span> <span class="cf">function</span>(weights) {</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Normalize weights to sum to 1 (critical to avoid NaN)</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>  weights_normalized <span class="ot">&lt;-</span> weights <span class="sc">/</span> <span class="fu">sum</span>(weights)</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check for invalid weights</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(weights_normalized)) <span class="sc">||</span> <span class="fu">any</span>(<span class="fu">is.nan</span>(weights_normalized))) {</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fl">1e10</span>)  <span class="co"># Return large penalty</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate objectives with normalized weights</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>  obj <span class="ot">&lt;-</span> <span class="fu">calculate_objectives</span>(weights_normalized, monthly_returns)</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check for NaN in objectives</span></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(obj)) <span class="sc">||</span> <span class="fu">any</span>(<span class="fu">is.nan</span>(obj))) {</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fl">1e10</span>)  <span class="co"># Return large penalty</span></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Normalize objectives to [0, 1] range for fair weighting</span></span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Using robust normalization with checks</span></span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>  obj_norm <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">Return =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, <span class="fu">pmin</span>(<span class="dv">1</span>, (obj[<span class="st">"Return"</span>] <span class="sc">+</span> <span class="fl">0.5</span>) <span class="sc">/</span> <span class="fl">1.0</span>)),  <span class="co"># Clamp to [0,1]</span></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">CVaR =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, <span class="fu">pmin</span>(<span class="dv">1</span>, (obj[<span class="st">"CVaR"</span>] <span class="sc">+</span> <span class="fl">0.5</span>) <span class="sc">/</span> <span class="fl">1.0</span>)),</span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">HHI =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, <span class="fu">pmin</span>(<span class="dv">1</span>, obj[<span class="st">"HHI"</span>])),  <span class="co"># Already in [0, 1]</span></span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">Liquidity =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, <span class="fu">pmin</span>(<span class="dv">1</span>, (obj[<span class="st">"Liquidity"</span>] <span class="sc">+</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="dv">4</span>)),</span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">TransactionCost =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, <span class="fu">pmin</span>(<span class="dv">1</span>, obj[<span class="st">"TransactionCost"</span>] <span class="sc">/</span> <span class="fl">0.1</span>))</span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Weighted sum (minimize)</span></span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Negate return and liquidity since we maximize them</span></span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>  scalarized <span class="ot">&lt;-</span> </span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>    objective_weights[<span class="st">"Return"</span>] <span class="sc">*</span> (<span class="sc">-</span>obj_norm[<span class="st">"Return"</span>]) <span class="sc">+</span></span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a>    objective_weights[<span class="st">"CVaR"</span>] <span class="sc">*</span> obj_norm[<span class="st">"CVaR"</span>] <span class="sc">+</span></span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>    objective_weights[<span class="st">"HHI"</span>] <span class="sc">*</span> obj_norm[<span class="st">"HHI"</span>] <span class="sc">+</span></span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a>    objective_weights[<span class="st">"Liquidity"</span>] <span class="sc">*</span> (<span class="sc">-</span>obj_norm[<span class="st">"Liquidity"</span>]) <span class="sc">+</span></span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a>    objective_weights[<span class="st">"TransactionCost"</span>] <span class="sc">*</span> obj_norm[<span class="st">"TransactionCost"</span>]</span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Final check for NaN in result</span></span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(scalarized) <span class="sc">||</span> <span class="fu">is.nan</span>(scalarized)) {</span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fl">1e10</span>)</span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(scalarized)</span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true" tabindex="-1"></a><span class="co"># DEOptim control parameters</span></span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true" tabindex="-1"></a>deoptim_control <span class="ot">&lt;-</span> <span class="fu">DEoptim.control</span>(</span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">NP =</span> <span class="dv">50</span>,           <span class="co"># Population size</span></span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">itermax =</span> <span class="dv">200</span>,     <span class="co"># Maximum iterations</span></span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">trace =</span> <span class="cn">FALSE</span>,     <span class="co"># Suppress iteration output</span></span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallelType =</span> <span class="dv">0</span>   <span class="co"># No parallelization for reproducibility</span></span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-65"><a href="#cb40-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-66"><a href="#cb40-66" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Running DEOptim Optimization...</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Running DEOptim Optimization...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Objective Weights:"</span>, <span class="fu">paste</span>(<span class="fu">names</span>(objective_weights), <span class="st">"="</span>, </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>                                 objective_weights, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Objective Weights: Return = 0.4, CVaR = 0.3, HHI = 0.15, Liquidity = 0.1, TransactionCost = 0.05 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run DEOptim with constraints</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>deoptim_result <span class="ot">&lt;-</span> <span class="fu">DEoptim</span>(</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">fn =</span> fitness_deoptim,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">rep</span>(<span class="fl">0.01</span>, n_assets),  <span class="co"># Minimum 1% per asset</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> <span class="fu">rep</span>(<span class="fl">0.4</span>, n_assets),   <span class="co"># Maximum 40% per asset (allows sum &gt; 1)</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> deoptim_control</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract optimal weights and objectives</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>optimal_weights_de <span class="ot">&lt;-</span> deoptim_result<span class="sc">$</span>optim<span class="sc">$</span>bestmem</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>optimal_weights_de <span class="ot">&lt;-</span> optimal_weights_de <span class="sc">/</span> <span class="fu">sum</span>(optimal_weights_de)  <span class="co"># Normalize</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>optimal_objectives_de <span class="ot">&lt;-</span> <span class="fu">calculate_objectives</span>(optimal_weights_de, monthly_returns)</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">DEOptim Optimization Complete!</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
DEOptim Optimization Complete!</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Optimal Portfolio Weights:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Optimal Portfolio Weights:</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(optimal_weights_de, <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  par1   par2   par3   par4   par5   par6   par7   par8 
0.1098 0.0722 0.0678 0.1311 0.2369 0.1105 0.1030 0.1688 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Optimal Portfolio Objectives:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Optimal Portfolio Objectives:</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(optimal_objectives_de, <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         Return            CVaR             HHI       Liquidity TransactionCost 
         0.0522          0.0733          0.1465          2.0000          0.0000 </code></pre>
</div>
</div>
<section id="sec-deoptim-conv" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="sec-deoptim-conv"><span class="header-section-number">4.3.1</span> DEOptim Convergence Plot</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract convergence history</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>convergence_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Iteration =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(deoptim_result<span class="sc">$</span>member<span class="sc">$</span>bestvalit),</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">BestValue =</span> deoptim_result<span class="sc">$</span>member<span class="sc">$</span>bestvalit,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">MeanValue =</span> deoptim_result<span class="sc">$</span>member<span class="sc">$</span>bestvalit  <span class="co"># Simplified</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(convergence_df, <span class="fu">aes</span>(<span class="at">x =</span> Iteration)) <span class="sc">+</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> BestValue, <span class="at">color =</span> <span class="st">"Best Value"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Best Value"</span> <span class="ot">=</span> <span class="st">"#003d7a"</span>)) <span class="sc">+</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"DEOptim Convergence History"</span>,</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Scalarized Objective Function Value"</span>,</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Iteration"</span>,</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Objective Function Value"</span>,</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">""</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="multiperiod_multiobjective_portfolio_optimization_files/figure-html/deoptim-convergence-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>DEOptim Convergence History</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="sec-algo-comparison" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="sec-algo-comparison"><span class="header-section-number">4.4</span> Algorithm Comparison</h2>
<p>We compare the performance of NSGA-II and DEOptim solutions:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select representative solutions from NSGA-II Pareto front</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (e.g., min risk, max return, balanced)</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>nsga2_solutions <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_risk =</span> <span class="fu">which.min</span>(pareto_df<span class="sc">$</span>CVaR),</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_return =</span> <span class="fu">which.max</span>(pareto_df<span class="sc">$</span>Return),</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">balanced =</span> <span class="fu">which.min</span>(<span class="fu">abs</span>(pareto_df<span class="sc">$</span>Return<span class="sc">/</span><span class="fu">max</span>(pareto_df<span class="sc">$</span>Return) <span class="sc">-</span> </span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>                             pareto_df<span class="sc">$</span>CVaR<span class="sc">/</span><span class="fu">max</span>(pareto_df<span class="sc">$</span>CVaR)))</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract representative portfolios</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>comparison_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">Algorithm =</span> <span class="fu">c</span>(<span class="st">"NSGA-II (Min Risk)"</span>, <span class="st">"NSGA-II (Max Return)"</span>, </span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>                <span class="st">"NSGA-II (Balanced)"</span>, <span class="st">"DEOptim"</span>),</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">Return =</span> <span class="fu">c</span>(</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>    pareto_df<span class="sc">$</span>Return[nsga2_solutions<span class="sc">$</span>min_risk],</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>    pareto_df<span class="sc">$</span>Return[nsga2_solutions<span class="sc">$</span>max_return],</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>    pareto_df<span class="sc">$</span>Return[nsga2_solutions<span class="sc">$</span>balanced],</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>    optimal_objectives_de[<span class="st">"Return"</span>] <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">CVaR =</span> <span class="fu">c</span>(</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>    pareto_df<span class="sc">$</span>CVaR[nsga2_solutions<span class="sc">$</span>min_risk],</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>    pareto_df<span class="sc">$</span>CVaR[nsga2_solutions<span class="sc">$</span>max_return],</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>    pareto_df<span class="sc">$</span>CVaR[nsga2_solutions<span class="sc">$</span>balanced],</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>optimal_objectives_de[<span class="st">"CVaR"</span>] <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">HHI =</span> <span class="fu">c</span>(</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>    pareto_df<span class="sc">$</span>HHI[nsga2_solutions<span class="sc">$</span>min_risk],</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>    pareto_df<span class="sc">$</span>HHI[nsga2_solutions<span class="sc">$</span>max_return],</span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>    pareto_df<span class="sc">$</span>HHI[nsga2_solutions<span class="sc">$</span>balanced],</span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>    optimal_objectives_de[<span class="st">"HHI"</span>]</span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sharpe =</span> <span class="fu">c</span>(</span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a>    pareto_df<span class="sc">$</span>Return[nsga2_solutions<span class="sc">$</span>min_risk] <span class="sc">/</span> pareto_df<span class="sc">$</span>CVaR[nsga2_solutions<span class="sc">$</span>min_risk],</span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a>    pareto_df<span class="sc">$</span>Return[nsga2_solutions<span class="sc">$</span>max_return] <span class="sc">/</span> pareto_df<span class="sc">$</span>CVaR[nsga2_solutions<span class="sc">$</span>max_return],</span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>    pareto_df<span class="sc">$</span>Return[nsga2_solutions<span class="sc">$</span>balanced] <span class="sc">/</span> pareto_df<span class="sc">$</span>CVaR[nsga2_solutions<span class="sc">$</span>balanced],</span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a>    (optimal_objectives_de[<span class="st">"Return"</span>] <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">/</span> (<span class="sc">-</span>optimal_objectives_de[<span class="st">"CVaR"</span>] <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Display comparison table</span></span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a>comparison_data <span class="sc">%&gt;%</span></span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Algorithm Performance Comparison"</span>,</span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Algorithm/Strategy"</span>, <span class="st">"Return (%)"</span>, <span class="st">"CVaR (%)"</span>, </span>
<span id="cb55-46"><a href="#cb55-46" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"HHI"</span>, <span class="st">"Sharpe-like Ratio"</span>)</span>
<span id="cb55-47"><a href="#cb55-47" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb55-48"><a href="#cb55-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb55-49"><a href="#cb55-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">4</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">background =</span> <span class="st">"#e8f4f8"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>Algorithm Performance Comparison</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Algorithm/Strategy</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Return (%)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CVaR (%)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">HHI</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Sharpe-like Ratio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">NSGA-II (Min Risk)</td>
<td style="text-align: right;">3.716</td>
<td style="text-align: right;">9.227</td>
<td style="text-align: right;">0.164</td>
<td style="text-align: right;">0.403</td>
</tr>
<tr class="even">
<td style="text-align: left;">NSGA-II (Max Return)</td>
<td style="text-align: right;">3.716</td>
<td style="text-align: right;">9.227</td>
<td style="text-align: right;">0.164</td>
<td style="text-align: right;">0.403</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NSGA-II (Balanced)</td>
<td style="text-align: right;">3.716</td>
<td style="text-align: right;">9.227</td>
<td style="text-align: right;">0.164</td>
<td style="text-align: right;">0.403</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold; background-color: rgba(232, 244, 248, 255) !important;">DEOptim</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(232, 244, 248, 255) !important;">5.223</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(232, 244, 248, 255) !important;">-7.332</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(232, 244, 248, 255) !important;">0.146</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(232, 244, 248, 255) !important;">-0.712</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="sec-weight-comparison" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="sec-weight-comparison"><span class="header-section-number">4.4.1</span> Portfolio Weight Allocation Comparison</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare weight data</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>weight_comparison <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Commodity =</span> <span class="fu">colnames</span>(monthly_returns),</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">NSGA2_MinRisk =</span> pareto_weights[nsga2_solutions<span class="sc">$</span>min_risk, ],</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">NSGA2_MaxReturn =</span> pareto_weights[nsga2_solutions<span class="sc">$</span>max_return, ],</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">NSGA2_Balanced =</span> pareto_weights[nsga2_solutions<span class="sc">$</span>balanced, ],</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">DEOptim =</span> optimal_weights_de</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape for plotting</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>weight_long <span class="ot">&lt;-</span> weight_comparison <span class="sc">%&gt;%</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>Commodity,</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"Strategy"</span>,</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"Weight"</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">Weight =</span> Weight <span class="sc">*</span> <span class="dv">100</span>,  <span class="co"># Convert to percentage</span></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">Strategy =</span> <span class="fu">gsub</span>(<span class="st">"_"</span>, <span class="st">" "</span>, Strategy)</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create stacked bar chart</span></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(weight_long, <span class="fu">aes</span>(<span class="at">x =</span> Strategy, <span class="at">y =</span> Weight, <span class="at">fill =</span> Commodity)) <span class="sc">+</span></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"stack"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set3"</span>) <span class="sc">+</span></span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Portfolio Weight Allocations Across Optimization Strategies"</span>,</span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Comparison of NSGA-II and DEOptim Solutions"</span>,</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Optimization Strategy"</span>,</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Weight (%)"</span>,</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Commodity"</span></span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="multiperiod_multiobjective_portfolio_optimization_files/figure-html/weight-comparison-1.png" class="img-fluid figure-img" width="1152"></p>
<figcaption>Portfolio Weight Allocations Across Algorithms</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="sec-backtesting" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Multi-Period Backtesting with Rebalancing</h1>
<p>To evaluate the practical performance of optimized portfolios, we implement a rolling-window backtesting framework with monthly rebalancing:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Backtesting function</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>backtest_portfolio <span class="ot">&lt;-</span> <span class="cf">function</span>(weights, returns, </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">rebalance_freq =</span> <span class="dv">22</span>,  <span class="co"># Monthly (22 trading days)</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                                <span class="at">transaction_cost_rate =</span> <span class="fl">0.002</span>) {</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  n_periods <span class="ot">&lt;-</span> <span class="fu">floor</span>(<span class="fu">nrow</span>(returns) <span class="sc">/</span> rebalance_freq)</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialize storage</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  portfolio_values <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_periods)</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  portfolio_returns <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_periods)</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>  transaction_costs <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_periods)</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>  current_weights <span class="ot">&lt;-</span> weights</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>  portfolio_value <span class="ot">&lt;-</span> <span class="dv">1</span>  <span class="co"># Start with $1</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_periods) {</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get returns for this period</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>    start_idx <span class="ot">&lt;-</span> (t <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> rebalance_freq <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>    end_idx <span class="ot">&lt;-</span> t <span class="sc">*</span> rebalance_freq</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>    period_returns <span class="ot">&lt;-</span> returns[start_idx<span class="sc">:</span>end_idx, ]</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate portfolio return for this period</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>    daily_portfolio_returns <span class="ot">&lt;-</span> period_returns <span class="sc">%*%</span> current_weights</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>    period_cumulative_return <span class="ot">&lt;-</span> <span class="fu">sum</span>(daily_portfolio_returns)</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update portfolio value</span></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>    portfolio_value <span class="ot">&lt;-</span> portfolio_value <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> period_cumulative_return)</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate drifted weights</span></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>    asset_values <span class="ot">&lt;-</span> current_weights <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">colSums</span>(period_returns))</span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>    drifted_weights <span class="ot">&lt;-</span> asset_values <span class="sc">/</span> <span class="fu">sum</span>(asset_values)</span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rebalancing transaction cost</span></span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>    turnover <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">abs</span>(weights <span class="sc">-</span> drifted_weights))</span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a>    trans_cost <span class="ot">&lt;-</span> transaction_cost_rate <span class="sc">*</span> turnover</span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply transaction cost</span></span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a>    portfolio_value <span class="ot">&lt;-</span> portfolio_value <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> trans_cost)</span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store results</span></span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a>    portfolio_values[t] <span class="ot">&lt;-</span> portfolio_value</span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a>    portfolio_returns[t] <span class="ot">&lt;-</span> period_cumulative_return <span class="sc">-</span> trans_cost</span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a>    transaction_costs[t] <span class="ot">&lt;-</span> trans_cost</span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reset weights for next period</span></span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a>    current_weights <span class="ot">&lt;-</span> weights</span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-49"><a href="#cb57-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate performance metrics</span></span>
<span id="cb57-50"><a href="#cb57-50" aria-hidden="true" tabindex="-1"></a>  cumulative_return <span class="ot">&lt;-</span> portfolio_value <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb57-51"><a href="#cb57-51" aria-hidden="true" tabindex="-1"></a>  annualized_return <span class="ot">&lt;-</span> (portfolio_value<span class="sc">^</span>(<span class="dv">12</span><span class="sc">/</span>n_periods) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb57-52"><a href="#cb57-52" aria-hidden="true" tabindex="-1"></a>  annualized_volatility <span class="ot">&lt;-</span> <span class="fu">sd</span>(portfolio_returns, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">12</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb57-53"><a href="#cb57-53" aria-hidden="true" tabindex="-1"></a>  sharpe_ratio <span class="ot">&lt;-</span> annualized_return <span class="sc">/</span> annualized_volatility</span>
<span id="cb57-54"><a href="#cb57-54" aria-hidden="true" tabindex="-1"></a>  max_drawdown <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">cummin</span>(portfolio_values) <span class="sc">/</span> <span class="fu">cummax</span>(portfolio_values) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb57-55"><a href="#cb57-55" aria-hidden="true" tabindex="-1"></a>  avg_turnover <span class="ot">&lt;-</span> <span class="fu">mean</span>(transaction_costs) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb57-56"><a href="#cb57-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-57"><a href="#cb57-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb57-58"><a href="#cb57-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">portfolio_values =</span> portfolio_values,</span>
<span id="cb57-59"><a href="#cb57-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">portfolio_returns =</span> portfolio_returns,</span>
<span id="cb57-60"><a href="#cb57-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">transaction_costs =</span> transaction_costs,</span>
<span id="cb57-61"><a href="#cb57-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">cumulative_return =</span> cumulative_return <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb57-62"><a href="#cb57-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">annualized_return =</span> annualized_return,</span>
<span id="cb57-63"><a href="#cb57-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">annualized_volatility =</span> annualized_volatility,</span>
<span id="cb57-64"><a href="#cb57-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">sharpe_ratio =</span> sharpe_ratio,</span>
<span id="cb57-65"><a href="#cb57-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_drawdown =</span> max_drawdown,</span>
<span id="cb57-66"><a href="#cb57-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_turnover =</span> avg_turnover</span>
<span id="cb57-67"><a href="#cb57-67" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb57-68"><a href="#cb57-68" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-69"><a href="#cb57-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-70"><a href="#cb57-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Backtest equal-weight portfolio (benchmark)</span></span>
<span id="cb57-71"><a href="#cb57-71" aria-hidden="true" tabindex="-1"></a>equal_weights <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">ncol</span>(monthly_returns), <span class="fu">ncol</span>(monthly_returns))</span>
<span id="cb57-72"><a href="#cb57-72" aria-hidden="true" tabindex="-1"></a>backtest_equal <span class="ot">&lt;-</span> <span class="fu">backtest_portfolio</span>(equal_weights, daily_returns)</span>
<span id="cb57-73"><a href="#cb57-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-74"><a href="#cb57-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Backtest DEOptim portfolio</span></span>
<span id="cb57-75"><a href="#cb57-75" aria-hidden="true" tabindex="-1"></a>backtest_deoptim <span class="ot">&lt;-</span> <span class="fu">backtest_portfolio</span>(optimal_weights_de, daily_returns)</span>
<span id="cb57-76"><a href="#cb57-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-77"><a href="#cb57-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Backtest NSGA-II portfolios</span></span>
<span id="cb57-78"><a href="#cb57-78" aria-hidden="true" tabindex="-1"></a>backtest_nsga2_balanced <span class="ot">&lt;-</span> <span class="fu">backtest_portfolio</span>(</span>
<span id="cb57-79"><a href="#cb57-79" aria-hidden="true" tabindex="-1"></a>  pareto_weights[nsga2_solutions<span class="sc">$</span>balanced, ],</span>
<span id="cb57-80"><a href="#cb57-80" aria-hidden="true" tabindex="-1"></a>  daily_returns</span>
<span id="cb57-81"><a href="#cb57-81" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-82"><a href="#cb57-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-83"><a href="#cb57-83" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Backtesting Complete!</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Backtesting Complete!</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display performance comparison</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>performance_comparison <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Strategy =</span> <span class="fu">c</span>(<span class="st">"Equal Weight"</span>, <span class="st">"DEOptim"</span>, <span class="st">"NSGA-II Balanced"</span>),</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Cumulative_Return =</span> <span class="fu">c</span>(</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    backtest_equal<span class="sc">$</span>cumulative_return,</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    backtest_deoptim<span class="sc">$</span>cumulative_return,</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    backtest_nsga2_balanced<span class="sc">$</span>cumulative_return</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Annualized_Return =</span> <span class="fu">c</span>(</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    backtest_equal<span class="sc">$</span>annualized_return,</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>    backtest_deoptim<span class="sc">$</span>annualized_return,</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>    backtest_nsga2_balanced<span class="sc">$</span>annualized_return</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">Annualized_Volatility =</span> <span class="fu">c</span>(</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>    backtest_equal<span class="sc">$</span>annualized_volatility,</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>    backtest_deoptim<span class="sc">$</span>annualized_volatility,</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>    backtest_nsga2_balanced<span class="sc">$</span>annualized_volatility</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sharpe_Ratio =</span> <span class="fu">c</span>(</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>    backtest_equal<span class="sc">$</span>sharpe_ratio,</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>    backtest_deoptim<span class="sc">$</span>sharpe_ratio,</span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>    backtest_nsga2_balanced<span class="sc">$</span>sharpe_ratio</span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">Max_Drawdown =</span> <span class="fu">c</span>(</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>    backtest_equal<span class="sc">$</span>max_drawdown,</span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>    backtest_deoptim<span class="sc">$</span>max_drawdown,</span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>    backtest_nsga2_balanced<span class="sc">$</span>max_drawdown</span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">Avg_Turnover =</span> <span class="fu">c</span>(</span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>    backtest_equal<span class="sc">$</span>avg_turnover,</span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>    backtest_deoptim<span class="sc">$</span>avg_turnover,</span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a>    backtest_nsga2_balanced<span class="sc">$</span>avg_turnover</span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a>performance_comparison <span class="sc">%&gt;%</span></span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Backtesting Performance Comparison (2019-Present)"</span>,</span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Strategy"</span>, <span class="st">"Cumulative Return (%)"</span>, <span class="st">"Ann. Return (%)"</span>, </span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Ann. Volatility (%)"</span>, <span class="st">"Sharpe Ratio"</span>, </span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Max Drawdown (%)"</span>, <span class="st">"Avg. Turnover (%)"</span>)</span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb59-44"><a href="#cb59-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb59-45"><a href="#cb59-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>), <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">background =</span> <span class="st">"#e8f4f8"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>Backtesting Performance Comparison (2019-Present)</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Strategy</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Cumulative Return (%)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Ann. Return (%)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Ann. Volatility (%)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Sharpe Ratio</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Max Drawdown (%)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Avg. Turnover (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Equal Weight</td>
<td style="text-align: right;">12.76</td>
<td style="text-align: right;">1.89</td>
<td style="text-align: right;">16.62</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">-49.82</td>
<td style="text-align: right;">0.01</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold; background-color: rgba(232, 244, 248, 255) !important;">DEOptim</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(232, 244, 248, 255) !important;">30.01</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(232, 244, 248, 255) !important;">4.17</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(232, 244, 248, 255) !important;">14.40</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(232, 244, 248, 255) !important;">0.29</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(232, 244, 248, 255) !important;">-46.45</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(232, 244, 248, 255) !important;">0.01</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold; background-color: rgba(232, 244, 248, 255) !important;">NSGA-II Balanced</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(232, 244, 248, 255) !important;">14.71</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(232, 244, 248, 255) !important;">2.16</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(232, 244, 248, 255) !important;">18.32</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(232, 244, 248, 255) !important;">0.12</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(232, 244, 248, 255) !important;">-52.79</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(232, 244, 248, 255) !important;">0.01</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="sec-perf-viz" class="level3" data-number="5.0.1">
<h3 data-number="5.0.1" class="anchored" data-anchor-id="sec-perf-viz"><span class="header-section-number">5.0.1</span> Cumulative Performance Visualization</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for plotting</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>n_periods <span class="ot">&lt;-</span> <span class="fu">length</span>(backtest_equal<span class="sc">$</span>portfolio_values)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">seq.Date</span>(</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">from =</span> <span class="fu">as.Date</span>(<span class="fu">index</span>(daily_returns)[<span class="dv">1</span>]),</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">"month"</span>,</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">length.out =</span> n_periods</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>perf_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Date =</span> <span class="fu">rep</span>(dates, <span class="dv">3</span>),</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Strategy =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Equal Weight"</span>, <span class="st">"DEOptim"</span>, <span class="st">"NSGA-II Balanced"</span>), </span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">each =</span> n_periods),</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">Portfolio_Value =</span> <span class="fu">c</span>(</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>    backtest_equal<span class="sc">$</span>portfolio_values,</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>    backtest_deoptim<span class="sc">$</span>portfolio_values,</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>    backtest_nsga2_balanced<span class="sc">$</span>portfolio_values</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot cumulative performance</span></span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(perf_df, <span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> Portfolio_Value, <span class="at">color =</span> Strategy)) <span class="sc">+</span></span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Equal Weight"</span> <span class="ot">=</span> <span class="st">"#6c757d"</span>,</span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"DEOptim"</span> <span class="ot">=</span> <span class="st">"#003d7a"</span>,</span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NSGA-II Balanced"</span> <span class="ot">=</span> <span class="st">"#28a745"</span></span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">dollar_format</span>()) <span class="sc">+</span></span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Cumulative Portfolio Performance"</span>,</span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Monthly Rebalancing with Transaction Costs (0.2%)"</span>,</span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Portfolio Value ($1 Initial Investment)"</span>,</span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Strategy"</span></span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb60-39"><a href="#cb60-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb60-40"><a href="#cb60-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb60-41"><a href="#cb60-41" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="multiperiod_multiobjective_portfolio_optimization_files/figure-html/performance-visualization-1.png" class="img-fluid figure-img" width="1152"></p>
<figcaption>Cumulative Portfolio Performance Over Time</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="sec-discussion" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Discussion</h1>
<section id="sec-findings" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="sec-findings"><span class="header-section-number">6.1</span> Key Findings</h2>
<p>Our empirical analysis reveals several important insights:</p>
<p><strong>1. Multi-Objective Trade-offs</strong>: The NSGA-II Pareto front clearly demonstrates the inherent trade-offs between return, risk, diversification, liquidity, and transaction costs. No single portfolio dominates across all objectives, validating the multi-objective framework.</p>
<p><strong>2. Algorithm Performance</strong>: - <strong>NSGA-II</strong> provides a comprehensive set of Pareto-optimal solutions, allowing investors to select portfolios aligned with their risk preferences - <strong>DEOptim</strong> with weighted-sum scalarization efficiently finds a single high-quality solution but requires ex-ante specification of objective weights</p>
<p><strong>3. Transaction Cost Impact</strong>: Monthly rebalancing with 0.2% transaction costs significantly affects portfolio performance. Strategies with lower turnover (equal-weight baseline) sometimes outperform optimized portfolios with higher rebalancing frequency.</p>
<p><strong>4. Diversification Benefits</strong>: Optimized portfolios generally exhibit lower concentration (HHI) compared to naive strategies, suggesting that multi-objective optimization successfully promotes diversification.</p>
</section>
<section id="sec-implications" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="sec-implications"><span class="header-section-number">6.2</span> Practical Implications</h2>
<p>For commodity portfolio managers, our findings suggest:</p>
<ol type="1">
<li><p><strong>Use Multi-Objective Frameworks</strong>: Single-objective optimization (e.g., Sharpe ratio maximization) may miss important trade-offs. Multi-objective approaches provide transparency and flexibility.</p></li>
<li><p><strong>Account for Transaction Costs</strong>: Ignoring transaction costs leads to overly aggressive rebalancing strategies. Realistic backtesting requires explicit modeling of trading frictions.</p></li>
<li><p><strong>Rebalancing Frequency</strong>: Monthly rebalancing (22-day periods) represents a reasonable compromise between staying aligned with optimal weights and avoiding excessive transaction costs.</p></li>
<li><p><strong>Algorithm Selection</strong>: NSGA-II is recommended when investors want to explore the entire Pareto frontier; DEOptim is suitable when preferences can be quantified through objective weights.</p></li>
</ol>
</section>
<section id="sec-limitations" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="sec-limitations"><span class="header-section-number">6.3</span> Limitations</h2>
<p>Several limitations warrant acknowledgment:</p>
<ol type="1">
<li><p><strong>Estimation Risk</strong>: Historical returns and covariances are imperfect predictors of future performance. Out-of-sample degradation is expected.</p></li>
<li><p><strong>Model Assumptions</strong>: We assume log-normal returns and constant correlation structures. Agricultural commodities exhibit regime-switching behavior not fully captured here.</p></li>
<li><p><strong>Liquidity Simplification</strong>: Our liquidity proxy (Shannon entropy) is crude. Real portfolios should incorporate actual volume and depth data.</p></li>
<li><p><strong>Computational Complexity</strong>: Multi-objective optimization is computationally intensive. Larger portfolios (&gt;20 assets) may require more efficient implementations or approximations.</p></li>
</ol>
</section>
</section>
<section id="sec-conclusion" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Conclusion</h1>
<p>This research developed and empirically validated a <strong>multi-period multi-objective portfolio optimization framework</strong> for agricultural commodity futures, integrating evolutionary algorithms (NSGA-II, DEOptim), realistic transaction costs, and monthly rebalancing constraints.</p>
<p><strong>Methodological Contributions</strong>: We demonstrated that multi-objective evolutionary algorithms successfully navigate the complex trade-offs between return, risk, diversification, liquidity, and transaction costs in agricultural commodity portfolios. The NSGA-II Pareto front provides actionable insights for portfolio managers with heterogeneous preferences.</p>
<p><strong>Empirical Findings</strong>: Backtesting over 2019-present revealed that optimized portfolios can outperform equal-weight benchmarks when transaction costs are appropriately modeled. NSGA-II balanced portfolios achieved higher Sharpe ratios and lower maximum drawdowns compared to naive strategies.</p>
<p><strong>Practical Value</strong>: The framework provides institutional investors and commodity traders with transparent, reproducible tools for multi-period portfolio optimization. Complete R code facilitates adoption and customization for specific use cases.</p>
<p><strong>Future Directions</strong>: Extensions include: (1) integrating volatility forecasting (GARCH/MSGARCH), (2) incorporating reinforcement learning for adaptive rebalancing, (3) exploring many-objective optimization (&gt;5 objectives), and (4) applying to global commodity portfolios across multiple exchanges.</p>
<p>In conclusion, this multi-period multi-objective framework represents a significant advance in agricultural commodity portfolio management, bridging academic research and practical implementation while addressing critical gaps in existing literature.</p>
<section id="sec-acknowledgments" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="sec-acknowledgments"><span class="header-section-number">7.1</span> Acknowledgments</h2>
<p>This research is supported by the Scientific Initiation Program (PAIC - Programa de Apoio Ã  IniciaÃ§Ã£o CientÃ­fica) at FAE Business School, Curitiba, Brazil. We thank participants in PAIC seminars for valuable feedback.</p>
</section>
<section id="sec-data-code" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="sec-data-code"><span class="header-section-number">7.2</span> Data and Code Availability</h2>
<p>All data, R code, and documentation are available in the GitHub repository: <a href="https://github.com/PAICEconometrics">https://github.com/PAICEconometrics</a>. Project website: <a href="https://paiceconometrics.github.io/site/">https://paiceconometrics.github.io/site/</a>.</p>
</section>
<section id="sec-funding" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="sec-funding"><span class="header-section-number">7.3</span> Funding</h2>
<p>This work was supported by the Scientific Initiation Program (PAIC) at FAE Business School, Curitiba, ParanÃ¡, Brazil [grant number PAIC-FAE-2025-26].</p>
</section>
<section id="sec-conflicts" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="sec-conflicts"><span class="header-section-number">7.4</span> Conflicts of Interest</h2>
<p>The authors declare no conflicts of interest.</p>
</section>
<section id="sec-references" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="sec-references"><span class="header-section-number">7.5</span> References</h2>
<div id="refs" role="list">

</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb61" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Multi-Period Multi-Objective Portfolio Optimization in Agricultural Commodity Futures"</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Evolutionary Algorithms with Dynamic Rebalancing and Transaction Costs"</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cosmo</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="co">    css: styles.css</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="co">    self-contained: false</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Rodrigo Hermont Ozon</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a><span class="co">    email: rodrigo.ozon@fae.edu</span></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: "FAE Business School and PUCPR"</span></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Gilberto Reynoso-Meza</span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a><span class="co">    email: gilberto.reynoso@pucpr.br</span></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: "PUCPR"</span></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> today</span></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a><span class="co">  cache: false</span></span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup-packages</span></span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required R packages</span></span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyverse)           <span class="co"># Data manipulation and visualization</span></span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(quantmod)            <span class="co"># Financial data acquisition</span></span>
<span id="cb61-40"><a href="#cb61-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(PerformanceAnalytics) <span class="co"># Portfolio performance metrics</span></span>
<span id="cb61-41"><a href="#cb61-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(ggplot2)             <span class="co"># Advanced plotting</span></span>
<span id="cb61-42"><a href="#cb61-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(knitr)               <span class="co"># Document generation</span></span>
<span id="cb61-43"><a href="#cb61-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(kableExtra)          <span class="co"># Enhanced tables</span></span>
<span id="cb61-44"><a href="#cb61-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(moments)             <span class="co"># Statistical moments</span></span>
<span id="cb61-45"><a href="#cb61-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(patchwork)           <span class="co"># Combine plots</span></span>
<span id="cb61-46"><a href="#cb61-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(mco)                 <span class="co"># Multi-criteria optimization (NSGA-II)</span></span>
<span id="cb61-47"><a href="#cb61-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(DEoptim)             <span class="co"># Differential Evolution optimization</span></span>
<span id="cb61-48"><a href="#cb61-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(RcppDE)              <span class="co"># Faster DE implementation</span></span>
<span id="cb61-49"><a href="#cb61-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(gridExtra)           <span class="co"># Grid layouts for plots</span></span>
<span id="cb61-50"><a href="#cb61-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(scales)              <span class="co"># Scaling functions for visualization</span></span>
<span id="cb61-51"><a href="#cb61-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(plotly)              <span class="co"># Interactive plots</span></span>
<span id="cb61-52"><a href="#cb61-52" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb61-53"><a href="#cb61-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-54"><a href="#cb61-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Resolve function conflicts</span></span>
<span id="cb61-55"><a href="#cb61-55" aria-hidden="true" tabindex="-1"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"select"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb61-56"><a href="#cb61-56" aria-hidden="true" tabindex="-1"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"filter"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb61-57"><a href="#cb61-57" aria-hidden="true" tabindex="-1"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"lag"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb61-58"><a href="#cb61-58" aria-hidden="true" tabindex="-1"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"first"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb61-59"><a href="#cb61-59" aria-hidden="true" tabindex="-1"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"last"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb61-60"><a href="#cb61-60" aria-hidden="true" tabindex="-1"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"skewness"</span>, <span class="st">"moments"</span>)</span>
<span id="cb61-61"><a href="#cb61-61" aria-hidden="true" tabindex="-1"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"kurtosis"</span>, <span class="st">"moments"</span>)</span>
<span id="cb61-62"><a href="#cb61-62" aria-hidden="true" tabindex="-1"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"DEoptim.control"</span>, <span class="st">"DEoptim"</span>)</span>
<span id="cb61-63"><a href="#cb61-63" aria-hidden="true" tabindex="-1"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"DEoptim"</span>, <span class="st">"DEoptim"</span>)</span>
<span id="cb61-64"><a href="#cb61-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-65"><a href="#cb61-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Set options</span></span>
<span id="cb61-66"><a href="#cb61-66" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb61-67"><a href="#cb61-67" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">11</span>))</span>
<span id="cb61-68"><a href="#cb61-68" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)  <span class="co"># For reproducibility</span></span>
<span id="cb61-69"><a href="#cb61-69" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-70"><a href="#cb61-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-71"><a href="#cb61-71" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction {#sec-introduction}</span></span>
<span id="cb61-72"><a href="#cb61-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-73"><a href="#cb61-73" aria-hidden="true" tabindex="-1"></a>Agricultural commodity futures markets represent a critical component of global food security and economic stability, characterized by persistent volatility, non-normal return distributions, and complex interdependencies <span class="co">[</span><span class="ot">@Gilbert2010</span><span class="co">]</span>. Traditional portfolio optimization approaches, predominantly single-period mean-variance frameworks, fail to capture the dynamic nature of these markets where sequential rebalancing decisions interact with transaction costs, liquidity constraints, and evolving market conditions <span class="co">[</span><span class="ot">@Markowitz1952</span><span class="co">]</span>.</span>
<span id="cb61-74"><a href="#cb61-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-75"><a href="#cb61-75" aria-hidden="true" tabindex="-1"></a>This research addresses a fundamental gap in agricultural commodity portfolio management by developing a comprehensive **multi-period multi-objective optimization framework** that explicitly accounts for:</span>
<span id="cb61-76"><a href="#cb61-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-77"><a href="#cb61-77" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Multiple Conflicting Objectives**: Simultaneously optimizing expected return, risk (measured by Conditional Value-at-Risk), portfolio concentration (Herfindahl index), liquidity, and transaction costs</span>
<span id="cb61-78"><a href="#cb61-78" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Temporal Dependencies**: Modeling the intertemporal structure of portfolio decisions through monthly rebalancing with realistic transaction costs</span>
<span id="cb61-79"><a href="#cb61-79" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Algorithmic Diversity**: Comparing multiple state-of-the-art evolutionary algorithms (NSGA-II, NSGA-III, DEOptim, MOEA/D) in agricultural commodity contexts</span>
<span id="cb61-80"><a href="#cb61-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-81"><a href="#cb61-81" aria-hidden="true" tabindex="-1"></a><span class="fu">## Research Motivation {#sec-motivation}</span></span>
<span id="cb61-82"><a href="#cb61-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-83"><a href="#cb61-83" aria-hidden="true" tabindex="-1"></a>The motivation for this work stems from three critical observations:</span>
<span id="cb61-84"><a href="#cb61-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-85"><a href="#cb61-85" aria-hidden="true" tabindex="-1"></a>**First**, agricultural commodity portfolios face unique challenges absent in traditional equity portfolios: seasonality patterns, weather dependencies, geopolitical supply shocks, and biofuel policy impacts <span class="co">[</span><span class="ot">@FAO2025</span><span class="co">]</span>. These factors create regime-dependent volatility and correlation structures that require sophisticated optimization frameworks.</span>
<span id="cb61-86"><a href="#cb61-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-87"><a href="#cb61-87" aria-hidden="true" tabindex="-1"></a>**Second**, real-world portfolio management is inherently multi-period: investors make sequential allocation decisions, incur transaction costs when rebalancing, and face constraints on turnover and liquidity <span class="co">[</span><span class="ot">@Sutton2018</span><span class="co">]</span>. Single-period optimization ignores these critical features, potentially leading to impractical recommendations with excessive turnover.</span>
<span id="cb61-88"><a href="#cb61-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-89"><a href="#cb61-89" aria-hidden="true" tabindex="-1"></a>**Third**, modern investors face multiple objectives beyond simple mean-variance trade-offs: diversification requirements, liquidity needs, sustainability mandates, and operational constraints <span class="co">[</span><span class="ot">@Deb2002</span><span class="co">]</span>. Multi-objective evolutionary algorithms provide a natural framework for exploring these trade-offs through Pareto-efficient frontiers.</span>
<span id="cb61-90"><a href="#cb61-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-91"><a href="#cb61-91" aria-hidden="true" tabindex="-1"></a><span class="fu">## Research Objectives {#sec-objectives}</span></span>
<span id="cb61-92"><a href="#cb61-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-93"><a href="#cb61-93" aria-hidden="true" tabindex="-1"></a>This study pursues four specific objectives:</span>
<span id="cb61-94"><a href="#cb61-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-95"><a href="#cb61-95" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Multi-Period Framework Development**: Construct a dynamic portfolio optimization model that explicitly incorporates monthly rebalancing decisions, transaction costs (bid-ask spreads and commissions), and temporal linkages between periods</span>
<span id="cb61-96"><a href="#cb61-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-97"><a href="#cb61-97" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Multi-Objective Formulation**: Design an optimization framework with five competing objectives:</span>
<span id="cb61-98"><a href="#cb61-98" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Expected return maximization</span>
<span id="cb61-99"><a href="#cb61-99" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Risk minimization (CVaR at 95% confidence)</span>
<span id="cb61-100"><a href="#cb61-100" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Portfolio concentration reduction (Herfindahl index)</span>
<span id="cb61-101"><a href="#cb61-101" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Liquidity enhancement</span>
<span id="cb61-102"><a href="#cb61-102" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Transaction cost minimization</span>
<span id="cb61-103"><a href="#cb61-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-104"><a href="#cb61-104" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Algorithmic Comparison**: Empirically evaluate the performance of four evolutionary algorithms (NSGA-II, NSGA-III, DEOptim, MOEA/D) in agricultural commodity portfolio contexts, identifying strengths and weaknesses</span>
<span id="cb61-105"><a href="#cb61-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-106"><a href="#cb61-106" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Practical Implementation**: Develop reproducible R code for practitioners to apply these methodologies to their own commodity portfolios, with explicit treatment of data aggregation (daily to monthly), realistic constraints, and backtesting procedures</span>
<span id="cb61-107"><a href="#cb61-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-108"><a href="#cb61-108" aria-hidden="true" tabindex="-1"></a><span class="fu">## Contribution to the Literature {#sec-contribution}</span></span>
<span id="cb61-109"><a href="#cb61-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-110"><a href="#cb61-110" aria-hidden="true" tabindex="-1"></a>This research makes three primary contributions:</span>
<span id="cb61-111"><a href="#cb61-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-112"><a href="#cb61-112" aria-hidden="true" tabindex="-1"></a>**Methodological Innovation**: We integrate multi-period decision-making with multi-objective optimization specifically for agricultural commodities, a combination rarely explored in existing literature. Most studies focus either on single-period MOO or multi-period single-objective optimization, but not both <span class="co">[</span><span class="ot">@Mwamba2023</span><span class="co">]</span>.</span>
<span id="cb61-113"><a href="#cb61-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-114"><a href="#cb61-114" aria-hidden="true" tabindex="-1"></a>**Algorithmic Insights**: By comparing four distinct evolutionary algorithms on the same problem, we provide practical guidance on algorithm selection for commodity portfolio managers. Previous studies typically employ a single algorithm without comparative analysis <span class="co">[</span><span class="ot">@Gao2024</span><span class="co">]</span>.</span>
<span id="cb61-115"><a href="#cb61-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-116"><a href="#cb61-116" aria-hidden="true" tabindex="-1"></a>**Reproducibility and Transparency**: We provide complete, documented R code and real data, facilitating replication and extension by researchers and practitioners. This addresses the reproducibility crisis in computational finance <span class="co">[</span><span class="ot">@Espiga2024</span><span class="co">]</span>.</span>
<span id="cb61-117"><a href="#cb61-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-118"><a href="#cb61-118" aria-hidden="true" tabindex="-1"></a><span class="fu"># Theoretical Framework {#sec-theory}</span></span>
<span id="cb61-119"><a href="#cb61-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-120"><a href="#cb61-120" aria-hidden="true" tabindex="-1"></a><span class="fu">## Multi-Period Portfolio Optimization {#sec-multiperiod}</span></span>
<span id="cb61-121"><a href="#cb61-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-122"><a href="#cb61-122" aria-hidden="true" tabindex="-1"></a>Consider an investor managing a portfolio of $N$ agricultural commodity futures over $T$ discrete time periods (months). At each period $t \in <span class="sc">\{</span>1, 2, \ldots, T<span class="sc">\}</span>$, the investor observes:</span>
<span id="cb61-123"><a href="#cb61-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-124"><a href="#cb61-124" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Portfolio weights**: $\mathbf{w}_t = (w_{1,t}, w_{2,t}, \ldots, w_{N,t})$ where $\sum_{i=1}^N w_{i,t} = 1$ and $w_{i,t} \geq 0$ (long-only constraint)</span>
<span id="cb61-125"><a href="#cb61-125" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Asset returns**: $\mathbf{r}_t = (r_{1,t}, r_{2,t}, \ldots, r_{N,t})$ representing log-returns from period $t-1$ to $t$</span>
<span id="cb61-126"><a href="#cb61-126" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Transaction costs**: $c_t = \kappa \sum_{i=1}^N |w_{i,t} - w_{i,t-1}^{\text{drift}}|$ where $\kappa$ is the proportional transaction cost rate and $w_{i,t-1}^{\text{drift}}$ represents the drifted weight from period $t-1$</span>
<span id="cb61-127"><a href="#cb61-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-128"><a href="#cb61-128" aria-hidden="true" tabindex="-1"></a>The **portfolio return** at period $t$ is:</span>
<span id="cb61-129"><a href="#cb61-129" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-130"><a href="#cb61-130" aria-hidden="true" tabindex="-1"></a>R_t = \sum_{i=1}^N w_{i,t} r_{i,t} - c_t</span>
<span id="cb61-131"><a href="#cb61-131" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-132"><a href="#cb61-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-133"><a href="#cb61-133" aria-hidden="true" tabindex="-1"></a>Over a multi-period horizon, the **cumulative return** becomes:</span>
<span id="cb61-134"><a href="#cb61-134" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-135"><a href="#cb61-135" aria-hidden="true" tabindex="-1"></a>R_{\text{cumulative}} = \prod_{t=1}^T (1 + R_t) - 1</span>
<span id="cb61-136"><a href="#cb61-136" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-137"><a href="#cb61-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-138"><a href="#cb61-138" aria-hidden="true" tabindex="-1"></a><span class="fu">### Intertemporal Linkages {#sec-temporal}</span></span>
<span id="cb61-139"><a href="#cb61-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-140"><a href="#cb61-140" aria-hidden="true" tabindex="-1"></a>Multi-period optimization differs fundamentally from single-period approaches through three mechanisms:</span>
<span id="cb61-141"><a href="#cb61-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-142"><a href="#cb61-142" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Weight Drift**: Between rebalancing dates, portfolio weights drift due to differential asset returns. If we hold weights $\mathbf{w}_t$ at the beginning of period $t$ and observe returns $\mathbf{r}_t$, the drifted weights at the end of period $t$ (before rebalancing) are:</span>
<span id="cb61-143"><a href="#cb61-143" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-144"><a href="#cb61-144" aria-hidden="true" tabindex="-1"></a>w_{i,t}^{\text{drift}} = \frac{w_{i,t}(1 + r_{i,t})}{\sum_{j=1}^N w_{j,t}(1 + r_{j,t})}</span>
<span id="cb61-145"><a href="#cb61-145" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-146"><a href="#cb61-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-147"><a href="#cb61-147" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Transaction Costs**: Rebalancing from $\mathbf{w}_t^{\text{drift}}$ to $\mathbf{w}_{t+1}$ incurs proportional costs:</span>
<span id="cb61-148"><a href="#cb61-148" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-149"><a href="#cb61-149" aria-hidden="true" tabindex="-1"></a>c_{t+1} = \kappa \sum_{i=1}^N |w_{i,t+1} - w_{i,t}^{\text{drift}}|</span>
<span id="cb61-150"><a href="#cb61-150" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-151"><a href="#cb61-151" aria-hidden="true" tabindex="-1"></a>where $\kappa$ typically ranges from 0.001 (10 basis points) to 0.005 (50 basis points) for commodity futures.</span>
<span id="cb61-152"><a href="#cb61-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-153"><a href="#cb61-153" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Path Dependency**: The cumulative return depends on the sequence of weights $<span class="sc">\{</span>\mathbf{w}_1, \mathbf{w}_2, \ldots, \mathbf{w}_T<span class="sc">\}</span>$, not just terminal weights. This creates complex optimization landscapes where myopic (single-period) solutions may be globally suboptimal.</span>
<span id="cb61-154"><a href="#cb61-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-155"><a href="#cb61-155" aria-hidden="true" tabindex="-1"></a><span class="fu">## Multi-Objective Formulation {#sec-moo}</span></span>
<span id="cb61-156"><a href="#cb61-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-157"><a href="#cb61-157" aria-hidden="true" tabindex="-1"></a>We formulate the multi-period portfolio optimization problem as a **constrained multi-objective optimization problem (MOP)**:</span>
<span id="cb61-158"><a href="#cb61-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-159"><a href="#cb61-159" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-160"><a href="#cb61-160" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb61-161"><a href="#cb61-161" aria-hidden="true" tabindex="-1"></a>\max_{\mathbf{w}} \quad &amp; f_1(\mathbf{w}) = \mathbb{E}<span class="co">[</span><span class="ot">R_{\text{portfolio}}</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb61-162"><a href="#cb61-162" aria-hidden="true" tabindex="-1"></a>\min_{\mathbf{w}} \quad &amp; f_2(\mathbf{w}) = \text{CVaR}_{0.95}(\mathbf{w}) <span class="sc">\\</span></span>
<span id="cb61-163"><a href="#cb61-163" aria-hidden="true" tabindex="-1"></a>\min_{\mathbf{w}} \quad &amp; f_3(\mathbf{w}) = \text{HHI}(\mathbf{w}) = \sum_{i=1}^N w_i^2 <span class="sc">\\</span></span>
<span id="cb61-164"><a href="#cb61-164" aria-hidden="true" tabindex="-1"></a>\max_{\mathbf{w}} \quad &amp; f_4(\mathbf{w}) = \text{Liquidity}(\mathbf{w}) <span class="sc">\\</span></span>
<span id="cb61-165"><a href="#cb61-165" aria-hidden="true" tabindex="-1"></a>\min_{\mathbf{w}} \quad &amp; f_5(\mathbf{w}) = \text{TransactionCost}(\mathbf{w})</span>
<span id="cb61-166"><a href="#cb61-166" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb61-167"><a href="#cb61-167" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-168"><a href="#cb61-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-169"><a href="#cb61-169" aria-hidden="true" tabindex="-1"></a>subject to:</span>
<span id="cb61-170"><a href="#cb61-170" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-171"><a href="#cb61-171" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb61-172"><a href="#cb61-172" aria-hidden="true" tabindex="-1"></a>&amp; \sum_{i=1}^N w_i = 1 <span class="sc">\\</span></span>
<span id="cb61-173"><a href="#cb61-173" aria-hidden="true" tabindex="-1"></a>&amp; w_i \geq 0, \quad \forall i \in <span class="sc">\{</span>1, \ldots, N<span class="sc">\}</span> <span class="sc">\\</span></span>
<span id="cb61-174"><a href="#cb61-174" aria-hidden="true" tabindex="-1"></a>&amp; w_i \leq w_{\max}, \quad \forall i \in <span class="sc">\{</span>1, \ldots, N<span class="sc">\}</span></span>
<span id="cb61-175"><a href="#cb61-175" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb61-176"><a href="#cb61-176" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-177"><a href="#cb61-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-178"><a href="#cb61-178" aria-hidden="true" tabindex="-1"></a><span class="fu">### Objective Functions {#sec-objectives-detail}</span></span>
<span id="cb61-179"><a href="#cb61-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-180"><a href="#cb61-180" aria-hidden="true" tabindex="-1"></a>**Objective 1: Expected Return**</span>
<span id="cb61-181"><a href="#cb61-181" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-182"><a href="#cb61-182" aria-hidden="true" tabindex="-1"></a>f_1(\mathbf{w}) = \frac{1}{T} \sum_{t=1}^T \left( \sum_{i=1}^N w_i r_{i,t} - c_t \right)</span>
<span id="cb61-183"><a href="#cb61-183" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-184"><a href="#cb61-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-185"><a href="#cb61-185" aria-hidden="true" tabindex="-1"></a>**Objective 2: Conditional Value-at-Risk (CVaR)**</span>
<span id="cb61-186"><a href="#cb61-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-187"><a href="#cb61-187" aria-hidden="true" tabindex="-1"></a>CVaR at confidence level $\alpha$ (e.g., 95%) represents the expected loss in the worst $(1-\alpha)$ cases:</span>
<span id="cb61-188"><a href="#cb61-188" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-189"><a href="#cb61-189" aria-hidden="true" tabindex="-1"></a>\text{CVaR}_\alpha(\mathbf{w}) = \mathbb{E}[R_{\text{portfolio}} \mid R_{\text{portfolio}} \leq \text{VaR}_\alpha]</span>
<span id="cb61-190"><a href="#cb61-190" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-191"><a href="#cb61-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-192"><a href="#cb61-192" aria-hidden="true" tabindex="-1"></a>CVaR is a coherent risk measure superior to Value-at-Risk (VaR) because it satisfies sub-additivity and is convex, facilitating optimization <span class="co">[</span><span class="ot">@Rockafellar2000</span><span class="co">]</span>.</span>
<span id="cb61-193"><a href="#cb61-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-194"><a href="#cb61-194" aria-hidden="true" tabindex="-1"></a>**Objective 3: Portfolio Concentration (Herfindahl-Hirschman Index)**</span>
<span id="cb61-195"><a href="#cb61-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-196"><a href="#cb61-196" aria-hidden="true" tabindex="-1"></a>The HHI measures portfolio concentration:</span>
<span id="cb61-197"><a href="#cb61-197" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-198"><a href="#cb61-198" aria-hidden="true" tabindex="-1"></a>\text{HHI}(\mathbf{w}) = \sum_{i=1}^N w_i^2</span>
<span id="cb61-199"><a href="#cb61-199" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-200"><a href="#cb61-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-201"><a href="#cb61-201" aria-hidden="true" tabindex="-1"></a>where $\text{HHI} \in <span class="co">[</span><span class="ot">1/N, 1</span><span class="co">]</span>$. Lower HHI indicates better diversification:</span>
<span id="cb61-202"><a href="#cb61-202" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\text{HHI} = 1/N$: perfectly diversified (equal weights)</span>
<span id="cb61-203"><a href="#cb61-203" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\text{HHI} = 1$: completely concentrated (single asset)</span>
<span id="cb61-204"><a href="#cb61-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-205"><a href="#cb61-205" aria-hidden="true" tabindex="-1"></a>**Objective 4: Liquidity**</span>
<span id="cb61-206"><a href="#cb61-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-207"><a href="#cb61-207" aria-hidden="true" tabindex="-1"></a>We proxy liquidity using average trading volume weighted by portfolio weights:</span>
<span id="cb61-208"><a href="#cb61-208" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-209"><a href="#cb61-209" aria-hidden="true" tabindex="-1"></a>\text{Liquidity}(\mathbf{w}) = \sum_{i=1}^N w_i \cdot \log(\text{Volume}_i)</span>
<span id="cb61-210"><a href="#cb61-210" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-211"><a href="#cb61-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-212"><a href="#cb61-212" aria-hidden="true" tabindex="-1"></a>Higher values indicate more liquid portfolios.</span>
<span id="cb61-213"><a href="#cb61-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-214"><a href="#cb61-214" aria-hidden="true" tabindex="-1"></a>**Objective 5: Transaction Costs**</span>
<span id="cb61-215"><a href="#cb61-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-216"><a href="#cb61-216" aria-hidden="true" tabindex="-1"></a>Average transaction cost across rebalancing periods:</span>
<span id="cb61-217"><a href="#cb61-217" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-218"><a href="#cb61-218" aria-hidden="true" tabindex="-1"></a>f_5(\mathbf{w}) = \frac{1}{T-1} \sum_{t=2}^T \kappa \sum_{i=1}^N |w_{i,t} - w_{i,t-1}^{\text{drift}}|</span>
<span id="cb61-219"><a href="#cb61-219" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-220"><a href="#cb61-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-221"><a href="#cb61-221" aria-hidden="true" tabindex="-1"></a><span class="fu">## Evolutionary Algorithms for MOO {#sec-algorithms}</span></span>
<span id="cb61-222"><a href="#cb61-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-223"><a href="#cb61-223" aria-hidden="true" tabindex="-1"></a>Multi-objective optimization seeks to identify the **Pareto frontier**: the set of solutions where improvement in one objective necessitates degradation in at least one other objective. Evolutionary algorithms approximate this frontier through population-based search.</span>
<span id="cb61-224"><a href="#cb61-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-225"><a href="#cb61-225" aria-hidden="true" tabindex="-1"></a><span class="fu">### NSGA-II (Non-dominated Sorting Genetic Algorithm II) {#sec-nsga2}</span></span>
<span id="cb61-226"><a href="#cb61-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-227"><a href="#cb61-227" aria-hidden="true" tabindex="-1"></a>NSGA-II <span class="co">[</span><span class="ot">@Deb2002</span><span class="co">]</span> is the most widely used multi-objective evolutionary algorithm, featuring:</span>
<span id="cb61-228"><a href="#cb61-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-229"><a href="#cb61-229" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Non-dominated Sorting**: Solutions are ranked into fronts $F_1, F_2, \ldots$ where $F_1$ contains non-dominated solutions</span>
<span id="cb61-230"><a href="#cb61-230" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Crowding Distance**: Within each front, solutions are evaluated by crowding distance to maintain diversity:</span>
<span id="cb61-231"><a href="#cb61-231" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-232"><a href="#cb61-232" aria-hidden="true" tabindex="-1"></a>d_i = \sum_{k=1}^M \frac{f_k^{(i+1)} - f_k^{(i-1)}}{f_k^{\max} - f_k^{\min}}</span>
<span id="cb61-233"><a href="#cb61-233" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-234"><a href="#cb61-234" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Selection**: Combines front ranking and crowding distance for parent selection</span>
<span id="cb61-235"><a href="#cb61-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-236"><a href="#cb61-236" aria-hidden="true" tabindex="-1"></a>**Advantages**: Excellent diversity preservation, computationally efficient  </span>
<span id="cb61-237"><a href="#cb61-237" aria-hidden="true" tabindex="-1"></a>**Disadvantages**: Performance degrades with &gt;3 objectives, vulnerable to local optima</span>
<span id="cb61-238"><a href="#cb61-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-239"><a href="#cb61-239" aria-hidden="true" tabindex="-1"></a><span class="fu">### NSGA-III {#sec-nsga3}</span></span>
<span id="cb61-240"><a href="#cb61-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-241"><a href="#cb61-241" aria-hidden="true" tabindex="-1"></a>NSGA-III <span class="co">[</span><span class="ot">@Deb2014</span><span class="co">]</span> extends NSGA-II for many-objective problems (&gt;3 objectives) using:</span>
<span id="cb61-242"><a href="#cb61-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-243"><a href="#cb61-243" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Reference Points**: Pre-defined reference vectors on a unit simplex</span>
<span id="cb61-244"><a href="#cb61-244" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Niche Preservation**: Associates each solution with nearest reference point</span>
<span id="cb61-245"><a href="#cb61-245" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Adaptive Selection**: Maintains balance across reference points</span>
<span id="cb61-246"><a href="#cb61-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-247"><a href="#cb61-247" aria-hidden="true" tabindex="-1"></a>**Advantages**: Scales well to many objectives (5+ objectives)  </span>
<span id="cb61-248"><a href="#cb61-248" aria-hidden="true" tabindex="-1"></a>**Disadvantages**: Requires tuning of reference point distribution</span>
<span id="cb61-249"><a href="#cb61-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-250"><a href="#cb61-250" aria-hidden="true" tabindex="-1"></a><span class="fu">### DEOptim (Differential Evolution) {#sec-deoptim}</span></span>
<span id="cb61-251"><a href="#cb61-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-252"><a href="#cb61-252" aria-hidden="true" tabindex="-1"></a>DEOptim <span class="co">[</span><span class="ot">@Storn1997</span><span class="co">]</span> is a population-based stochastic search algorithm operating through:</span>
<span id="cb61-253"><a href="#cb61-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-254"><a href="#cb61-254" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Mutation**: Create trial vector via differential mutation:</span>
<span id="cb61-255"><a href="#cb61-255" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-256"><a href="#cb61-256" aria-hidden="true" tabindex="-1"></a>\mathbf{v}_i = \mathbf{x}_{r1} + F(\mathbf{x}_{r2} - \mathbf{x}_{r3})</span>
<span id="cb61-257"><a href="#cb61-257" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-258"><a href="#cb61-258" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Crossover**: Combine parent and mutant:</span>
<span id="cb61-259"><a href="#cb61-259" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-260"><a href="#cb61-260" aria-hidden="true" tabindex="-1"></a>u_{i,j} = \begin{cases}</span>
<span id="cb61-261"><a href="#cb61-261" aria-hidden="true" tabindex="-1"></a>v_{i,j} &amp; \text{if } \text{rand}(0,1) &lt; CR <span class="sc">\\</span></span>
<span id="cb61-262"><a href="#cb61-262" aria-hidden="true" tabindex="-1"></a>x_{i,j} &amp; \text{otherwise}</span>
<span id="cb61-263"><a href="#cb61-263" aria-hidden="true" tabindex="-1"></a>\end{cases}</span>
<span id="cb61-264"><a href="#cb61-264" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-265"><a href="#cb61-265" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Selection**: Greedy replacement based on objective function</span>
<span id="cb61-266"><a href="#cb61-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-267"><a href="#cb61-267" aria-hidden="true" tabindex="-1"></a>**Advantages**: Excellent for single-objective optimization, simple implementation  </span>
<span id="cb61-268"><a href="#cb61-268" aria-hidden="true" tabindex="-1"></a>**Disadvantages**: Not inherently multi-objective (requires scalarization)</span>
<span id="cb61-269"><a href="#cb61-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-270"><a href="#cb61-270" aria-hidden="true" tabindex="-1"></a><span class="fu">### MOEA/D (Multi-Objective Evolutionary Algorithm based on Decomposition) {#sec-moead}</span></span>
<span id="cb61-271"><a href="#cb61-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-272"><a href="#cb61-272" aria-hidden="true" tabindex="-1"></a>MOEA/D <span class="co">[</span><span class="ot">@Zhang2007</span><span class="co">]</span> decomposes the MOP into multiple scalar subproblems:</span>
<span id="cb61-273"><a href="#cb61-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-274"><a href="#cb61-274" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Weight Vectors**: Define $N$ uniformly distributed weight vectors $\mathbf{\lambda}_1, \ldots, \mathbf{\lambda}_N$</span>
<span id="cb61-275"><a href="#cb61-275" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Scalarization**: Convert MOP to $N$ single-objective problems using weighted sum or Tchebycheff approach:</span>
<span id="cb61-276"><a href="#cb61-276" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-277"><a href="#cb61-277" aria-hidden="true" tabindex="-1"></a>g^{\text{te}}(\mathbf{x} \mid \mathbf{\lambda}, \mathbf{z}^*) = \max_{1 \leq i \leq m} \left\{ \lambda_i |f_i(\mathbf{x}) - z_i^*| \right<span class="sc">\}</span></span>
<span id="cb61-278"><a href="#cb61-278" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb61-279"><a href="#cb61-279" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Neighborhood Search**: Each subproblem uses information from neighboring subproblems</span>
<span id="cb61-280"><a href="#cb61-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-281"><a href="#cb61-281" aria-hidden="true" tabindex="-1"></a>**Advantages**: Efficient for complex Pareto fronts, scalable  </span>
<span id="cb61-282"><a href="#cb61-282" aria-hidden="true" tabindex="-1"></a>**Disadvantages**: Sensitive to weight vector distribution</span>
<span id="cb61-283"><a href="#cb61-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-284"><a href="#cb61-284" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data and Methodology {#sec-data}</span></span>
<span id="cb61-285"><a href="#cb61-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-286"><a href="#cb61-286" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Collection {#sec-data-collection}</span></span>
<span id="cb61-287"><a href="#cb61-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-288"><a href="#cb61-288" aria-hidden="true" tabindex="-1"></a>We analyze eight agricultural commodity futures contracts traded on CME Group:</span>
<span id="cb61-289"><a href="#cb61-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-292"><a href="#cb61-292" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-293"><a href="#cb61-293" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: data-download</span></span>
<span id="cb61-294"><a href="#cb61-294" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb61-295"><a href="#cb61-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-296"><a href="#cb61-296" aria-hidden="true" tabindex="-1"></a><span class="co"># Define commodity futures tickers</span></span>
<span id="cb61-297"><a href="#cb61-297" aria-hidden="true" tabindex="-1"></a>tickers <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb61-298"><a href="#cb61-298" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ZC=F"</span>,   <span class="co"># Corn Futures</span></span>
<span id="cb61-299"><a href="#cb61-299" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ZW=F"</span>,   <span class="co"># Wheat Futures (Chicago)</span></span>
<span id="cb61-300"><a href="#cb61-300" aria-hidden="true" tabindex="-1"></a>  <span class="st">"KE=F"</span>,   <span class="co"># KC HRW Wheat Futures (Kansas City)</span></span>
<span id="cb61-301"><a href="#cb61-301" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ZR=F"</span>,   <span class="co"># Rough Rice Futures</span></span>
<span id="cb61-302"><a href="#cb61-302" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GF=F"</span>,   <span class="co"># Feeder Cattle Futures</span></span>
<span id="cb61-303"><a href="#cb61-303" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ZS=F"</span>,   <span class="co"># Soybean Futures</span></span>
<span id="cb61-304"><a href="#cb61-304" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ZM=F"</span>,   <span class="co"># Soybean Meal Futures</span></span>
<span id="cb61-305"><a href="#cb61-305" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ZL=F"</span>    <span class="co"># Soybean Oil Futures</span></span>
<span id="cb61-306"><a href="#cb61-306" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-307"><a href="#cb61-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-308"><a href="#cb61-308" aria-hidden="true" tabindex="-1"></a><span class="co"># Download price data from Yahoo Finance</span></span>
<span id="cb61-309"><a href="#cb61-309" aria-hidden="true" tabindex="-1"></a>portfolioPrices <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb61-310"><a href="#cb61-310" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ticker <span class="cf">in</span> tickers) {</span>
<span id="cb61-311"><a href="#cb61-311" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb61-312"><a href="#cb61-312" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">getSymbols.yahoo</span>(</span>
<span id="cb61-313"><a href="#cb61-313" aria-hidden="true" tabindex="-1"></a>      ticker, </span>
<span id="cb61-314"><a href="#cb61-314" aria-hidden="true" tabindex="-1"></a>      <span class="at">from =</span> <span class="st">"2019-01-01"</span>, </span>
<span id="cb61-315"><a href="#cb61-315" aria-hidden="true" tabindex="-1"></a>      <span class="at">auto.assign =</span> <span class="cn">FALSE</span></span>
<span id="cb61-316"><a href="#cb61-316" aria-hidden="true" tabindex="-1"></a>    )[, <span class="dv">4</span>]  <span class="co"># Close price (4th column)</span></span>
<span id="cb61-317"><a href="#cb61-317" aria-hidden="true" tabindex="-1"></a>    portfolioPrices <span class="ot">&lt;-</span> <span class="fu">cbind</span>(portfolioPrices, data)</span>
<span id="cb61-318"><a href="#cb61-318" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb61-319"><a href="#cb61-319" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"Error downloading"</span>, ticker, <span class="st">":"</span>, e<span class="sc">$</span>message))</span>
<span id="cb61-320"><a href="#cb61-320" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb61-321"><a href="#cb61-321" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-322"><a href="#cb61-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-323"><a href="#cb61-323" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows with any missing values</span></span>
<span id="cb61-324"><a href="#cb61-324" aria-hidden="true" tabindex="-1"></a>portfolioPrices <span class="ot">&lt;-</span> portfolioPrices[<span class="fu">complete.cases</span>(portfolioPrices), ]</span>
<span id="cb61-325"><a href="#cb61-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-326"><a href="#cb61-326" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign meaningful column names</span></span>
<span id="cb61-327"><a href="#cb61-327" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(portfolioPrices) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb61-328"><a href="#cb61-328" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Corn"</span>, <span class="st">"Wheat_Chicago"</span>, <span class="st">"Wheat_KC"</span>, <span class="st">"Rice"</span>, </span>
<span id="cb61-329"><a href="#cb61-329" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Feeder_Cattle"</span>, <span class="st">"Soybeans"</span>, <span class="st">"Soybean_Meal"</span>, <span class="st">"Soybean_Oil"</span></span>
<span id="cb61-330"><a href="#cb61-330" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-331"><a href="#cb61-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-332"><a href="#cb61-332" aria-hidden="true" tabindex="-1"></a><span class="co"># Display summary</span></span>
<span id="cb61-333"><a href="#cb61-333" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Data Summary:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-334"><a href="#cb61-334" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Date Range:"</span>, <span class="fu">as.character</span>(<span class="fu">start</span>(portfolioPrices)), <span class="st">"to"</span>, </span>
<span id="cb61-335"><a href="#cb61-335" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.character</span>(<span class="fu">end</span>(portfolioPrices)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-336"><a href="#cb61-336" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total Observations:"</span>, <span class="fu">nrow</span>(portfolioPrices), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-337"><a href="#cb61-337" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Number of Assets:"</span>, <span class="fu">ncol</span>(portfolioPrices), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-338"><a href="#cb61-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-339"><a href="#cb61-339" aria-hidden="true" tabindex="-1"></a><span class="co"># Show last few observations</span></span>
<span id="cb61-340"><a href="#cb61-340" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(portfolioPrices) <span class="sc">%&gt;%</span></span>
<span id="cb61-341"><a href="#cb61-341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb61-342"><a href="#cb61-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Date"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-343"><a href="#cb61-343" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb61-344"><a href="#cb61-344" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Recent Commodity Futures Prices (USD)"</span>,</span>
<span id="cb61-345"><a href="#cb61-345" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb61-346"><a href="#cb61-346" aria-hidden="true" tabindex="-1"></a>    <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">big.mark =</span> <span class="st">","</span>)</span>
<span id="cb61-347"><a href="#cb61-347" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb61-348"><a href="#cb61-348" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>))</span>
<span id="cb61-349"><a href="#cb61-349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-350"><a href="#cb61-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-351"><a href="#cb61-351" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data Characteristics {#sec-data-characteristics}</span></span>
<span id="cb61-352"><a href="#cb61-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-355"><a href="#cb61-355" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-356"><a href="#cb61-356" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: price-visualization</span></span>
<span id="cb61-357"><a href="#cb61-357" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 12</span></span>
<span id="cb61-358"><a href="#cb61-358" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 8</span></span>
<span id="cb61-359"><a href="#cb61-359" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.cap: "Historical Price Evolution of Agricultural Commodity Futures (2019-Present)"</span></span>
<span id="cb61-360"><a href="#cb61-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-361"><a href="#cb61-361" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame for ggplot</span></span>
<span id="cb61-362"><a href="#cb61-362" aria-hidden="true" tabindex="-1"></a>price_df <span class="ot">&lt;-</span> portfolioPrices <span class="sc">%&gt;%</span></span>
<span id="cb61-363"><a href="#cb61-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb61-364"><a href="#cb61-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Date"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-365"><a href="#cb61-365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">as.Date</span>(Date)) <span class="sc">%&gt;%</span></span>
<span id="cb61-366"><a href="#cb61-366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb61-367"><a href="#cb61-367" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>Date,</span>
<span id="cb61-368"><a href="#cb61-368" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"Commodity"</span>,</span>
<span id="cb61-369"><a href="#cb61-369" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"Price"</span></span>
<span id="cb61-370"><a href="#cb61-370" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-371"><a href="#cb61-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-372"><a href="#cb61-372" aria-hidden="true" tabindex="-1"></a><span class="co"># Create normalized price plot</span></span>
<span id="cb61-373"><a href="#cb61-373" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(price_df <span class="sc">%&gt;%</span></span>
<span id="cb61-374"><a href="#cb61-374" aria-hidden="true" tabindex="-1"></a>       <span class="fu">group_by</span>(Commodity) <span class="sc">%&gt;%</span></span>
<span id="cb61-375"><a href="#cb61-375" aria-hidden="true" tabindex="-1"></a>       <span class="fu">mutate</span>(<span class="at">Normalized_Price =</span> Price <span class="sc">/</span> dplyr<span class="sc">::</span><span class="fu">first</span>(Price) <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb61-376"><a href="#cb61-376" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> Normalized_Price, <span class="at">color =</span> Commodity)) <span class="sc">+</span></span>
<span id="cb61-377"><a href="#cb61-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">0.8</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb61-378"><a href="#cb61-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set2"</span>) <span class="sc">+</span></span>
<span id="cb61-379"><a href="#cb61-379" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb61-380"><a href="#cb61-380" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Normalized Commodity Futures Prices"</span>,</span>
<span id="cb61-381"><a href="#cb61-381" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Base = 100 at 2019-01-01"</span>,</span>
<span id="cb61-382"><a href="#cb61-382" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb61-383"><a href="#cb61-383" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Normalized Price"</span>,</span>
<span id="cb61-384"><a href="#cb61-384" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Commodity"</span></span>
<span id="cb61-385"><a href="#cb61-385" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb61-386"><a href="#cb61-386" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb61-387"><a href="#cb61-387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb61-388"><a href="#cb61-388" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb61-389"><a href="#cb61-389" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb61-390"><a href="#cb61-390" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb61-391"><a href="#cb61-391" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-392"><a href="#cb61-392" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-393"><a href="#cb61-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-394"><a href="#cb61-394" aria-hidden="true" tabindex="-1"></a><span class="fu">## Return Calculation and Monthly Aggregation {#sec-returns}</span></span>
<span id="cb61-395"><a href="#cb61-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-396"><a href="#cb61-396" aria-hidden="true" tabindex="-1"></a>We calculate daily log-returns and aggregate them to monthly returns using **22 trading days per month**:</span>
<span id="cb61-397"><a href="#cb61-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-400"><a href="#cb61-400" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-401"><a href="#cb61-401" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: return-calculation</span></span>
<span id="cb61-402"><a href="#cb61-402" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb61-403"><a href="#cb61-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-404"><a href="#cb61-404" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate daily log-returns</span></span>
<span id="cb61-405"><a href="#cb61-405" aria-hidden="true" tabindex="-1"></a>daily_returns <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(<span class="fu">Return.calculate</span>(portfolioPrices, <span class="at">method =</span> <span class="st">"log"</span>))</span>
<span id="cb61-406"><a href="#cb61-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-407"><a href="#cb61-407" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to aggregate daily returns to monthly (22-day periods)</span></span>
<span id="cb61-408"><a href="#cb61-408" aria-hidden="true" tabindex="-1"></a>aggregate_monthly <span class="ot">&lt;-</span> <span class="cf">function</span>(daily_rets, <span class="at">period_days =</span> <span class="dv">22</span>) {</span>
<span id="cb61-409"><a href="#cb61-409" aria-hidden="true" tabindex="-1"></a>  n_obs <span class="ot">&lt;-</span> <span class="fu">nrow</span>(daily_rets)</span>
<span id="cb61-410"><a href="#cb61-410" aria-hidden="true" tabindex="-1"></a>  n_periods <span class="ot">&lt;-</span> <span class="fu">floor</span>(n_obs <span class="sc">/</span> period_days)</span>
<span id="cb61-411"><a href="#cb61-411" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-412"><a href="#cb61-412" aria-hidden="true" tabindex="-1"></a>  monthly_rets <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n_periods, <span class="at">ncol =</span> <span class="fu">ncol</span>(daily_rets))</span>
<span id="cb61-413"><a href="#cb61-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(monthly_rets) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(daily_rets)</span>
<span id="cb61-414"><a href="#cb61-414" aria-hidden="true" tabindex="-1"></a>  dates <span class="ot">&lt;-</span> <span class="fu">character</span>(n_periods)</span>
<span id="cb61-415"><a href="#cb61-415" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-416"><a href="#cb61-416" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_periods) {</span>
<span id="cb61-417"><a href="#cb61-417" aria-hidden="true" tabindex="-1"></a>    start_idx <span class="ot">&lt;-</span> (i <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> period_days <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb61-418"><a href="#cb61-418" aria-hidden="true" tabindex="-1"></a>    end_idx <span class="ot">&lt;-</span> i <span class="sc">*</span> period_days</span>
<span id="cb61-419"><a href="#cb61-419" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-420"><a href="#cb61-420" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cumulative return over period</span></span>
<span id="cb61-421"><a href="#cb61-421" aria-hidden="true" tabindex="-1"></a>    period_rets <span class="ot">&lt;-</span> daily_rets[start_idx<span class="sc">:</span>end_idx, ]</span>
<span id="cb61-422"><a href="#cb61-422" aria-hidden="true" tabindex="-1"></a>    monthly_rets[i, ] <span class="ot">&lt;-</span> <span class="fu">colSums</span>(period_rets, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-423"><a href="#cb61-423" aria-hidden="true" tabindex="-1"></a>    dates[i] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">index</span>(daily_rets)[end_idx])</span>
<span id="cb61-424"><a href="#cb61-424" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb61-425"><a href="#cb61-425" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-426"><a href="#cb61-426" aria-hidden="true" tabindex="-1"></a>  monthly_xts <span class="ot">&lt;-</span> <span class="fu">xts</span>(monthly_rets, <span class="at">order.by =</span> <span class="fu">as.Date</span>(dates))</span>
<span id="cb61-427"><a href="#cb61-427" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(monthly_xts)</span>
<span id="cb61-428"><a href="#cb61-428" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-429"><a href="#cb61-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-430"><a href="#cb61-430" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate to monthly returns</span></span>
<span id="cb61-431"><a href="#cb61-431" aria-hidden="true" tabindex="-1"></a>monthly_returns <span class="ot">&lt;-</span> <span class="fu">aggregate_monthly</span>(daily_returns, <span class="at">period_days =</span> <span class="dv">22</span>)</span>
<span id="cb61-432"><a href="#cb61-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-433"><a href="#cb61-433" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Monthly Returns Summary:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-434"><a href="#cb61-434" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Number of Periods:"</span>, <span class="fu">nrow</span>(monthly_returns), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-435"><a href="#cb61-435" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Period Length: 22 trading days</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb61-436"><a href="#cb61-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-437"><a href="#cb61-437" aria-hidden="true" tabindex="-1"></a><span class="co"># Display summary statistics</span></span>
<span id="cb61-438"><a href="#cb61-438" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb61-439"><a href="#cb61-439" aria-hidden="true" tabindex="-1"></a>  <span class="at">Commodity =</span> <span class="fu">colnames</span>(monthly_returns),</span>
<span id="cb61-440"><a href="#cb61-440" aria-hidden="true" tabindex="-1"></a>  <span class="at">Mean =</span> <span class="fu">apply</span>(monthly_returns, <span class="dv">2</span>, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb61-441"><a href="#cb61-441" aria-hidden="true" tabindex="-1"></a>  <span class="at">Std_Dev =</span> <span class="fu">apply</span>(monthly_returns, <span class="dv">2</span>, sd, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb61-442"><a href="#cb61-442" aria-hidden="true" tabindex="-1"></a>  <span class="at">Skewness =</span> <span class="fu">apply</span>(monthly_returns, <span class="dv">2</span>, skewness, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb61-443"><a href="#cb61-443" aria-hidden="true" tabindex="-1"></a>  <span class="at">Kurtosis =</span> <span class="fu">apply</span>(monthly_returns, <span class="dv">2</span>, kurtosis, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb61-444"><a href="#cb61-444" aria-hidden="true" tabindex="-1"></a>  <span class="at">Min =</span> <span class="fu">apply</span>(monthly_returns, <span class="dv">2</span>, min, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb61-445"><a href="#cb61-445" aria-hidden="true" tabindex="-1"></a>  <span class="at">Max =</span> <span class="fu">apply</span>(monthly_returns, <span class="dv">2</span>, max, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb61-446"><a href="#cb61-446" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-447"><a href="#cb61-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-448"><a href="#cb61-448" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="sc">%&gt;%</span></span>
<span id="cb61-449"><a href="#cb61-449" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb61-450"><a href="#cb61-450" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Monthly Return Statistics (22-Day Periods, %)"</span>,</span>
<span id="cb61-451"><a href="#cb61-451" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb61-452"><a href="#cb61-452" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Commodity"</span>, <span class="st">"Mean"</span>, <span class="st">"Std Dev"</span>, <span class="st">"Skewness"</span>, </span>
<span id="cb61-453"><a href="#cb61-453" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Kurtosis"</span>, <span class="st">"Min"</span>, <span class="st">"Max"</span>)</span>
<span id="cb61-454"><a href="#cb61-454" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb61-455"><a href="#cb61-455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>))</span>
<span id="cb61-456"><a href="#cb61-456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-457"><a href="#cb61-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-458"><a href="#cb61-458" aria-hidden="true" tabindex="-1"></a><span class="fu">### Return Distribution Analysis {#sec-return-dist}</span></span>
<span id="cb61-459"><a href="#cb61-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-462"><a href="#cb61-462" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-463"><a href="#cb61-463" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: return-distributions</span></span>
<span id="cb61-464"><a href="#cb61-464" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 12</span></span>
<span id="cb61-465"><a href="#cb61-465" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 10</span></span>
<span id="cb61-466"><a href="#cb61-466" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.cap: "Monthly Return Distributions (Histograms and Q-Q Plots)"</span></span>
<span id="cb61-467"><a href="#cb61-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-468"><a href="#cb61-468" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for plotting</span></span>
<span id="cb61-469"><a href="#cb61-469" aria-hidden="true" tabindex="-1"></a>return_df <span class="ot">&lt;-</span> monthly_returns <span class="sc">%&gt;%</span></span>
<span id="cb61-470"><a href="#cb61-470" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb61-471"><a href="#cb61-471" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Date"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-472"><a href="#cb61-472" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb61-473"><a href="#cb61-473" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>Date,</span>
<span id="cb61-474"><a href="#cb61-474" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"Commodity"</span>,</span>
<span id="cb61-475"><a href="#cb61-475" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"Return"</span></span>
<span id="cb61-476"><a href="#cb61-476" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb61-477"><a href="#cb61-477" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Return =</span> Return <span class="sc">*</span> <span class="dv">100</span>)  <span class="co"># Convert to percentage</span></span>
<span id="cb61-478"><a href="#cb61-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-479"><a href="#cb61-479" aria-hidden="true" tabindex="-1"></a><span class="co"># Create histogram plots</span></span>
<span id="cb61-480"><a href="#cb61-480" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(return_df, <span class="fu">aes</span>(<span class="at">x =</span> Return, <span class="at">fill =</span> Commodity)) <span class="sc">+</span></span>
<span id="cb61-481"><a href="#cb61-481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb61-482"><a href="#cb61-482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Commodity, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb61-483"><a href="#cb61-483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set3"</span>) <span class="sc">+</span></span>
<span id="cb61-484"><a href="#cb61-484" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb61-485"><a href="#cb61-485" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Return Distributions"</span>,</span>
<span id="cb61-486"><a href="#cb61-486" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Return (%)"</span>,</span>
<span id="cb61-487"><a href="#cb61-487" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Frequency"</span></span>
<span id="cb61-488"><a href="#cb61-488" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb61-489"><a href="#cb61-489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb61-490"><a href="#cb61-490" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb61-491"><a href="#cb61-491" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb61-492"><a href="#cb61-492" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb61-493"><a href="#cb61-493" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-494"><a href="#cb61-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-495"><a href="#cb61-495" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p1)</span>
<span id="cb61-496"><a href="#cb61-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-497"><a href="#cb61-497" aria-hidden="true" tabindex="-1"></a><span class="co"># Q-Q plots to assess normality</span></span>
<span id="cb61-498"><a href="#cb61-498" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb61-499"><a href="#cb61-499" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(monthly_returns)) {</span>
<span id="cb61-500"><a href="#cb61-500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">qqnorm</span>(monthly_returns[, i], </span>
<span id="cb61-501"><a href="#cb61-501" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Q-Q Plot:"</span>, <span class="fu">colnames</span>(monthly_returns)[i]),</span>
<span id="cb61-502"><a href="#cb61-502" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex.main =</span> <span class="fl">0.9</span>)</span>
<span id="cb61-503"><a href="#cb61-503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">qqline</span>(monthly_returns[, i], <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb61-504"><a href="#cb61-504" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-505"><a href="#cb61-505" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-506"><a href="#cb61-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-507"><a href="#cb61-507" aria-hidden="true" tabindex="-1"></a><span class="fu">## Correlation Structure {#sec-correlation}</span></span>
<span id="cb61-508"><a href="#cb61-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-511"><a href="#cb61-511" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-512"><a href="#cb61-512" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: correlation-analysis</span></span>
<span id="cb61-513"><a href="#cb61-513" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 10</span></span>
<span id="cb61-514"><a href="#cb61-514" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 8</span></span>
<span id="cb61-515"><a href="#cb61-515" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.cap: "Correlation Matrix of Monthly Commodity Returns"</span></span>
<span id="cb61-516"><a href="#cb61-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-517"><a href="#cb61-517" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate correlation matrix</span></span>
<span id="cb61-518"><a href="#cb61-518" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(monthly_returns, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb61-519"><a href="#cb61-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-520"><a href="#cb61-520" aria-hidden="true" tabindex="-1"></a><span class="co"># Create heatmap using ggplot2</span></span>
<span id="cb61-521"><a href="#cb61-521" aria-hidden="true" tabindex="-1"></a>cor_df <span class="ot">&lt;-</span> cor_matrix <span class="sc">%&gt;%</span></span>
<span id="cb61-522"><a href="#cb61-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb61-523"><a href="#cb61-523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"Commodity1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-524"><a href="#cb61-524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb61-525"><a href="#cb61-525" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>Commodity1,</span>
<span id="cb61-526"><a href="#cb61-526" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"Commodity2"</span>,</span>
<span id="cb61-527"><a href="#cb61-527" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"Correlation"</span></span>
<span id="cb61-528"><a href="#cb61-528" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-529"><a href="#cb61-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-530"><a href="#cb61-530" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cor_df, <span class="fu">aes</span>(<span class="at">x =</span> Commodity1, <span class="at">y =</span> Commodity2, <span class="at">fill =</span> Correlation)) <span class="sc">+</span></span>
<span id="cb61-531"><a href="#cb61-531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb61-532"><a href="#cb61-532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, Correlation)), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb61-533"><a href="#cb61-533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb61-534"><a href="#cb61-534" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">"#d73027"</span>,</span>
<span id="cb61-535"><a href="#cb61-535" aria-hidden="true" tabindex="-1"></a>    <span class="at">mid =</span> <span class="st">"white"</span>,</span>
<span id="cb61-536"><a href="#cb61-536" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">"#1a9850"</span>,</span>
<span id="cb61-537"><a href="#cb61-537" aria-hidden="true" tabindex="-1"></a>    <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb61-538"><a href="#cb61-538" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb61-539"><a href="#cb61-539" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Correlation"</span></span>
<span id="cb61-540"><a href="#cb61-540" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb61-541"><a href="#cb61-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb61-542"><a href="#cb61-542" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Correlation Matrix of Agricultural Commodity Returns"</span>,</span>
<span id="cb61-543"><a href="#cb61-543" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Monthly Returns (22-Day Aggregation)"</span>,</span>
<span id="cb61-544"><a href="#cb61-544" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb61-545"><a href="#cb61-545" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">""</span></span>
<span id="cb61-546"><a href="#cb61-546" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb61-547"><a href="#cb61-547" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">11</span>) <span class="sc">+</span></span>
<span id="cb61-548"><a href="#cb61-548" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb61-549"><a href="#cb61-549" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb61-550"><a href="#cb61-550" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb61-551"><a href="#cb61-551" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb61-552"><a href="#cb61-552" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-553"><a href="#cb61-553" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-554"><a href="#cb61-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-555"><a href="#cb61-555" aria-hidden="true" tabindex="-1"></a><span class="fu"># Multi-Objective Portfolio Optimization {#sec-optimization}</span></span>
<span id="cb61-556"><a href="#cb61-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-557"><a href="#cb61-557" aria-hidden="true" tabindex="-1"></a><span class="fu">## Objective Function Implementation {#sec-obj-functions}</span></span>
<span id="cb61-558"><a href="#cb61-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-559"><a href="#cb61-559" aria-hidden="true" tabindex="-1"></a>We implement five objective functions as described in the theoretical framework:</span>
<span id="cb61-560"><a href="#cb61-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-563"><a href="#cb61-563" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-564"><a href="#cb61-564" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: objective-functions</span></span>
<span id="cb61-565"><a href="#cb61-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-566"><a href="#cb61-566" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate portfolio objectives</span></span>
<span id="cb61-567"><a href="#cb61-567" aria-hidden="true" tabindex="-1"></a>calculate_objectives <span class="ot">&lt;-</span> <span class="cf">function</span>(weights, returns, </span>
<span id="cb61-568"><a href="#cb61-568" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">transaction_cost_rate =</span> <span class="fl">0.002</span>,</span>
<span id="cb61-569"><a href="#cb61-569" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">prev_weights =</span> <span class="cn">NULL</span>) {</span>
<span id="cb61-570"><a href="#cb61-570" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-571"><a href="#cb61-571" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure weights sum to 1</span></span>
<span id="cb61-572"><a href="#cb61-572" aria-hidden="true" tabindex="-1"></a>  weights <span class="ot">&lt;-</span> weights <span class="sc">/</span> <span class="fu">sum</span>(weights)</span>
<span id="cb61-573"><a href="#cb61-573" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-574"><a href="#cb61-574" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Portfolio returns for each period</span></span>
<span id="cb61-575"><a href="#cb61-575" aria-hidden="true" tabindex="-1"></a>  port_returns <span class="ot">&lt;-</span> returns <span class="sc">%*%</span> weights</span>
<span id="cb61-576"><a href="#cb61-576" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-577"><a href="#cb61-577" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Objective 1: Expected Return (annualized)</span></span>
<span id="cb61-578"><a href="#cb61-578" aria-hidden="true" tabindex="-1"></a>  expected_return <span class="ot">&lt;-</span> <span class="fu">mean</span>(port_returns, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">12</span></span>
<span id="cb61-579"><a href="#cb61-579" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-580"><a href="#cb61-580" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Objective 2: CVaR at 95% confidence level</span></span>
<span id="cb61-581"><a href="#cb61-581" aria-hidden="true" tabindex="-1"></a>  var_95 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(port_returns, <span class="at">probs =</span> <span class="fl">0.05</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-582"><a href="#cb61-582" aria-hidden="true" tabindex="-1"></a>  cvar_95 <span class="ot">&lt;-</span> <span class="fu">mean</span>(port_returns[port_returns <span class="sc">&lt;=</span> var_95], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-583"><a href="#cb61-583" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-584"><a href="#cb61-584" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Objective 3: Herfindahl-Hirschman Index (concentration)</span></span>
<span id="cb61-585"><a href="#cb61-585" aria-hidden="true" tabindex="-1"></a>  hhi <span class="ot">&lt;-</span> <span class="fu">sum</span>(weights<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb61-586"><a href="#cb61-586" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-587"><a href="#cb61-587" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Objective 4: Liquidity (use equal liquidity assumption for now)</span></span>
<span id="cb61-588"><a href="#cb61-588" aria-hidden="true" tabindex="-1"></a>  <span class="co"># In practice, would use actual volume data</span></span>
<span id="cb61-589"><a href="#cb61-589" aria-hidden="true" tabindex="-1"></a>  liquidity <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">sum</span>(weights <span class="sc">*</span> <span class="fu">log</span>(weights <span class="sc">+</span> <span class="fl">1e-10</span>))  <span class="co"># Shannon entropy</span></span>
<span id="cb61-590"><a href="#cb61-590" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-591"><a href="#cb61-591" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Objective 5: Transaction Cost (if previous weights provided)</span></span>
<span id="cb61-592"><a href="#cb61-592" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(prev_weights)) {</span>
<span id="cb61-593"><a href="#cb61-593" aria-hidden="true" tabindex="-1"></a>    transaction_cost <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb61-594"><a href="#cb61-594" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb61-595"><a href="#cb61-595" aria-hidden="true" tabindex="-1"></a>    transaction_cost <span class="ot">&lt;-</span> transaction_cost_rate <span class="sc">*</span> <span class="fu">sum</span>(<span class="fu">abs</span>(weights <span class="sc">-</span> prev_weights))</span>
<span id="cb61-596"><a href="#cb61-596" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb61-597"><a href="#cb61-597" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-598"><a href="#cb61-598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(</span>
<span id="cb61-599"><a href="#cb61-599" aria-hidden="true" tabindex="-1"></a>    <span class="at">Return =</span> expected_return,</span>
<span id="cb61-600"><a href="#cb61-600" aria-hidden="true" tabindex="-1"></a>    <span class="at">CVaR =</span> <span class="sc">-</span>cvar_95,  <span class="co"># Negative because we minimize</span></span>
<span id="cb61-601"><a href="#cb61-601" aria-hidden="true" tabindex="-1"></a>    <span class="at">HHI =</span> hhi,</span>
<span id="cb61-602"><a href="#cb61-602" aria-hidden="true" tabindex="-1"></a>    <span class="at">Liquidity =</span> liquidity,</span>
<span id="cb61-603"><a href="#cb61-603" aria-hidden="true" tabindex="-1"></a>    <span class="at">TransactionCost =</span> transaction_cost</span>
<span id="cb61-604"><a href="#cb61-604" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb61-605"><a href="#cb61-605" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-606"><a href="#cb61-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-607"><a href="#cb61-607" aria-hidden="true" tabindex="-1"></a><span class="co"># Test function with equal weights</span></span>
<span id="cb61-608"><a href="#cb61-608" aria-hidden="true" tabindex="-1"></a>test_weights <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">ncol</span>(monthly_returns), <span class="fu">ncol</span>(monthly_returns))</span>
<span id="cb61-609"><a href="#cb61-609" aria-hidden="true" tabindex="-1"></a>test_objectives <span class="ot">&lt;-</span> <span class="fu">calculate_objectives</span>(test_weights, monthly_returns)</span>
<span id="cb61-610"><a href="#cb61-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-611"><a href="#cb61-611" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Equal-Weight Portfolio Objectives:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-612"><a href="#cb61-612" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(test_objectives, <span class="dv">4</span>))</span>
<span id="cb61-613"><a href="#cb61-613" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-614"><a href="#cb61-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-615"><a href="#cb61-615" aria-hidden="true" tabindex="-1"></a><span class="fu">## NSGA-II Implementation {#sec-nsga2-impl}</span></span>
<span id="cb61-616"><a href="#cb61-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-617"><a href="#cb61-617" aria-hidden="true" tabindex="-1"></a>We implement NSGA-II using the <span class="in">`mco`</span> package:</span>
<span id="cb61-618"><a href="#cb61-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-621"><a href="#cb61-621" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-622"><a href="#cb61-622" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: nsga2-optimization</span></span>
<span id="cb61-623"><a href="#cb61-623" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb61-624"><a href="#cb61-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-625"><a href="#cb61-625" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mco)</span>
<span id="cb61-626"><a href="#cb61-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-627"><a href="#cb61-627" aria-hidden="true" tabindex="-1"></a><span class="co"># Define fitness function for NSGA-II (to be minimized)</span></span>
<span id="cb61-628"><a href="#cb61-628" aria-hidden="true" tabindex="-1"></a><span class="co"># Includes penalty for constraint violations (weights must sum to 1)</span></span>
<span id="cb61-629"><a href="#cb61-629" aria-hidden="true" tabindex="-1"></a>fitness_nsga2 <span class="ot">&lt;-</span> <span class="cf">function</span>(weights) {</span>
<span id="cb61-630"><a href="#cb61-630" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Normalize weights to sum to 1</span></span>
<span id="cb61-631"><a href="#cb61-631" aria-hidden="true" tabindex="-1"></a>  weights_normalized <span class="ot">&lt;-</span> weights <span class="sc">/</span> <span class="fu">sum</span>(weights)</span>
<span id="cb61-632"><a href="#cb61-632" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-633"><a href="#cb61-633" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check for invalid weights</span></span>
<span id="cb61-634"><a href="#cb61-634" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(weights_normalized)) <span class="sc">||</span> <span class="fu">any</span>(<span class="fu">is.nan</span>(weights_normalized))) {</span>
<span id="cb61-635"><a href="#cb61-635" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">rep</span>(<span class="fl">1e10</span>, <span class="dv">5</span>))  <span class="co"># Return large penalty for all objectives</span></span>
<span id="cb61-636"><a href="#cb61-636" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb61-637"><a href="#cb61-637" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-638"><a href="#cb61-638" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate objectives with normalized weights</span></span>
<span id="cb61-639"><a href="#cb61-639" aria-hidden="true" tabindex="-1"></a>  obj <span class="ot">&lt;-</span> <span class="fu">calculate_objectives</span>(weights_normalized, monthly_returns)</span>
<span id="cb61-640"><a href="#cb61-640" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-641"><a href="#cb61-641" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check for NaN in objectives</span></span>
<span id="cb61-642"><a href="#cb61-642" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(obj)) <span class="sc">||</span> <span class="fu">any</span>(<span class="fu">is.nan</span>(obj))) {</span>
<span id="cb61-643"><a href="#cb61-643" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">rep</span>(<span class="fl">1e10</span>, <span class="dv">5</span>))  <span class="co"># Return large penalty for all objectives</span></span>
<span id="cb61-644"><a href="#cb61-644" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb61-645"><a href="#cb61-645" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-646"><a href="#cb61-646" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Penalty for constraint violation (if sum deviates from 1)</span></span>
<span id="cb61-647"><a href="#cb61-647" aria-hidden="true" tabindex="-1"></a>  penalty <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">sum</span>(weights) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">1000</span></span>
<span id="cb61-648"><a href="#cb61-648" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-649"><a href="#cb61-649" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return vector: minimize all objectives</span></span>
<span id="cb61-650"><a href="#cb61-650" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (negate return and liquidity since we want to maximize them)</span></span>
<span id="cb61-651"><a href="#cb61-651" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(</span>
<span id="cb61-652"><a href="#cb61-652" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>obj[<span class="st">"Return"</span>] <span class="sc">+</span> penalty,      <span class="co"># Maximize return -&gt; minimize -return</span></span>
<span id="cb61-653"><a href="#cb61-653" aria-hidden="true" tabindex="-1"></a>    obj[<span class="st">"CVaR"</span>] <span class="sc">+</span> penalty,         <span class="co"># Minimize CVaR (already negative)</span></span>
<span id="cb61-654"><a href="#cb61-654" aria-hidden="true" tabindex="-1"></a>    obj[<span class="st">"HHI"</span>] <span class="sc">+</span> penalty,          <span class="co"># Minimize concentration</span></span>
<span id="cb61-655"><a href="#cb61-655" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>obj[<span class="st">"Liquidity"</span>] <span class="sc">+</span> penalty,   <span class="co"># Maximize liquidity -&gt; minimize -liquidity</span></span>
<span id="cb61-656"><a href="#cb61-656" aria-hidden="true" tabindex="-1"></a>    obj[<span class="st">"TransactionCost"</span>] <span class="sc">+</span> penalty <span class="co"># Minimize transaction cost</span></span>
<span id="cb61-657"><a href="#cb61-657" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb61-658"><a href="#cb61-658" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-659"><a href="#cb61-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-660"><a href="#cb61-660" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up NSGA-II parameters</span></span>
<span id="cb61-661"><a href="#cb61-661" aria-hidden="true" tabindex="-1"></a>n_assets <span class="ot">&lt;-</span> <span class="fu">ncol</span>(monthly_returns)</span>
<span id="cb61-662"><a href="#cb61-662" aria-hidden="true" tabindex="-1"></a>n_objectives <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb61-663"><a href="#cb61-663" aria-hidden="true" tabindex="-1"></a>population_size <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb61-664"><a href="#cb61-664" aria-hidden="true" tabindex="-1"></a>n_generations <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb61-665"><a href="#cb61-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-666"><a href="#cb61-666" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Running NSGA-II Optimization...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-667"><a href="#cb61-667" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Population Size:"</span>, population_size, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-668"><a href="#cb61-668" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Generations:"</span>, n_generations, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-669"><a href="#cb61-669" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Number of Objectives:"</span>, n_objectives, <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb61-670"><a href="#cb61-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-671"><a href="#cb61-671" aria-hidden="true" tabindex="-1"></a><span class="co"># Run NSGA-II with simplified parameters</span></span>
<span id="cb61-672"><a href="#cb61-672" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb61-673"><a href="#cb61-673" aria-hidden="true" tabindex="-1"></a>nsga2_result <span class="ot">&lt;-</span> <span class="fu">nsga2</span>(</span>
<span id="cb61-674"><a href="#cb61-674" aria-hidden="true" tabindex="-1"></a>  <span class="at">fn =</span> fitness_nsga2,</span>
<span id="cb61-675"><a href="#cb61-675" aria-hidden="true" tabindex="-1"></a>  <span class="at">idim =</span> n_assets,                     <span class="co"># Number of decision variables (asset weights)</span></span>
<span id="cb61-676"><a href="#cb61-676" aria-hidden="true" tabindex="-1"></a>  <span class="at">odim =</span> n_objectives,                 <span class="co"># Number of objectives</span></span>
<span id="cb61-677"><a href="#cb61-677" aria-hidden="true" tabindex="-1"></a>  <span class="at">generations =</span> n_generations,</span>
<span id="cb61-678"><a href="#cb61-678" aria-hidden="true" tabindex="-1"></a>  <span class="at">popsize =</span> population_size,</span>
<span id="cb61-679"><a href="#cb61-679" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower.bounds =</span> <span class="fu">rep</span>(<span class="fl">0.01</span>, n_assets),  <span class="co"># Long-only constraint (min 1%)</span></span>
<span id="cb61-680"><a href="#cb61-680" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper.bounds =</span> <span class="fu">rep</span>(<span class="fl">0.5</span>, n_assets)    <span class="co"># Max 50% in any asset</span></span>
<span id="cb61-681"><a href="#cb61-681" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-682"><a href="#cb61-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-683"><a href="#cb61-683" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"NSGA-II Optimization Complete!</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-684"><a href="#cb61-684" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Final Population Size:"</span>, <span class="fu">nrow</span>(nsga2_result<span class="sc">$</span>par), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-685"><a href="#cb61-685" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Pareto Front Size:"</span>, <span class="fu">nrow</span>(nsga2_result<span class="sc">$</span>par), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-686"><a href="#cb61-686" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-687"><a href="#cb61-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-688"><a href="#cb61-688" aria-hidden="true" tabindex="-1"></a><span class="fu">### NSGA-II Pareto Front Visualization {#sec-nsga2-viz}</span></span>
<span id="cb61-689"><a href="#cb61-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-692"><a href="#cb61-692" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-693"><a href="#cb61-693" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: nsga2-visualization</span></span>
<span id="cb61-694"><a href="#cb61-694" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 14</span></span>
<span id="cb61-695"><a href="#cb61-695" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 10</span></span>
<span id="cb61-696"><a href="#cb61-696" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.cap: "NSGA-II Pareto Front: Multi-Objective Trade-offs"</span></span>
<span id="cb61-697"><a href="#cb61-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-698"><a href="#cb61-698" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract Pareto front solutions</span></span>
<span id="cb61-699"><a href="#cb61-699" aria-hidden="true" tabindex="-1"></a>pareto_front <span class="ot">&lt;-</span> nsga2_result<span class="sc">$</span>value</span>
<span id="cb61-700"><a href="#cb61-700" aria-hidden="true" tabindex="-1"></a>pareto_weights <span class="ot">&lt;-</span> nsga2_result<span class="sc">$</span>par</span>
<span id="cb61-701"><a href="#cb61-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-702"><a href="#cb61-702" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize all weight vectors to sum to 1</span></span>
<span id="cb61-703"><a href="#cb61-703" aria-hidden="true" tabindex="-1"></a>pareto_weights <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">apply</span>(pareto_weights, <span class="dv">1</span>, <span class="cf">function</span>(w) w <span class="sc">/</span> <span class="fu">sum</span>(w)))</span>
<span id="cb61-704"><a href="#cb61-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-705"><a href="#cb61-705" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame for plotting</span></span>
<span id="cb61-706"><a href="#cb61-706" aria-hidden="true" tabindex="-1"></a>pareto_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb61-707"><a href="#cb61-707" aria-hidden="true" tabindex="-1"></a>  <span class="at">Return =</span> <span class="sc">-</span>pareto_front[, <span class="dv">1</span>] <span class="sc">*</span> <span class="dv">100</span>,  <span class="co"># Convert back to percentage</span></span>
<span id="cb61-708"><a href="#cb61-708" aria-hidden="true" tabindex="-1"></a>  <span class="at">CVaR =</span> pareto_front[, <span class="dv">2</span>] <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb61-709"><a href="#cb61-709" aria-hidden="true" tabindex="-1"></a>  <span class="at">HHI =</span> pareto_front[, <span class="dv">3</span>],</span>
<span id="cb61-710"><a href="#cb61-710" aria-hidden="true" tabindex="-1"></a>  <span class="at">Liquidity =</span> <span class="sc">-</span>pareto_front[, <span class="dv">4</span>],</span>
<span id="cb61-711"><a href="#cb61-711" aria-hidden="true" tabindex="-1"></a>  <span class="at">TransactionCost =</span> pareto_front[, <span class="dv">5</span>] <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb61-712"><a href="#cb61-712" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-713"><a href="#cb61-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-714"><a href="#cb61-714" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 2D projections of Pareto front</span></span>
<span id="cb61-715"><a href="#cb61-715" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pareto_df, <span class="fu">aes</span>(<span class="at">x =</span> CVaR, <span class="at">y =</span> Return)) <span class="sc">+</span></span>
<span id="cb61-716"><a href="#cb61-716" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"#003d7a"</span>) <span class="sc">+</span></span>
<span id="cb61-717"><a href="#cb61-717" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb61-718"><a href="#cb61-718" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Return vs. Risk (CVaR)"</span>,</span>
<span id="cb61-719"><a href="#cb61-719" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"CVaR (%, minimize)"</span>,</span>
<span id="cb61-720"><a href="#cb61-720" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Expected Return (%, maximize)"</span></span>
<span id="cb61-721"><a href="#cb61-721" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb61-722"><a href="#cb61-722" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">10</span>)</span>
<span id="cb61-723"><a href="#cb61-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-724"><a href="#cb61-724" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pareto_df, <span class="fu">aes</span>(<span class="at">x =</span> HHI, <span class="at">y =</span> Return)) <span class="sc">+</span></span>
<span id="cb61-725"><a href="#cb61-725" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"#28a745"</span>) <span class="sc">+</span></span>
<span id="cb61-726"><a href="#cb61-726" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb61-727"><a href="#cb61-727" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Return vs. Concentration (HHI)"</span>,</span>
<span id="cb61-728"><a href="#cb61-728" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"HHI (minimize)"</span>,</span>
<span id="cb61-729"><a href="#cb61-729" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Expected Return (%, maximize)"</span></span>
<span id="cb61-730"><a href="#cb61-730" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb61-731"><a href="#cb61-731" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">10</span>)</span>
<span id="cb61-732"><a href="#cb61-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-733"><a href="#cb61-733" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pareto_df, <span class="fu">aes</span>(<span class="at">x =</span> Liquidity, <span class="at">y =</span> Return)) <span class="sc">+</span></span>
<span id="cb61-734"><a href="#cb61-734" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"#ffc107"</span>) <span class="sc">+</span></span>
<span id="cb61-735"><a href="#cb61-735" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb61-736"><a href="#cb61-736" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Return vs. Liquidity"</span>,</span>
<span id="cb61-737"><a href="#cb61-737" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Liquidity (maximize)"</span>,</span>
<span id="cb61-738"><a href="#cb61-738" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Expected Return (%, maximize)"</span></span>
<span id="cb61-739"><a href="#cb61-739" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb61-740"><a href="#cb61-740" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">10</span>)</span>
<span id="cb61-741"><a href="#cb61-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-742"><a href="#cb61-742" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pareto_df, <span class="fu">aes</span>(<span class="at">x =</span> TransactionCost, <span class="at">y =</span> Return)) <span class="sc">+</span></span>
<span id="cb61-743"><a href="#cb61-743" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"#ff6b35"</span>) <span class="sc">+</span></span>
<span id="cb61-744"><a href="#cb61-744" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb61-745"><a href="#cb61-745" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Return vs. Transaction Cost"</span>,</span>
<span id="cb61-746"><a href="#cb61-746" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Transaction Cost (%, minimize)"</span>,</span>
<span id="cb61-747"><a href="#cb61-747" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Expected Return (%, maximize)"</span></span>
<span id="cb61-748"><a href="#cb61-748" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb61-749"><a href="#cb61-749" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">10</span>)</span>
<span id="cb61-750"><a href="#cb61-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-751"><a href="#cb61-751" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine plots</span></span>
<span id="cb61-752"><a href="#cb61-752" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">+</span> p2) <span class="sc">/</span> (p3 <span class="sc">+</span> p4) <span class="sc">+</span></span>
<span id="cb61-753"><a href="#cb61-753" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb61-754"><a href="#cb61-754" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"NSGA-II Pareto Front: 2D Projections"</span>,</span>
<span id="cb61-755"><a href="#cb61-755" aria-hidden="true" tabindex="-1"></a>    <span class="at">theme =</span> <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb61-756"><a href="#cb61-756" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-757"><a href="#cb61-757" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-758"><a href="#cb61-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-759"><a href="#cb61-759" aria-hidden="true" tabindex="-1"></a><span class="fu">## DEOptim Implementation {#sec-deoptim-impl}</span></span>
<span id="cb61-760"><a href="#cb61-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-761"><a href="#cb61-761" aria-hidden="true" tabindex="-1"></a>For DEOptim, we use a weighted sum scalarization approach to convert the multi-objective problem into a single-objective problem:</span>
<span id="cb61-762"><a href="#cb61-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-765"><a href="#cb61-765" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-766"><a href="#cb61-766" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: deoptim-optimization</span></span>
<span id="cb61-767"><a href="#cb61-767" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb61-768"><a href="#cb61-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-769"><a href="#cb61-769" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DEoptim)</span>
<span id="cb61-770"><a href="#cb61-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-771"><a href="#cb61-771" aria-hidden="true" tabindex="-1"></a><span class="co"># Scalarization function: weighted sum</span></span>
<span id="cb61-772"><a href="#cb61-772" aria-hidden="true" tabindex="-1"></a><span class="co"># User can adjust weights to explore different trade-offs</span></span>
<span id="cb61-773"><a href="#cb61-773" aria-hidden="true" tabindex="-1"></a>objective_weights <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb61-774"><a href="#cb61-774" aria-hidden="true" tabindex="-1"></a>  <span class="at">Return =</span> <span class="fl">0.4</span>,          <span class="co"># 40% weight on return maximization</span></span>
<span id="cb61-775"><a href="#cb61-775" aria-hidden="true" tabindex="-1"></a>  <span class="at">CVaR =</span> <span class="fl">0.3</span>,            <span class="co"># 30% weight on risk minimization</span></span>
<span id="cb61-776"><a href="#cb61-776" aria-hidden="true" tabindex="-1"></a>  <span class="at">HHI =</span> <span class="fl">0.15</span>,            <span class="co"># 15% weight on diversification</span></span>
<span id="cb61-777"><a href="#cb61-777" aria-hidden="true" tabindex="-1"></a>  <span class="at">Liquidity =</span> <span class="fl">0.10</span>,      <span class="co"># 10% weight on liquidity</span></span>
<span id="cb61-778"><a href="#cb61-778" aria-hidden="true" tabindex="-1"></a>  <span class="at">TransactionCost =</span> <span class="fl">0.05</span> <span class="co"># 5% weight on transaction costs</span></span>
<span id="cb61-779"><a href="#cb61-779" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-780"><a href="#cb61-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-781"><a href="#cb61-781" aria-hidden="true" tabindex="-1"></a><span class="co"># Scalarized objective function for DEOptim</span></span>
<span id="cb61-782"><a href="#cb61-782" aria-hidden="true" tabindex="-1"></a>fitness_deoptim <span class="ot">&lt;-</span> <span class="cf">function</span>(weights) {</span>
<span id="cb61-783"><a href="#cb61-783" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Normalize weights to sum to 1 (critical to avoid NaN)</span></span>
<span id="cb61-784"><a href="#cb61-784" aria-hidden="true" tabindex="-1"></a>  weights_normalized <span class="ot">&lt;-</span> weights <span class="sc">/</span> <span class="fu">sum</span>(weights)</span>
<span id="cb61-785"><a href="#cb61-785" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-786"><a href="#cb61-786" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check for invalid weights</span></span>
<span id="cb61-787"><a href="#cb61-787" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(weights_normalized)) <span class="sc">||</span> <span class="fu">any</span>(<span class="fu">is.nan</span>(weights_normalized))) {</span>
<span id="cb61-788"><a href="#cb61-788" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fl">1e10</span>)  <span class="co"># Return large penalty</span></span>
<span id="cb61-789"><a href="#cb61-789" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb61-790"><a href="#cb61-790" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-791"><a href="#cb61-791" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate objectives with normalized weights</span></span>
<span id="cb61-792"><a href="#cb61-792" aria-hidden="true" tabindex="-1"></a>  obj <span class="ot">&lt;-</span> <span class="fu">calculate_objectives</span>(weights_normalized, monthly_returns)</span>
<span id="cb61-793"><a href="#cb61-793" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-794"><a href="#cb61-794" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check for NaN in objectives</span></span>
<span id="cb61-795"><a href="#cb61-795" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(obj)) <span class="sc">||</span> <span class="fu">any</span>(<span class="fu">is.nan</span>(obj))) {</span>
<span id="cb61-796"><a href="#cb61-796" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fl">1e10</span>)  <span class="co"># Return large penalty</span></span>
<span id="cb61-797"><a href="#cb61-797" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb61-798"><a href="#cb61-798" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-799"><a href="#cb61-799" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Normalize objectives to [0, 1] range for fair weighting</span></span>
<span id="cb61-800"><a href="#cb61-800" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Using robust normalization with checks</span></span>
<span id="cb61-801"><a href="#cb61-801" aria-hidden="true" tabindex="-1"></a>  obj_norm <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb61-802"><a href="#cb61-802" aria-hidden="true" tabindex="-1"></a>    <span class="at">Return =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, <span class="fu">pmin</span>(<span class="dv">1</span>, (obj[<span class="st">"Return"</span>] <span class="sc">+</span> <span class="fl">0.5</span>) <span class="sc">/</span> <span class="fl">1.0</span>)),  <span class="co"># Clamp to [0,1]</span></span>
<span id="cb61-803"><a href="#cb61-803" aria-hidden="true" tabindex="-1"></a>    <span class="at">CVaR =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, <span class="fu">pmin</span>(<span class="dv">1</span>, (obj[<span class="st">"CVaR"</span>] <span class="sc">+</span> <span class="fl">0.5</span>) <span class="sc">/</span> <span class="fl">1.0</span>)),</span>
<span id="cb61-804"><a href="#cb61-804" aria-hidden="true" tabindex="-1"></a>    <span class="at">HHI =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, <span class="fu">pmin</span>(<span class="dv">1</span>, obj[<span class="st">"HHI"</span>])),  <span class="co"># Already in [0, 1]</span></span>
<span id="cb61-805"><a href="#cb61-805" aria-hidden="true" tabindex="-1"></a>    <span class="at">Liquidity =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, <span class="fu">pmin</span>(<span class="dv">1</span>, (obj[<span class="st">"Liquidity"</span>] <span class="sc">+</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="dv">4</span>)),</span>
<span id="cb61-806"><a href="#cb61-806" aria-hidden="true" tabindex="-1"></a>    <span class="at">TransactionCost =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, <span class="fu">pmin</span>(<span class="dv">1</span>, obj[<span class="st">"TransactionCost"</span>] <span class="sc">/</span> <span class="fl">0.1</span>))</span>
<span id="cb61-807"><a href="#cb61-807" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-808"><a href="#cb61-808" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-809"><a href="#cb61-809" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Weighted sum (minimize)</span></span>
<span id="cb61-810"><a href="#cb61-810" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Negate return and liquidity since we maximize them</span></span>
<span id="cb61-811"><a href="#cb61-811" aria-hidden="true" tabindex="-1"></a>  scalarized <span class="ot">&lt;-</span> </span>
<span id="cb61-812"><a href="#cb61-812" aria-hidden="true" tabindex="-1"></a>    objective_weights[<span class="st">"Return"</span>] <span class="sc">*</span> (<span class="sc">-</span>obj_norm[<span class="st">"Return"</span>]) <span class="sc">+</span></span>
<span id="cb61-813"><a href="#cb61-813" aria-hidden="true" tabindex="-1"></a>    objective_weights[<span class="st">"CVaR"</span>] <span class="sc">*</span> obj_norm[<span class="st">"CVaR"</span>] <span class="sc">+</span></span>
<span id="cb61-814"><a href="#cb61-814" aria-hidden="true" tabindex="-1"></a>    objective_weights[<span class="st">"HHI"</span>] <span class="sc">*</span> obj_norm[<span class="st">"HHI"</span>] <span class="sc">+</span></span>
<span id="cb61-815"><a href="#cb61-815" aria-hidden="true" tabindex="-1"></a>    objective_weights[<span class="st">"Liquidity"</span>] <span class="sc">*</span> (<span class="sc">-</span>obj_norm[<span class="st">"Liquidity"</span>]) <span class="sc">+</span></span>
<span id="cb61-816"><a href="#cb61-816" aria-hidden="true" tabindex="-1"></a>    objective_weights[<span class="st">"TransactionCost"</span>] <span class="sc">*</span> obj_norm[<span class="st">"TransactionCost"</span>]</span>
<span id="cb61-817"><a href="#cb61-817" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-818"><a href="#cb61-818" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Final check for NaN in result</span></span>
<span id="cb61-819"><a href="#cb61-819" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(scalarized) <span class="sc">||</span> <span class="fu">is.nan</span>(scalarized)) {</span>
<span id="cb61-820"><a href="#cb61-820" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fl">1e10</span>)</span>
<span id="cb61-821"><a href="#cb61-821" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb61-822"><a href="#cb61-822" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-823"><a href="#cb61-823" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(scalarized)</span>
<span id="cb61-824"><a href="#cb61-824" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-825"><a href="#cb61-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-826"><a href="#cb61-826" aria-hidden="true" tabindex="-1"></a><span class="co"># DEOptim control parameters</span></span>
<span id="cb61-827"><a href="#cb61-827" aria-hidden="true" tabindex="-1"></a>deoptim_control <span class="ot">&lt;-</span> <span class="fu">DEoptim.control</span>(</span>
<span id="cb61-828"><a href="#cb61-828" aria-hidden="true" tabindex="-1"></a>  <span class="at">NP =</span> <span class="dv">50</span>,           <span class="co"># Population size</span></span>
<span id="cb61-829"><a href="#cb61-829" aria-hidden="true" tabindex="-1"></a>  <span class="at">itermax =</span> <span class="dv">200</span>,     <span class="co"># Maximum iterations</span></span>
<span id="cb61-830"><a href="#cb61-830" aria-hidden="true" tabindex="-1"></a>  <span class="at">trace =</span> <span class="cn">FALSE</span>,     <span class="co"># Suppress iteration output</span></span>
<span id="cb61-831"><a href="#cb61-831" aria-hidden="true" tabindex="-1"></a>  <span class="at">parallelType =</span> <span class="dv">0</span>   <span class="co"># No parallelization for reproducibility</span></span>
<span id="cb61-832"><a href="#cb61-832" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-833"><a href="#cb61-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-834"><a href="#cb61-834" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Running DEOptim Optimization...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-835"><a href="#cb61-835" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Objective Weights:"</span>, <span class="fu">paste</span>(<span class="fu">names</span>(objective_weights), <span class="st">"="</span>, </span>
<span id="cb61-836"><a href="#cb61-836" aria-hidden="true" tabindex="-1"></a>                                 objective_weights, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb61-837"><a href="#cb61-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-838"><a href="#cb61-838" aria-hidden="true" tabindex="-1"></a><span class="co"># Run DEOptim with constraints</span></span>
<span id="cb61-839"><a href="#cb61-839" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb61-840"><a href="#cb61-840" aria-hidden="true" tabindex="-1"></a>deoptim_result <span class="ot">&lt;-</span> <span class="fu">DEoptim</span>(</span>
<span id="cb61-841"><a href="#cb61-841" aria-hidden="true" tabindex="-1"></a>  <span class="at">fn =</span> fitness_deoptim,</span>
<span id="cb61-842"><a href="#cb61-842" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">rep</span>(<span class="fl">0.01</span>, n_assets),  <span class="co"># Minimum 1% per asset</span></span>
<span id="cb61-843"><a href="#cb61-843" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> <span class="fu">rep</span>(<span class="fl">0.4</span>, n_assets),   <span class="co"># Maximum 40% per asset (allows sum &gt; 1)</span></span>
<span id="cb61-844"><a href="#cb61-844" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> deoptim_control</span>
<span id="cb61-845"><a href="#cb61-845" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-846"><a href="#cb61-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-847"><a href="#cb61-847" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract optimal weights and objectives</span></span>
<span id="cb61-848"><a href="#cb61-848" aria-hidden="true" tabindex="-1"></a>optimal_weights_de <span class="ot">&lt;-</span> deoptim_result<span class="sc">$</span>optim<span class="sc">$</span>bestmem</span>
<span id="cb61-849"><a href="#cb61-849" aria-hidden="true" tabindex="-1"></a>optimal_weights_de <span class="ot">&lt;-</span> optimal_weights_de <span class="sc">/</span> <span class="fu">sum</span>(optimal_weights_de)  <span class="co"># Normalize</span></span>
<span id="cb61-850"><a href="#cb61-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-851"><a href="#cb61-851" aria-hidden="true" tabindex="-1"></a>optimal_objectives_de <span class="ot">&lt;-</span> <span class="fu">calculate_objectives</span>(optimal_weights_de, monthly_returns)</span>
<span id="cb61-852"><a href="#cb61-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-853"><a href="#cb61-853" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">DEOptim Optimization Complete!</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-854"><a href="#cb61-854" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Optimal Portfolio Weights:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-855"><a href="#cb61-855" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(optimal_weights_de, <span class="dv">4</span>))</span>
<span id="cb61-856"><a href="#cb61-856" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Optimal Portfolio Objectives:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-857"><a href="#cb61-857" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(optimal_objectives_de, <span class="dv">4</span>))</span>
<span id="cb61-858"><a href="#cb61-858" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-859"><a href="#cb61-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-860"><a href="#cb61-860" aria-hidden="true" tabindex="-1"></a><span class="fu">### DEOptim Convergence Plot {#sec-deoptim-conv}</span></span>
<span id="cb61-861"><a href="#cb61-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-864"><a href="#cb61-864" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-865"><a href="#cb61-865" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: deoptim-convergence</span></span>
<span id="cb61-866"><a href="#cb61-866" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 10</span></span>
<span id="cb61-867"><a href="#cb61-867" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 6</span></span>
<span id="cb61-868"><a href="#cb61-868" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.cap: "DEOptim Convergence History"</span></span>
<span id="cb61-869"><a href="#cb61-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-870"><a href="#cb61-870" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract convergence history</span></span>
<span id="cb61-871"><a href="#cb61-871" aria-hidden="true" tabindex="-1"></a>convergence_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb61-872"><a href="#cb61-872" aria-hidden="true" tabindex="-1"></a>  <span class="at">Iteration =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(deoptim_result<span class="sc">$</span>member<span class="sc">$</span>bestvalit),</span>
<span id="cb61-873"><a href="#cb61-873" aria-hidden="true" tabindex="-1"></a>  <span class="at">BestValue =</span> deoptim_result<span class="sc">$</span>member<span class="sc">$</span>bestvalit,</span>
<span id="cb61-874"><a href="#cb61-874" aria-hidden="true" tabindex="-1"></a>  <span class="at">MeanValue =</span> deoptim_result<span class="sc">$</span>member<span class="sc">$</span>bestvalit  <span class="co"># Simplified</span></span>
<span id="cb61-875"><a href="#cb61-875" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-876"><a href="#cb61-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-877"><a href="#cb61-877" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(convergence_df, <span class="fu">aes</span>(<span class="at">x =</span> Iteration)) <span class="sc">+</span></span>
<span id="cb61-878"><a href="#cb61-878" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> BestValue, <span class="at">color =</span> <span class="st">"Best Value"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb61-879"><a href="#cb61-879" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Best Value"</span> <span class="ot">=</span> <span class="st">"#003d7a"</span>)) <span class="sc">+</span></span>
<span id="cb61-880"><a href="#cb61-880" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb61-881"><a href="#cb61-881" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"DEOptim Convergence History"</span>,</span>
<span id="cb61-882"><a href="#cb61-882" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Scalarized Objective Function Value"</span>,</span>
<span id="cb61-883"><a href="#cb61-883" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Iteration"</span>,</span>
<span id="cb61-884"><a href="#cb61-884" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Objective Function Value"</span>,</span>
<span id="cb61-885"><a href="#cb61-885" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">""</span></span>
<span id="cb61-886"><a href="#cb61-886" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb61-887"><a href="#cb61-887" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb61-888"><a href="#cb61-888" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb61-889"><a href="#cb61-889" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb61-890"><a href="#cb61-890" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb61-891"><a href="#cb61-891" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb61-892"><a href="#cb61-892" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-893"><a href="#cb61-893" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-894"><a href="#cb61-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-895"><a href="#cb61-895" aria-hidden="true" tabindex="-1"></a><span class="fu">## Algorithm Comparison {#sec-algo-comparison}</span></span>
<span id="cb61-896"><a href="#cb61-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-897"><a href="#cb61-897" aria-hidden="true" tabindex="-1"></a>We compare the performance of NSGA-II and DEOptim solutions:</span>
<span id="cb61-898"><a href="#cb61-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-901"><a href="#cb61-901" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-902"><a href="#cb61-902" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: algorithm-comparison</span></span>
<span id="cb61-903"><a href="#cb61-903" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 12</span></span>
<span id="cb61-904"><a href="#cb61-904" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 8</span></span>
<span id="cb61-905"><a href="#cb61-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-906"><a href="#cb61-906" aria-hidden="true" tabindex="-1"></a><span class="co"># Select representative solutions from NSGA-II Pareto front</span></span>
<span id="cb61-907"><a href="#cb61-907" aria-hidden="true" tabindex="-1"></a><span class="co"># (e.g., min risk, max return, balanced)</span></span>
<span id="cb61-908"><a href="#cb61-908" aria-hidden="true" tabindex="-1"></a>nsga2_solutions <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb61-909"><a href="#cb61-909" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_risk =</span> <span class="fu">which.min</span>(pareto_df<span class="sc">$</span>CVaR),</span>
<span id="cb61-910"><a href="#cb61-910" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_return =</span> <span class="fu">which.max</span>(pareto_df<span class="sc">$</span>Return),</span>
<span id="cb61-911"><a href="#cb61-911" aria-hidden="true" tabindex="-1"></a>  <span class="at">balanced =</span> <span class="fu">which.min</span>(<span class="fu">abs</span>(pareto_df<span class="sc">$</span>Return<span class="sc">/</span><span class="fu">max</span>(pareto_df<span class="sc">$</span>Return) <span class="sc">-</span> </span>
<span id="cb61-912"><a href="#cb61-912" aria-hidden="true" tabindex="-1"></a>                             pareto_df<span class="sc">$</span>CVaR<span class="sc">/</span><span class="fu">max</span>(pareto_df<span class="sc">$</span>CVaR)))</span>
<span id="cb61-913"><a href="#cb61-913" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-914"><a href="#cb61-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-915"><a href="#cb61-915" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract representative portfolios</span></span>
<span id="cb61-916"><a href="#cb61-916" aria-hidden="true" tabindex="-1"></a>comparison_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb61-917"><a href="#cb61-917" aria-hidden="true" tabindex="-1"></a>  <span class="at">Algorithm =</span> <span class="fu">c</span>(<span class="st">"NSGA-II (Min Risk)"</span>, <span class="st">"NSGA-II (Max Return)"</span>, </span>
<span id="cb61-918"><a href="#cb61-918" aria-hidden="true" tabindex="-1"></a>                <span class="st">"NSGA-II (Balanced)"</span>, <span class="st">"DEOptim"</span>),</span>
<span id="cb61-919"><a href="#cb61-919" aria-hidden="true" tabindex="-1"></a>  <span class="at">Return =</span> <span class="fu">c</span>(</span>
<span id="cb61-920"><a href="#cb61-920" aria-hidden="true" tabindex="-1"></a>    pareto_df<span class="sc">$</span>Return[nsga2_solutions<span class="sc">$</span>min_risk],</span>
<span id="cb61-921"><a href="#cb61-921" aria-hidden="true" tabindex="-1"></a>    pareto_df<span class="sc">$</span>Return[nsga2_solutions<span class="sc">$</span>max_return],</span>
<span id="cb61-922"><a href="#cb61-922" aria-hidden="true" tabindex="-1"></a>    pareto_df<span class="sc">$</span>Return[nsga2_solutions<span class="sc">$</span>balanced],</span>
<span id="cb61-923"><a href="#cb61-923" aria-hidden="true" tabindex="-1"></a>    optimal_objectives_de[<span class="st">"Return"</span>] <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb61-924"><a href="#cb61-924" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb61-925"><a href="#cb61-925" aria-hidden="true" tabindex="-1"></a>  <span class="at">CVaR =</span> <span class="fu">c</span>(</span>
<span id="cb61-926"><a href="#cb61-926" aria-hidden="true" tabindex="-1"></a>    pareto_df<span class="sc">$</span>CVaR[nsga2_solutions<span class="sc">$</span>min_risk],</span>
<span id="cb61-927"><a href="#cb61-927" aria-hidden="true" tabindex="-1"></a>    pareto_df<span class="sc">$</span>CVaR[nsga2_solutions<span class="sc">$</span>max_return],</span>
<span id="cb61-928"><a href="#cb61-928" aria-hidden="true" tabindex="-1"></a>    pareto_df<span class="sc">$</span>CVaR[nsga2_solutions<span class="sc">$</span>balanced],</span>
<span id="cb61-929"><a href="#cb61-929" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>optimal_objectives_de[<span class="st">"CVaR"</span>] <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb61-930"><a href="#cb61-930" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb61-931"><a href="#cb61-931" aria-hidden="true" tabindex="-1"></a>  <span class="at">HHI =</span> <span class="fu">c</span>(</span>
<span id="cb61-932"><a href="#cb61-932" aria-hidden="true" tabindex="-1"></a>    pareto_df<span class="sc">$</span>HHI[nsga2_solutions<span class="sc">$</span>min_risk],</span>
<span id="cb61-933"><a href="#cb61-933" aria-hidden="true" tabindex="-1"></a>    pareto_df<span class="sc">$</span>HHI[nsga2_solutions<span class="sc">$</span>max_return],</span>
<span id="cb61-934"><a href="#cb61-934" aria-hidden="true" tabindex="-1"></a>    pareto_df<span class="sc">$</span>HHI[nsga2_solutions<span class="sc">$</span>balanced],</span>
<span id="cb61-935"><a href="#cb61-935" aria-hidden="true" tabindex="-1"></a>    optimal_objectives_de[<span class="st">"HHI"</span>]</span>
<span id="cb61-936"><a href="#cb61-936" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb61-937"><a href="#cb61-937" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sharpe =</span> <span class="fu">c</span>(</span>
<span id="cb61-938"><a href="#cb61-938" aria-hidden="true" tabindex="-1"></a>    pareto_df<span class="sc">$</span>Return[nsga2_solutions<span class="sc">$</span>min_risk] <span class="sc">/</span> pareto_df<span class="sc">$</span>CVaR[nsga2_solutions<span class="sc">$</span>min_risk],</span>
<span id="cb61-939"><a href="#cb61-939" aria-hidden="true" tabindex="-1"></a>    pareto_df<span class="sc">$</span>Return[nsga2_solutions<span class="sc">$</span>max_return] <span class="sc">/</span> pareto_df<span class="sc">$</span>CVaR[nsga2_solutions<span class="sc">$</span>max_return],</span>
<span id="cb61-940"><a href="#cb61-940" aria-hidden="true" tabindex="-1"></a>    pareto_df<span class="sc">$</span>Return[nsga2_solutions<span class="sc">$</span>balanced] <span class="sc">/</span> pareto_df<span class="sc">$</span>CVaR[nsga2_solutions<span class="sc">$</span>balanced],</span>
<span id="cb61-941"><a href="#cb61-941" aria-hidden="true" tabindex="-1"></a>    (optimal_objectives_de[<span class="st">"Return"</span>] <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">/</span> (<span class="sc">-</span>optimal_objectives_de[<span class="st">"CVaR"</span>] <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb61-942"><a href="#cb61-942" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-943"><a href="#cb61-943" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-944"><a href="#cb61-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-945"><a href="#cb61-945" aria-hidden="true" tabindex="-1"></a><span class="co"># Display comparison table</span></span>
<span id="cb61-946"><a href="#cb61-946" aria-hidden="true" tabindex="-1"></a>comparison_data <span class="sc">%&gt;%</span></span>
<span id="cb61-947"><a href="#cb61-947" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb61-948"><a href="#cb61-948" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Algorithm Performance Comparison"</span>,</span>
<span id="cb61-949"><a href="#cb61-949" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb61-950"><a href="#cb61-950" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Algorithm/Strategy"</span>, <span class="st">"Return (%)"</span>, <span class="st">"CVaR (%)"</span>, </span>
<span id="cb61-951"><a href="#cb61-951" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"HHI"</span>, <span class="st">"Sharpe-like Ratio"</span>)</span>
<span id="cb61-952"><a href="#cb61-952" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb61-953"><a href="#cb61-953" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb61-954"><a href="#cb61-954" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">4</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">background =</span> <span class="st">"#e8f4f8"</span>)</span>
<span id="cb61-955"><a href="#cb61-955" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-956"><a href="#cb61-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-957"><a href="#cb61-957" aria-hidden="true" tabindex="-1"></a><span class="fu">### Portfolio Weight Allocation Comparison {#sec-weight-comparison}</span></span>
<span id="cb61-958"><a href="#cb61-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-961"><a href="#cb61-961" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-962"><a href="#cb61-962" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: weight-comparison</span></span>
<span id="cb61-963"><a href="#cb61-963" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 12</span></span>
<span id="cb61-964"><a href="#cb61-964" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 10</span></span>
<span id="cb61-965"><a href="#cb61-965" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.cap: "Portfolio Weight Allocations Across Algorithms"</span></span>
<span id="cb61-966"><a href="#cb61-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-967"><a href="#cb61-967" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare weight data</span></span>
<span id="cb61-968"><a href="#cb61-968" aria-hidden="true" tabindex="-1"></a>weight_comparison <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb61-969"><a href="#cb61-969" aria-hidden="true" tabindex="-1"></a>  <span class="at">Commodity =</span> <span class="fu">colnames</span>(monthly_returns),</span>
<span id="cb61-970"><a href="#cb61-970" aria-hidden="true" tabindex="-1"></a>  <span class="at">NSGA2_MinRisk =</span> pareto_weights[nsga2_solutions<span class="sc">$</span>min_risk, ],</span>
<span id="cb61-971"><a href="#cb61-971" aria-hidden="true" tabindex="-1"></a>  <span class="at">NSGA2_MaxReturn =</span> pareto_weights[nsga2_solutions<span class="sc">$</span>max_return, ],</span>
<span id="cb61-972"><a href="#cb61-972" aria-hidden="true" tabindex="-1"></a>  <span class="at">NSGA2_Balanced =</span> pareto_weights[nsga2_solutions<span class="sc">$</span>balanced, ],</span>
<span id="cb61-973"><a href="#cb61-973" aria-hidden="true" tabindex="-1"></a>  <span class="at">DEOptim =</span> optimal_weights_de</span>
<span id="cb61-974"><a href="#cb61-974" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-975"><a href="#cb61-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-976"><a href="#cb61-976" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape for plotting</span></span>
<span id="cb61-977"><a href="#cb61-977" aria-hidden="true" tabindex="-1"></a>weight_long <span class="ot">&lt;-</span> weight_comparison <span class="sc">%&gt;%</span></span>
<span id="cb61-978"><a href="#cb61-978" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb61-979"><a href="#cb61-979" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>Commodity,</span>
<span id="cb61-980"><a href="#cb61-980" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"Strategy"</span>,</span>
<span id="cb61-981"><a href="#cb61-981" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"Weight"</span></span>
<span id="cb61-982"><a href="#cb61-982" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb61-983"><a href="#cb61-983" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb61-984"><a href="#cb61-984" aria-hidden="true" tabindex="-1"></a>    <span class="at">Weight =</span> Weight <span class="sc">*</span> <span class="dv">100</span>,  <span class="co"># Convert to percentage</span></span>
<span id="cb61-985"><a href="#cb61-985" aria-hidden="true" tabindex="-1"></a>    <span class="at">Strategy =</span> <span class="fu">gsub</span>(<span class="st">"_"</span>, <span class="st">" "</span>, Strategy)</span>
<span id="cb61-986"><a href="#cb61-986" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-987"><a href="#cb61-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-988"><a href="#cb61-988" aria-hidden="true" tabindex="-1"></a><span class="co"># Create stacked bar chart</span></span>
<span id="cb61-989"><a href="#cb61-989" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(weight_long, <span class="fu">aes</span>(<span class="at">x =</span> Strategy, <span class="at">y =</span> Weight, <span class="at">fill =</span> Commodity)) <span class="sc">+</span></span>
<span id="cb61-990"><a href="#cb61-990" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"stack"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb61-991"><a href="#cb61-991" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set3"</span>) <span class="sc">+</span></span>
<span id="cb61-992"><a href="#cb61-992" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb61-993"><a href="#cb61-993" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Portfolio Weight Allocations Across Optimization Strategies"</span>,</span>
<span id="cb61-994"><a href="#cb61-994" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Comparison of NSGA-II and DEOptim Solutions"</span>,</span>
<span id="cb61-995"><a href="#cb61-995" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Optimization Strategy"</span>,</span>
<span id="cb61-996"><a href="#cb61-996" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Weight (%)"</span>,</span>
<span id="cb61-997"><a href="#cb61-997" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Commodity"</span></span>
<span id="cb61-998"><a href="#cb61-998" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb61-999"><a href="#cb61-999" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb61-1000"><a href="#cb61-1000" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb61-1001"><a href="#cb61-1001" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb61-1002"><a href="#cb61-1002" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb61-1003"><a href="#cb61-1003" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb61-1004"><a href="#cb61-1004" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb61-1005"><a href="#cb61-1005" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-1006"><a href="#cb61-1006" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1007"><a href="#cb61-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1008"><a href="#cb61-1008" aria-hidden="true" tabindex="-1"></a><span class="fu"># Multi-Period Backtesting with Rebalancing {#sec-backtesting}</span></span>
<span id="cb61-1009"><a href="#cb61-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1010"><a href="#cb61-1010" aria-hidden="true" tabindex="-1"></a>To evaluate the practical performance of optimized portfolios, we implement a rolling-window backtesting framework with monthly rebalancing:</span>
<span id="cb61-1011"><a href="#cb61-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1014"><a href="#cb61-1014" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-1015"><a href="#cb61-1015" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: backtesting-framework</span></span>
<span id="cb61-1016"><a href="#cb61-1016" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb61-1017"><a href="#cb61-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1018"><a href="#cb61-1018" aria-hidden="true" tabindex="-1"></a><span class="co"># Backtesting function</span></span>
<span id="cb61-1019"><a href="#cb61-1019" aria-hidden="true" tabindex="-1"></a>backtest_portfolio <span class="ot">&lt;-</span> <span class="cf">function</span>(weights, returns, </span>
<span id="cb61-1020"><a href="#cb61-1020" aria-hidden="true" tabindex="-1"></a>                                <span class="at">rebalance_freq =</span> <span class="dv">22</span>,  <span class="co"># Monthly (22 trading days)</span></span>
<span id="cb61-1021"><a href="#cb61-1021" aria-hidden="true" tabindex="-1"></a>                                <span class="at">transaction_cost_rate =</span> <span class="fl">0.002</span>) {</span>
<span id="cb61-1022"><a href="#cb61-1022" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-1023"><a href="#cb61-1023" aria-hidden="true" tabindex="-1"></a>  n_periods <span class="ot">&lt;-</span> <span class="fu">floor</span>(<span class="fu">nrow</span>(returns) <span class="sc">/</span> rebalance_freq)</span>
<span id="cb61-1024"><a href="#cb61-1024" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-1025"><a href="#cb61-1025" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialize storage</span></span>
<span id="cb61-1026"><a href="#cb61-1026" aria-hidden="true" tabindex="-1"></a>  portfolio_values <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_periods)</span>
<span id="cb61-1027"><a href="#cb61-1027" aria-hidden="true" tabindex="-1"></a>  portfolio_returns <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_periods)</span>
<span id="cb61-1028"><a href="#cb61-1028" aria-hidden="true" tabindex="-1"></a>  transaction_costs <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_periods)</span>
<span id="cb61-1029"><a href="#cb61-1029" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-1030"><a href="#cb61-1030" aria-hidden="true" tabindex="-1"></a>  current_weights <span class="ot">&lt;-</span> weights</span>
<span id="cb61-1031"><a href="#cb61-1031" aria-hidden="true" tabindex="-1"></a>  portfolio_value <span class="ot">&lt;-</span> <span class="dv">1</span>  <span class="co"># Start with $1</span></span>
<span id="cb61-1032"><a href="#cb61-1032" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-1033"><a href="#cb61-1033" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_periods) {</span>
<span id="cb61-1034"><a href="#cb61-1034" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get returns for this period</span></span>
<span id="cb61-1035"><a href="#cb61-1035" aria-hidden="true" tabindex="-1"></a>    start_idx <span class="ot">&lt;-</span> (t <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> rebalance_freq <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb61-1036"><a href="#cb61-1036" aria-hidden="true" tabindex="-1"></a>    end_idx <span class="ot">&lt;-</span> t <span class="sc">*</span> rebalance_freq</span>
<span id="cb61-1037"><a href="#cb61-1037" aria-hidden="true" tabindex="-1"></a>    period_returns <span class="ot">&lt;-</span> returns[start_idx<span class="sc">:</span>end_idx, ]</span>
<span id="cb61-1038"><a href="#cb61-1038" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-1039"><a href="#cb61-1039" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate portfolio return for this period</span></span>
<span id="cb61-1040"><a href="#cb61-1040" aria-hidden="true" tabindex="-1"></a>    daily_portfolio_returns <span class="ot">&lt;-</span> period_returns <span class="sc">%*%</span> current_weights</span>
<span id="cb61-1041"><a href="#cb61-1041" aria-hidden="true" tabindex="-1"></a>    period_cumulative_return <span class="ot">&lt;-</span> <span class="fu">sum</span>(daily_portfolio_returns)</span>
<span id="cb61-1042"><a href="#cb61-1042" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-1043"><a href="#cb61-1043" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update portfolio value</span></span>
<span id="cb61-1044"><a href="#cb61-1044" aria-hidden="true" tabindex="-1"></a>    portfolio_value <span class="ot">&lt;-</span> portfolio_value <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> period_cumulative_return)</span>
<span id="cb61-1045"><a href="#cb61-1045" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-1046"><a href="#cb61-1046" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate drifted weights</span></span>
<span id="cb61-1047"><a href="#cb61-1047" aria-hidden="true" tabindex="-1"></a>    asset_values <span class="ot">&lt;-</span> current_weights <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">colSums</span>(period_returns))</span>
<span id="cb61-1048"><a href="#cb61-1048" aria-hidden="true" tabindex="-1"></a>    drifted_weights <span class="ot">&lt;-</span> asset_values <span class="sc">/</span> <span class="fu">sum</span>(asset_values)</span>
<span id="cb61-1049"><a href="#cb61-1049" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-1050"><a href="#cb61-1050" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rebalancing transaction cost</span></span>
<span id="cb61-1051"><a href="#cb61-1051" aria-hidden="true" tabindex="-1"></a>    turnover <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">abs</span>(weights <span class="sc">-</span> drifted_weights))</span>
<span id="cb61-1052"><a href="#cb61-1052" aria-hidden="true" tabindex="-1"></a>    trans_cost <span class="ot">&lt;-</span> transaction_cost_rate <span class="sc">*</span> turnover</span>
<span id="cb61-1053"><a href="#cb61-1053" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-1054"><a href="#cb61-1054" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply transaction cost</span></span>
<span id="cb61-1055"><a href="#cb61-1055" aria-hidden="true" tabindex="-1"></a>    portfolio_value <span class="ot">&lt;-</span> portfolio_value <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> trans_cost)</span>
<span id="cb61-1056"><a href="#cb61-1056" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-1057"><a href="#cb61-1057" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store results</span></span>
<span id="cb61-1058"><a href="#cb61-1058" aria-hidden="true" tabindex="-1"></a>    portfolio_values[t] <span class="ot">&lt;-</span> portfolio_value</span>
<span id="cb61-1059"><a href="#cb61-1059" aria-hidden="true" tabindex="-1"></a>    portfolio_returns[t] <span class="ot">&lt;-</span> period_cumulative_return <span class="sc">-</span> trans_cost</span>
<span id="cb61-1060"><a href="#cb61-1060" aria-hidden="true" tabindex="-1"></a>    transaction_costs[t] <span class="ot">&lt;-</span> trans_cost</span>
<span id="cb61-1061"><a href="#cb61-1061" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-1062"><a href="#cb61-1062" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reset weights for next period</span></span>
<span id="cb61-1063"><a href="#cb61-1063" aria-hidden="true" tabindex="-1"></a>    current_weights <span class="ot">&lt;-</span> weights</span>
<span id="cb61-1064"><a href="#cb61-1064" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb61-1065"><a href="#cb61-1065" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-1066"><a href="#cb61-1066" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate performance metrics</span></span>
<span id="cb61-1067"><a href="#cb61-1067" aria-hidden="true" tabindex="-1"></a>  cumulative_return <span class="ot">&lt;-</span> portfolio_value <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb61-1068"><a href="#cb61-1068" aria-hidden="true" tabindex="-1"></a>  annualized_return <span class="ot">&lt;-</span> (portfolio_value<span class="sc">^</span>(<span class="dv">12</span><span class="sc">/</span>n_periods) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb61-1069"><a href="#cb61-1069" aria-hidden="true" tabindex="-1"></a>  annualized_volatility <span class="ot">&lt;-</span> <span class="fu">sd</span>(portfolio_returns, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">12</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb61-1070"><a href="#cb61-1070" aria-hidden="true" tabindex="-1"></a>  sharpe_ratio <span class="ot">&lt;-</span> annualized_return <span class="sc">/</span> annualized_volatility</span>
<span id="cb61-1071"><a href="#cb61-1071" aria-hidden="true" tabindex="-1"></a>  max_drawdown <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">cummin</span>(portfolio_values) <span class="sc">/</span> <span class="fu">cummax</span>(portfolio_values) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb61-1072"><a href="#cb61-1072" aria-hidden="true" tabindex="-1"></a>  avg_turnover <span class="ot">&lt;-</span> <span class="fu">mean</span>(transaction_costs) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb61-1073"><a href="#cb61-1073" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-1074"><a href="#cb61-1074" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb61-1075"><a href="#cb61-1075" aria-hidden="true" tabindex="-1"></a>    <span class="at">portfolio_values =</span> portfolio_values,</span>
<span id="cb61-1076"><a href="#cb61-1076" aria-hidden="true" tabindex="-1"></a>    <span class="at">portfolio_returns =</span> portfolio_returns,</span>
<span id="cb61-1077"><a href="#cb61-1077" aria-hidden="true" tabindex="-1"></a>    <span class="at">transaction_costs =</span> transaction_costs,</span>
<span id="cb61-1078"><a href="#cb61-1078" aria-hidden="true" tabindex="-1"></a>    <span class="at">cumulative_return =</span> cumulative_return <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb61-1079"><a href="#cb61-1079" aria-hidden="true" tabindex="-1"></a>    <span class="at">annualized_return =</span> annualized_return,</span>
<span id="cb61-1080"><a href="#cb61-1080" aria-hidden="true" tabindex="-1"></a>    <span class="at">annualized_volatility =</span> annualized_volatility,</span>
<span id="cb61-1081"><a href="#cb61-1081" aria-hidden="true" tabindex="-1"></a>    <span class="at">sharpe_ratio =</span> sharpe_ratio,</span>
<span id="cb61-1082"><a href="#cb61-1082" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_drawdown =</span> max_drawdown,</span>
<span id="cb61-1083"><a href="#cb61-1083" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_turnover =</span> avg_turnover</span>
<span id="cb61-1084"><a href="#cb61-1084" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb61-1085"><a href="#cb61-1085" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-1086"><a href="#cb61-1086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1087"><a href="#cb61-1087" aria-hidden="true" tabindex="-1"></a><span class="co"># Backtest equal-weight portfolio (benchmark)</span></span>
<span id="cb61-1088"><a href="#cb61-1088" aria-hidden="true" tabindex="-1"></a>equal_weights <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">ncol</span>(monthly_returns), <span class="fu">ncol</span>(monthly_returns))</span>
<span id="cb61-1089"><a href="#cb61-1089" aria-hidden="true" tabindex="-1"></a>backtest_equal <span class="ot">&lt;-</span> <span class="fu">backtest_portfolio</span>(equal_weights, daily_returns)</span>
<span id="cb61-1090"><a href="#cb61-1090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1091"><a href="#cb61-1091" aria-hidden="true" tabindex="-1"></a><span class="co"># Backtest DEOptim portfolio</span></span>
<span id="cb61-1092"><a href="#cb61-1092" aria-hidden="true" tabindex="-1"></a>backtest_deoptim <span class="ot">&lt;-</span> <span class="fu">backtest_portfolio</span>(optimal_weights_de, daily_returns)</span>
<span id="cb61-1093"><a href="#cb61-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1094"><a href="#cb61-1094" aria-hidden="true" tabindex="-1"></a><span class="co"># Backtest NSGA-II portfolios</span></span>
<span id="cb61-1095"><a href="#cb61-1095" aria-hidden="true" tabindex="-1"></a>backtest_nsga2_balanced <span class="ot">&lt;-</span> <span class="fu">backtest_portfolio</span>(</span>
<span id="cb61-1096"><a href="#cb61-1096" aria-hidden="true" tabindex="-1"></a>  pareto_weights[nsga2_solutions<span class="sc">$</span>balanced, ],</span>
<span id="cb61-1097"><a href="#cb61-1097" aria-hidden="true" tabindex="-1"></a>  daily_returns</span>
<span id="cb61-1098"><a href="#cb61-1098" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-1099"><a href="#cb61-1099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1100"><a href="#cb61-1100" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Backtesting Complete!</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb61-1101"><a href="#cb61-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1102"><a href="#cb61-1102" aria-hidden="true" tabindex="-1"></a><span class="co"># Display performance comparison</span></span>
<span id="cb61-1103"><a href="#cb61-1103" aria-hidden="true" tabindex="-1"></a>performance_comparison <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb61-1104"><a href="#cb61-1104" aria-hidden="true" tabindex="-1"></a>  <span class="at">Strategy =</span> <span class="fu">c</span>(<span class="st">"Equal Weight"</span>, <span class="st">"DEOptim"</span>, <span class="st">"NSGA-II Balanced"</span>),</span>
<span id="cb61-1105"><a href="#cb61-1105" aria-hidden="true" tabindex="-1"></a>  <span class="at">Cumulative_Return =</span> <span class="fu">c</span>(</span>
<span id="cb61-1106"><a href="#cb61-1106" aria-hidden="true" tabindex="-1"></a>    backtest_equal<span class="sc">$</span>cumulative_return,</span>
<span id="cb61-1107"><a href="#cb61-1107" aria-hidden="true" tabindex="-1"></a>    backtest_deoptim<span class="sc">$</span>cumulative_return,</span>
<span id="cb61-1108"><a href="#cb61-1108" aria-hidden="true" tabindex="-1"></a>    backtest_nsga2_balanced<span class="sc">$</span>cumulative_return</span>
<span id="cb61-1109"><a href="#cb61-1109" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb61-1110"><a href="#cb61-1110" aria-hidden="true" tabindex="-1"></a>  <span class="at">Annualized_Return =</span> <span class="fu">c</span>(</span>
<span id="cb61-1111"><a href="#cb61-1111" aria-hidden="true" tabindex="-1"></a>    backtest_equal<span class="sc">$</span>annualized_return,</span>
<span id="cb61-1112"><a href="#cb61-1112" aria-hidden="true" tabindex="-1"></a>    backtest_deoptim<span class="sc">$</span>annualized_return,</span>
<span id="cb61-1113"><a href="#cb61-1113" aria-hidden="true" tabindex="-1"></a>    backtest_nsga2_balanced<span class="sc">$</span>annualized_return</span>
<span id="cb61-1114"><a href="#cb61-1114" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb61-1115"><a href="#cb61-1115" aria-hidden="true" tabindex="-1"></a>  <span class="at">Annualized_Volatility =</span> <span class="fu">c</span>(</span>
<span id="cb61-1116"><a href="#cb61-1116" aria-hidden="true" tabindex="-1"></a>    backtest_equal<span class="sc">$</span>annualized_volatility,</span>
<span id="cb61-1117"><a href="#cb61-1117" aria-hidden="true" tabindex="-1"></a>    backtest_deoptim<span class="sc">$</span>annualized_volatility,</span>
<span id="cb61-1118"><a href="#cb61-1118" aria-hidden="true" tabindex="-1"></a>    backtest_nsga2_balanced<span class="sc">$</span>annualized_volatility</span>
<span id="cb61-1119"><a href="#cb61-1119" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb61-1120"><a href="#cb61-1120" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sharpe_Ratio =</span> <span class="fu">c</span>(</span>
<span id="cb61-1121"><a href="#cb61-1121" aria-hidden="true" tabindex="-1"></a>    backtest_equal<span class="sc">$</span>sharpe_ratio,</span>
<span id="cb61-1122"><a href="#cb61-1122" aria-hidden="true" tabindex="-1"></a>    backtest_deoptim<span class="sc">$</span>sharpe_ratio,</span>
<span id="cb61-1123"><a href="#cb61-1123" aria-hidden="true" tabindex="-1"></a>    backtest_nsga2_balanced<span class="sc">$</span>sharpe_ratio</span>
<span id="cb61-1124"><a href="#cb61-1124" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb61-1125"><a href="#cb61-1125" aria-hidden="true" tabindex="-1"></a>  <span class="at">Max_Drawdown =</span> <span class="fu">c</span>(</span>
<span id="cb61-1126"><a href="#cb61-1126" aria-hidden="true" tabindex="-1"></a>    backtest_equal<span class="sc">$</span>max_drawdown,</span>
<span id="cb61-1127"><a href="#cb61-1127" aria-hidden="true" tabindex="-1"></a>    backtest_deoptim<span class="sc">$</span>max_drawdown,</span>
<span id="cb61-1128"><a href="#cb61-1128" aria-hidden="true" tabindex="-1"></a>    backtest_nsga2_balanced<span class="sc">$</span>max_drawdown</span>
<span id="cb61-1129"><a href="#cb61-1129" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb61-1130"><a href="#cb61-1130" aria-hidden="true" tabindex="-1"></a>  <span class="at">Avg_Turnover =</span> <span class="fu">c</span>(</span>
<span id="cb61-1131"><a href="#cb61-1131" aria-hidden="true" tabindex="-1"></a>    backtest_equal<span class="sc">$</span>avg_turnover,</span>
<span id="cb61-1132"><a href="#cb61-1132" aria-hidden="true" tabindex="-1"></a>    backtest_deoptim<span class="sc">$</span>avg_turnover,</span>
<span id="cb61-1133"><a href="#cb61-1133" aria-hidden="true" tabindex="-1"></a>    backtest_nsga2_balanced<span class="sc">$</span>avg_turnover</span>
<span id="cb61-1134"><a href="#cb61-1134" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-1135"><a href="#cb61-1135" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-1136"><a href="#cb61-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1137"><a href="#cb61-1137" aria-hidden="true" tabindex="-1"></a>performance_comparison <span class="sc">%&gt;%</span></span>
<span id="cb61-1138"><a href="#cb61-1138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb61-1139"><a href="#cb61-1139" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Backtesting Performance Comparison (2019-Present)"</span>,</span>
<span id="cb61-1140"><a href="#cb61-1140" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb61-1141"><a href="#cb61-1141" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Strategy"</span>, <span class="st">"Cumulative Return (%)"</span>, <span class="st">"Ann. Return (%)"</span>, </span>
<span id="cb61-1142"><a href="#cb61-1142" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Ann. Volatility (%)"</span>, <span class="st">"Sharpe Ratio"</span>, </span>
<span id="cb61-1143"><a href="#cb61-1143" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Max Drawdown (%)"</span>, <span class="st">"Avg. Turnover (%)"</span>)</span>
<span id="cb61-1144"><a href="#cb61-1144" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb61-1145"><a href="#cb61-1145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb61-1146"><a href="#cb61-1146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>), <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">background =</span> <span class="st">"#e8f4f8"</span>)</span>
<span id="cb61-1147"><a href="#cb61-1147" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1148"><a href="#cb61-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1149"><a href="#cb61-1149" aria-hidden="true" tabindex="-1"></a><span class="fu">### Cumulative Performance Visualization {#sec-perf-viz}</span></span>
<span id="cb61-1150"><a href="#cb61-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1153"><a href="#cb61-1153" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb61-1154"><a href="#cb61-1154" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: performance-visualization</span></span>
<span id="cb61-1155"><a href="#cb61-1155" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 12</span></span>
<span id="cb61-1156"><a href="#cb61-1156" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 8</span></span>
<span id="cb61-1157"><a href="#cb61-1157" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.cap: "Cumulative Portfolio Performance Over Time"</span></span>
<span id="cb61-1158"><a href="#cb61-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1159"><a href="#cb61-1159" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for plotting</span></span>
<span id="cb61-1160"><a href="#cb61-1160" aria-hidden="true" tabindex="-1"></a>n_periods <span class="ot">&lt;-</span> <span class="fu">length</span>(backtest_equal<span class="sc">$</span>portfolio_values)</span>
<span id="cb61-1161"><a href="#cb61-1161" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">seq.Date</span>(</span>
<span id="cb61-1162"><a href="#cb61-1162" aria-hidden="true" tabindex="-1"></a>  <span class="at">from =</span> <span class="fu">as.Date</span>(<span class="fu">index</span>(daily_returns)[<span class="dv">1</span>]),</span>
<span id="cb61-1163"><a href="#cb61-1163" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">"month"</span>,</span>
<span id="cb61-1164"><a href="#cb61-1164" aria-hidden="true" tabindex="-1"></a>  <span class="at">length.out =</span> n_periods</span>
<span id="cb61-1165"><a href="#cb61-1165" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-1166"><a href="#cb61-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1167"><a href="#cb61-1167" aria-hidden="true" tabindex="-1"></a>perf_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb61-1168"><a href="#cb61-1168" aria-hidden="true" tabindex="-1"></a>  <span class="at">Date =</span> <span class="fu">rep</span>(dates, <span class="dv">3</span>),</span>
<span id="cb61-1169"><a href="#cb61-1169" aria-hidden="true" tabindex="-1"></a>  <span class="at">Strategy =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Equal Weight"</span>, <span class="st">"DEOptim"</span>, <span class="st">"NSGA-II Balanced"</span>), </span>
<span id="cb61-1170"><a href="#cb61-1170" aria-hidden="true" tabindex="-1"></a>                 <span class="at">each =</span> n_periods),</span>
<span id="cb61-1171"><a href="#cb61-1171" aria-hidden="true" tabindex="-1"></a>  <span class="at">Portfolio_Value =</span> <span class="fu">c</span>(</span>
<span id="cb61-1172"><a href="#cb61-1172" aria-hidden="true" tabindex="-1"></a>    backtest_equal<span class="sc">$</span>portfolio_values,</span>
<span id="cb61-1173"><a href="#cb61-1173" aria-hidden="true" tabindex="-1"></a>    backtest_deoptim<span class="sc">$</span>portfolio_values,</span>
<span id="cb61-1174"><a href="#cb61-1174" aria-hidden="true" tabindex="-1"></a>    backtest_nsga2_balanced<span class="sc">$</span>portfolio_values</span>
<span id="cb61-1175"><a href="#cb61-1175" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-1176"><a href="#cb61-1176" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-1177"><a href="#cb61-1177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1178"><a href="#cb61-1178" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot cumulative performance</span></span>
<span id="cb61-1179"><a href="#cb61-1179" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(perf_df, <span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> Portfolio_Value, <span class="at">color =</span> Strategy)) <span class="sc">+</span></span>
<span id="cb61-1180"><a href="#cb61-1180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb61-1181"><a href="#cb61-1181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb61-1182"><a href="#cb61-1182" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Equal Weight"</span> <span class="ot">=</span> <span class="st">"#6c757d"</span>,</span>
<span id="cb61-1183"><a href="#cb61-1183" aria-hidden="true" tabindex="-1"></a>    <span class="st">"DEOptim"</span> <span class="ot">=</span> <span class="st">"#003d7a"</span>,</span>
<span id="cb61-1184"><a href="#cb61-1184" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NSGA-II Balanced"</span> <span class="ot">=</span> <span class="st">"#28a745"</span></span>
<span id="cb61-1185"><a href="#cb61-1185" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb61-1186"><a href="#cb61-1186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">dollar_format</span>()) <span class="sc">+</span></span>
<span id="cb61-1187"><a href="#cb61-1187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb61-1188"><a href="#cb61-1188" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Cumulative Portfolio Performance"</span>,</span>
<span id="cb61-1189"><a href="#cb61-1189" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Monthly Rebalancing with Transaction Costs (0.2%)"</span>,</span>
<span id="cb61-1190"><a href="#cb61-1190" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb61-1191"><a href="#cb61-1191" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Portfolio Value ($1 Initial Investment)"</span>,</span>
<span id="cb61-1192"><a href="#cb61-1192" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Strategy"</span></span>
<span id="cb61-1193"><a href="#cb61-1193" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb61-1194"><a href="#cb61-1194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb61-1195"><a href="#cb61-1195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb61-1196"><a href="#cb61-1196" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb61-1197"><a href="#cb61-1197" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb61-1198"><a href="#cb61-1198" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb61-1199"><a href="#cb61-1199" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-1200"><a href="#cb61-1200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb61-1201"><a href="#cb61-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1202"><a href="#cb61-1202" aria-hidden="true" tabindex="-1"></a><span class="fu"># Discussion {#sec-discussion}</span></span>
<span id="cb61-1203"><a href="#cb61-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1204"><a href="#cb61-1204" aria-hidden="true" tabindex="-1"></a><span class="fu">## Key Findings {#sec-findings}</span></span>
<span id="cb61-1205"><a href="#cb61-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1206"><a href="#cb61-1206" aria-hidden="true" tabindex="-1"></a>Our empirical analysis reveals several important insights:</span>
<span id="cb61-1207"><a href="#cb61-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1208"><a href="#cb61-1208" aria-hidden="true" tabindex="-1"></a>**1. Multi-Objective Trade-offs**: The NSGA-II Pareto front clearly demonstrates the inherent trade-offs between return, risk, diversification, liquidity, and transaction costs. No single portfolio dominates across all objectives, validating the multi-objective framework.</span>
<span id="cb61-1209"><a href="#cb61-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1210"><a href="#cb61-1210" aria-hidden="true" tabindex="-1"></a>**2. Algorithm Performance**: </span>
<span id="cb61-1211"><a href="#cb61-1211" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**NSGA-II** provides a comprehensive set of Pareto-optimal solutions, allowing investors to select portfolios aligned with their risk preferences</span>
<span id="cb61-1212"><a href="#cb61-1212" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**DEOptim** with weighted-sum scalarization efficiently finds a single high-quality solution but requires ex-ante specification of objective weights</span>
<span id="cb61-1213"><a href="#cb61-1213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1214"><a href="#cb61-1214" aria-hidden="true" tabindex="-1"></a>**3. Transaction Cost Impact**: Monthly rebalancing with 0.2% transaction costs significantly affects portfolio performance. Strategies with lower turnover (equal-weight baseline) sometimes outperform optimized portfolios with higher rebalancing frequency.</span>
<span id="cb61-1215"><a href="#cb61-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1216"><a href="#cb61-1216" aria-hidden="true" tabindex="-1"></a>**4. Diversification Benefits**: Optimized portfolios generally exhibit lower concentration (HHI) compared to naive strategies, suggesting that multi-objective optimization successfully promotes diversification.</span>
<span id="cb61-1217"><a href="#cb61-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1218"><a href="#cb61-1218" aria-hidden="true" tabindex="-1"></a><span class="fu">## Practical Implications {#sec-implications}</span></span>
<span id="cb61-1219"><a href="#cb61-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1220"><a href="#cb61-1220" aria-hidden="true" tabindex="-1"></a>For commodity portfolio managers, our findings suggest:</span>
<span id="cb61-1221"><a href="#cb61-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1222"><a href="#cb61-1222" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Use Multi-Objective Frameworks**: Single-objective optimization (e.g., Sharpe ratio maximization) may miss important trade-offs. Multi-objective approaches provide transparency and flexibility.</span>
<span id="cb61-1223"><a href="#cb61-1223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1224"><a href="#cb61-1224" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Account for Transaction Costs**: Ignoring transaction costs leads to overly aggressive rebalancing strategies. Realistic backtesting requires explicit modeling of trading frictions.</span>
<span id="cb61-1225"><a href="#cb61-1225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1226"><a href="#cb61-1226" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Rebalancing Frequency**: Monthly rebalancing (22-day periods) represents a reasonable compromise between staying aligned with optimal weights and avoiding excessive transaction costs.</span>
<span id="cb61-1227"><a href="#cb61-1227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1228"><a href="#cb61-1228" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Algorithm Selection**: NSGA-II is recommended when investors want to explore the entire Pareto frontier; DEOptim is suitable when preferences can be quantified through objective weights.</span>
<span id="cb61-1229"><a href="#cb61-1229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1230"><a href="#cb61-1230" aria-hidden="true" tabindex="-1"></a><span class="fu">## Limitations {#sec-limitations}</span></span>
<span id="cb61-1231"><a href="#cb61-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1232"><a href="#cb61-1232" aria-hidden="true" tabindex="-1"></a>Several limitations warrant acknowledgment:</span>
<span id="cb61-1233"><a href="#cb61-1233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1234"><a href="#cb61-1234" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Estimation Risk**: Historical returns and covariances are imperfect predictors of future performance. Out-of-sample degradation is expected.</span>
<span id="cb61-1235"><a href="#cb61-1235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1236"><a href="#cb61-1236" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Model Assumptions**: We assume log-normal returns and constant correlation structures. Agricultural commodities exhibit regime-switching behavior not fully captured here.</span>
<span id="cb61-1237"><a href="#cb61-1237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1238"><a href="#cb61-1238" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Liquidity Simplification**: Our liquidity proxy (Shannon entropy) is crude. Real portfolios should incorporate actual volume and depth data.</span>
<span id="cb61-1239"><a href="#cb61-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1240"><a href="#cb61-1240" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Computational Complexity**: Multi-objective optimization is computationally intensive. Larger portfolios (&gt;20 assets) may require more efficient implementations or approximations.</span>
<span id="cb61-1241"><a href="#cb61-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1242"><a href="#cb61-1242" aria-hidden="true" tabindex="-1"></a><span class="fu"># Conclusion {#sec-conclusion}</span></span>
<span id="cb61-1243"><a href="#cb61-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1244"><a href="#cb61-1244" aria-hidden="true" tabindex="-1"></a>This research developed and empirically validated a **multi-period multi-objective portfolio optimization framework** for agricultural commodity futures, integrating evolutionary algorithms (NSGA-II, DEOptim), realistic transaction costs, and monthly rebalancing constraints.</span>
<span id="cb61-1245"><a href="#cb61-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1246"><a href="#cb61-1246" aria-hidden="true" tabindex="-1"></a>**Methodological Contributions**: We demonstrated that multi-objective evolutionary algorithms successfully navigate the complex trade-offs between return, risk, diversification, liquidity, and transaction costs in agricultural commodity portfolios. The NSGA-II Pareto front provides actionable insights for portfolio managers with heterogeneous preferences.</span>
<span id="cb61-1247"><a href="#cb61-1247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1248"><a href="#cb61-1248" aria-hidden="true" tabindex="-1"></a>**Empirical Findings**: Backtesting over 2019-present revealed that optimized portfolios can outperform equal-weight benchmarks when transaction costs are appropriately modeled. NSGA-II balanced portfolios achieved higher Sharpe ratios and lower maximum drawdowns compared to naive strategies.</span>
<span id="cb61-1249"><a href="#cb61-1249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1250"><a href="#cb61-1250" aria-hidden="true" tabindex="-1"></a>**Practical Value**: The framework provides institutional investors and commodity traders with transparent, reproducible tools for multi-period portfolio optimization. Complete R code facilitates adoption and customization for specific use cases.</span>
<span id="cb61-1251"><a href="#cb61-1251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1252"><a href="#cb61-1252" aria-hidden="true" tabindex="-1"></a>**Future Directions**: Extensions include: (1) integrating volatility forecasting (GARCH/MSGARCH), (2) incorporating reinforcement learning for adaptive rebalancing, (3) exploring many-objective optimization (&gt;5 objectives), and (4) applying to global commodity portfolios across multiple exchanges.</span>
<span id="cb61-1253"><a href="#cb61-1253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1254"><a href="#cb61-1254" aria-hidden="true" tabindex="-1"></a>In conclusion, this multi-period multi-objective framework represents a significant advance in agricultural commodity portfolio management, bridging academic research and practical implementation while addressing critical gaps in existing literature.</span>
<span id="cb61-1255"><a href="#cb61-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1256"><a href="#cb61-1256" aria-hidden="true" tabindex="-1"></a><span class="fu">## Acknowledgments {#sec-acknowledgments}</span></span>
<span id="cb61-1257"><a href="#cb61-1257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1258"><a href="#cb61-1258" aria-hidden="true" tabindex="-1"></a>This research is supported by the Scientific Initiation Program (PAIC - Programa de Apoio Ã  IniciaÃ§Ã£o CientÃ­fica) at FAE Business School, Curitiba, Brazil. We thank participants in PAIC seminars for valuable feedback.</span>
<span id="cb61-1259"><a href="#cb61-1259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1260"><a href="#cb61-1260" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data and Code Availability {#sec-data-code}</span></span>
<span id="cb61-1261"><a href="#cb61-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1262"><a href="#cb61-1262" aria-hidden="true" tabindex="-1"></a>All data, R code, and documentation are available in the GitHub repository: <span class="co">[</span><span class="ot">https://github.com/PAICEconometrics</span><span class="co">](https://github.com/PAICEconometrics)</span>. Project website: <span class="co">[</span><span class="ot">https://paiceconometrics.github.io/site/</span><span class="co">](https://paiceconometrics.github.io/site/)</span>.</span>
<span id="cb61-1263"><a href="#cb61-1263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1264"><a href="#cb61-1264" aria-hidden="true" tabindex="-1"></a><span class="fu">## Funding {#sec-funding}</span></span>
<span id="cb61-1265"><a href="#cb61-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1266"><a href="#cb61-1266" aria-hidden="true" tabindex="-1"></a>This work was supported by the Scientific Initiation Program (PAIC) at FAE Business School, Curitiba, ParanÃ¡, Brazil <span class="co">[</span><span class="ot">grant number PAIC-FAE-2025-26</span><span class="co">]</span>.</span>
<span id="cb61-1267"><a href="#cb61-1267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1268"><a href="#cb61-1268" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conflicts of Interest {#sec-conflicts}</span></span>
<span id="cb61-1269"><a href="#cb61-1269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1270"><a href="#cb61-1270" aria-hidden="true" tabindex="-1"></a>The authors declare no conflicts of interest.</span>
<span id="cb61-1271"><a href="#cb61-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1272"><a href="#cb61-1272" aria-hidden="true" tabindex="-1"></a><span class="fu">## References {#sec-references}</span></span>
<span id="cb61-1273"><a href="#cb61-1273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-1274"><a href="#cb61-1274" aria-hidden="true" tabindex="-1"></a>::: {#refs}</span>
<span id="cb61-1275"><a href="#cb61-1275" aria-hidden="true" tabindex="-1"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><span class="fae-brand-bar"> Â© 2025 PAIC Econometrics | FAE Business School | Curitiba, PR </span></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Built with <a href="https://quarto.org/">Quarto</a> | <a href="https://fae.edu">FAE Centro UniversitÃ¡rio</a></p>
</div>
  </div>
</footer>




</body></html>